/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Zf=Object.create;var rn=Object.defineProperty,ed=Object.defineProperties,td=Object.getOwnPropertyDescriptor,rd=Object.getOwnPropertyDescriptors,nd=Object.getOwnPropertyNames,Ws=Object.getOwnPropertySymbols,id=Object.getPrototypeOf,Us=Object.prototype.hasOwnProperty,od=Object.prototype.propertyIsEnumerable;var Gs=(t,e,r)=>e in t?rn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pe=(t,e)=>{for(var r in e||(e={}))Us.call(e,r)&&Gs(t,r,e[r]);if(Ws)for(var r of Ws(e))od.call(e,r)&&Gs(t,r,e[r]);return t},Me=(t,e)=>ed(t,rd(e)),Qs=t=>rn(t,"__esModule",{value:!0});var Nn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),sd=(t,e)=>{Qs(t);for(var r in e)rn(t,r,{get:e[r],enumerable:!0})},ad=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of nd(e))!Us.call(t,n)&&n!=="default"&&rn(t,n,{get:()=>e[n],enumerable:!(r=td(e,n))||r.enumerable});return t},me=t=>ad(Qs(rn(t!=null?Zf(id(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var ll=Nn((Tn,hs)=>{(function(t,e){if(typeof Tn=="object"&&typeof hs=="object")hs.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var r=e();for(var n in r)(typeof Tn=="object"?Tn:t)[n]=r[n]}})(typeof self!="undefined"?self:Tn,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(n,i,o){r.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:o})},r.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,i){if(1&i&&(n=r(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var s in n)r.d(o,s,function(a){return n[a]}.bind(null,s));return o},r.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(i,"a",i),i},r.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"md5",function(){return w});var n="0123456789abcdef".split(""),i=function(b){for(var p="",x=0;x<4;x++)p+=n[b>>8*x+4&15]+n[b>>8*x&15];return p},o=function(b){for(var p=b.length,x=0;x<p;x++)b[x]=i(b[x]);return b.join("")},s=function(b,p){return b+p&4294967295},a=function(b,p,x,m,g,y,v){return function(j,A,E){return s(j<<A|j>>>32-A,E)}(p=function(j,A,E,T){return A=s(s(A,j),s(E,T))}(b,p,m,y),g,x)},u=function(b,p,x,m,g,y,v,j){return a(x&m|~x&g,p,x,y,v,j,b)},l=function(b,p,x,m,g,y,v,j){return a(x&g|m&~g,p,x,y,v,j,b)},c=function(b,p,x,m,g,y,v,j){return a(x^m^g,p,x,y,v,j,b)},h=function(b,p,x,m,g,y,v,j){return a(m^(x|~g),p,x,y,v,j,b)},f=function(b,p,x){x===void 0&&(x=s);var m=b[0],g=b[1],y=b[2],v=b[3],j=u.bind(null,x);m=j(m,g,y,v,p[0],7,-680876936),v=j(v,m,g,y,p[1],12,-389564586),y=j(y,v,m,g,p[2],17,606105819),g=j(g,y,v,m,p[3],22,-1044525330),m=j(m,g,y,v,p[4],7,-176418897),v=j(v,m,g,y,p[5],12,1200080426),y=j(y,v,m,g,p[6],17,-1473231341),g=j(g,y,v,m,p[7],22,-45705983),m=j(m,g,y,v,p[8],7,1770035416),v=j(v,m,g,y,p[9],12,-1958414417),y=j(y,v,m,g,p[10],17,-42063),g=j(g,y,v,m,p[11],22,-1990404162),m=j(m,g,y,v,p[12],7,1804603682),v=j(v,m,g,y,p[13],12,-40341101),y=j(y,v,m,g,p[14],17,-1502002290),g=j(g,y,v,m,p[15],22,1236535329);var A=l.bind(null,x);m=A(m,g,y,v,p[1],5,-165796510),v=A(v,m,g,y,p[6],9,-1069501632),y=A(y,v,m,g,p[11],14,643717713),g=A(g,y,v,m,p[0],20,-373897302),m=A(m,g,y,v,p[5],5,-701558691),v=A(v,m,g,y,p[10],9,38016083),y=A(y,v,m,g,p[15],14,-660478335),g=A(g,y,v,m,p[4],20,-405537848),m=A(m,g,y,v,p[9],5,568446438),v=A(v,m,g,y,p[14],9,-1019803690),y=A(y,v,m,g,p[3],14,-187363961),g=A(g,y,v,m,p[8],20,1163531501),m=A(m,g,y,v,p[13],5,-1444681467),v=A(v,m,g,y,p[2],9,-51403784),y=A(y,v,m,g,p[7],14,1735328473),g=A(g,y,v,m,p[12],20,-1926607734);var E=c.bind(null,x);m=E(m,g,y,v,p[5],4,-378558),v=E(v,m,g,y,p[8],11,-2022574463),y=E(y,v,m,g,p[11],16,1839030562),g=E(g,y,v,m,p[14],23,-35309556),m=E(m,g,y,v,p[1],4,-1530992060),v=E(v,m,g,y,p[4],11,1272893353),y=E(y,v,m,g,p[7],16,-155497632),g=E(g,y,v,m,p[10],23,-1094730640),m=E(m,g,y,v,p[13],4,681279174),v=E(v,m,g,y,p[0],11,-358537222),y=E(y,v,m,g,p[3],16,-722521979),g=E(g,y,v,m,p[6],23,76029189),m=E(m,g,y,v,p[9],4,-640364487),v=E(v,m,g,y,p[12],11,-421815835),y=E(y,v,m,g,p[15],16,530742520),g=E(g,y,v,m,p[2],23,-995338651);var T=h.bind(null,x);m=T(m,g,y,v,p[0],6,-198630844),v=T(v,m,g,y,p[7],10,1126891415),y=T(y,v,m,g,p[14],15,-1416354905),g=T(g,y,v,m,p[5],21,-57434055),m=T(m,g,y,v,p[12],6,1700485571),v=T(v,m,g,y,p[3],10,-1894986606),y=T(y,v,m,g,p[10],15,-1051523),g=T(g,y,v,m,p[1],21,-2054922799),m=T(m,g,y,v,p[8],6,1873313359),v=T(v,m,g,y,p[15],10,-30611744),y=T(y,v,m,g,p[6],15,-1560198380),g=T(g,y,v,m,p[13],21,1309151649),m=T(m,g,y,v,p[4],6,-145523070),v=T(v,m,g,y,p[11],10,-1120210379),y=T(y,v,m,g,p[2],15,718787259),g=T(g,y,v,m,p[9],21,-343485551),b[0]=x(m,b[0]),b[1]=x(g,b[1]),b[2]=x(y,b[2]),b[3]=x(v,b[3])},d=function(b){for(var p=[],x=0;x<64;x+=4)p[x>>2]=b.charCodeAt(x)+(b.charCodeAt(x+1)<<8)+(b.charCodeAt(x+2)<<16)+(b.charCodeAt(x+3)<<24);return p},_=function(b,p){var x,m=b.length,g=[1732584193,-271733879,-1732584194,271733878];for(x=64;x<=m;x+=64)f(g,d(b.substring(x-64,x)),p);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=(b=b.substring(x-64)).length;for(x=0;x<v;x++)y[x>>2]|=b.charCodeAt(x)<<(x%4<<3);if(y[x>>2]|=128<<(x%4<<3),x>55)for(f(g,y,p),x=16;x--;)y[x]=0;return y[14]=8*m,f(g,y,p),g};function w(b){var p;return o(_("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(p=function(x,m){var g=(65535&x)+(65535&m);return(x>>16)+(m>>16)+(g>>16)<<16|65535&g}),o(_(b,p))}}])})});var mf=Nn(Xi=>{Xi.parse=function(t,e){if(e?e.offsets=typeof e.offsets=="undefined"?!0:e.offsets:e={offsets:!0},t||(t=""),t.indexOf(":")===-1&&!e.tokenize)return t;if(!e.keywords&&!e.ranges&&!e.tokenize)return t;var r={text:[]};e.offsets&&(r.offsets=[]);for(var n={},i=[],o=/(\S+:'(?:[^'\\]|\\.)*')|(\S+:"(?:[^"\\]|\\.)*")|(-?"(?:[^"\\]|\\.)*")|(-?'(?:[^'\\]|\\.)*')|\S+|\S+:\S+/g,s;(s=o.exec(t))!==null;){var f=s[0],a=f.indexOf(":");if(a!==-1){var u=f.split(":"),l=f.slice(0,a),c=f.slice(a+1);c=c.replace(/^\"|\"$|^\'|\'$/g,""),c=(c+"").replace(/\\(.?)/g,function(v,j){switch(j){case"\\":return"\\";case"0":return"\0";case"":return"";default:return j}}),i.push({keyword:l,value:c,offsetStart:s.index,offsetEnd:s.index+f.length})}else{var h=!1;f[0]==="-"&&(h=!0,f=f.slice(1)),f=f.replace(/^\"|\"$|^\'|\'$/g,""),f=(f+"").replace(/\\(.?)/g,function(v,j){switch(j){case"\\":return"\\";case"0":return"\0";case"":return"";default:return j}}),h?n.text?(n.text instanceof Array||(n.text=[n.text]),n.text.push(f)):n.text=f:i.push({text:f,offsetStart:s.index,offsetEnd:s.index+f.length})}}i.reverse();for(var f;f=i.pop();)if(f.text)r.text.push(f.text),e.offsets&&r.offsets.push(f);else{var l=f.keyword;e.keywords=e.keywords||[];var d=!1,_=!1;if(!/^-/.test(l))d=e.keywords.indexOf(l)!==-1;else if(l[0]==="-"){var w=l.slice(1);d=e.keywords.indexOf(w)!==-1,d&&(l=w,_=!0)}e.ranges=e.ranges||[];var b=e.ranges.indexOf(l)!==-1;if(d){e.offsets&&r.offsets.push({keyword:l,value:f.value,offsetStart:_?f.offsetStart+1:f.offsetStart,offsetEnd:f.offsetEnd});var p=f.value;if(p.length){var x=p.split(",");_?n[l]?n[l]instanceof Array?x.length>1?n[l]=n[l].concat(x):n[l].push(p):(n[l]=[n[l]],n[l].push(p)):x.length>1?n[l]=x:e.alwaysArray?n[l]=[p]:n[l]=p:r[l]?r[l]instanceof Array?x.length>1?r[l]=r[l].concat(x):r[l].push(p):(r[l]=[r[l]],r[l].push(p)):x.length>1?r[l]=x:e.alwaysArray?r[l]=[p]:r[l]=p}}else if(b){e.offsets&&r.offsets.push(f);var p=f.value,m=p.split("-");r[l]={},m.length===2?(r[l].from=m[0],r[l].to=m[1]):!m.length%2||(r[l].from=p)}else{var g=f.keyword+":"+f.value;r.text.push(g),e.offsets&&r.offsets.push({text:g,offsetStart:f.offsetStart,offsetEnd:f.offsetEnd})}}return r.text.length?e.tokenize||(r.text=r.text.join(" ").trim()):delete r.text,r.exclude=n,r};Xi.stringify=function(t,e,r){if(e||(e={offsets:!0}),!t)return"";if(typeof t=="string")return t;if(Array.isArray(t))return t.join(" ");if(!Object.keys(t).length)return"";if(Object.keys(t).length===3&&!!t.text&&!!t.offsets&&!!t.exclude&&typeof t.text=="string")return t.text;r||(r="");var n=function(a){return a.indexOf(" ")>-1?JSON.stringify(a):a},i=function(a){return r+a},o=[];if(t.text){var s=[];typeof t.text=="string"?s.push(t.text):s.push.apply(s,t.text),s.length>0&&o.push(s.map(n).map(i).join(" "))}return e.keywords&&e.keywords.forEach(function(a){if(!!t[a]){var u=[];typeof t[a]=="string"?u.push(t[a]):u.push.apply(u,t[a]),u.length>0&&o.push(i(a+":"+u.map(n).join(",")))}}),e.ranges&&e.ranges.forEach(function(a){if(!!t[a]){var u=t[a].from,l=t[a].to;l&&(u=u+"-"+l),u&&o.push(i(a+":"+u))}}),t.exclude&&Object.keys(t.exclude).length>0&&o.push(Xi.stringify(t.exclude,e,"-")),o.join(" ")}});var yf=Nn((XF,gf)=>{gf.exports=mf()});var Of=Nn(no=>{function Ks(t){return Ks=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ks(t)}(function(t,e){if(typeof define=="function"&&define.amd)define(["exports"],e);else if(typeof no!="undefined")e(no);else{var r={exports:{}};e(r.exports),t.CancelablePromise=r.exports}})(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:no,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancelablePromise=void 0,t.cancelable=L,t.default=void 0,t.isCancelablePromise=P;function e(C,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(S&&S.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),S&&r(C,S)}function r(C,S){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(B,X){return B.__proto__=X,B},r(C,S)}function n(C){var S=s();return function(){var B=a(C),X;if(S){var k=a(this).constructor;X=Reflect.construct(B,arguments,k)}else X=B.apply(this,arguments);return i(this,X)}}function i(C,S){if(S&&(Ks(S)==="object"||typeof S=="function"))return S;if(S!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o(C)}function o(C){if(C===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}function s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(C){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(O){return O.__proto__||Object.getPrototypeOf(O)},a(C)}function u(C,S){var O=typeof Symbol!="undefined"&&C[Symbol.iterator]||C["@@iterator"];if(!O){if(Array.isArray(C)||(O=l(C))||S&&C&&typeof C.length=="number"){O&&(C=O);var B=0,X=function(){};return{s:X,n:function(){return B>=C.length?{done:!0}:{done:!1,value:C[B++]}},e:function(ge){throw ge},f:X}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k=!0,re=!1,Ke;return{s:function(){O=O.call(C)},n:function(){var ge=O.next();return k=ge.done,ge},e:function(ge){re=!0,Ke=ge},f:function(){try{!k&&O.return!=null&&O.return()}finally{if(re)throw Ke}}}}function l(C,S){if(!!C){if(typeof C=="string")return c(C,S);var O=Object.prototype.toString.call(C).slice(8,-1);if(O==="Object"&&C.constructor&&(O=C.constructor.name),O==="Map"||O==="Set")return Array.from(C);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return c(C,S)}}function c(C,S){(S==null||S>C.length)&&(S=C.length);for(var O=0,B=new Array(S);O<S;O++)B[O]=C[O];return B}function h(C,S){if(!(C instanceof S))throw new TypeError("Cannot call a class as a function")}function f(C,S){for(var O=0;O<S.length;O++){var B=S[O];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(C,B.key,B)}}function d(C,S,O){return S&&f(C.prototype,S),O&&f(C,O),Object.defineProperty(C,"prototype",{writable:!1}),C}function _(C,S,O){return S in C?Object.defineProperty(C,S,{value:O,enumerable:!0,configurable:!0,writable:!0}):C[S]=O,C}function w(C,S,O){b(C,S),S.set(C,O)}function b(C,S){if(S.has(C))throw new TypeError("Cannot initialize the same private elements twice on an object")}function p(C,S){var O=g(C,S,"get");return x(C,O)}function x(C,S){return S.get?S.get.call(C):S.value}function m(C,S,O){var B=g(C,S,"set");return y(C,B,O),O}function g(C,S,O){if(!S.has(C))throw new TypeError("attempted to "+O+" private field on non-instance");return S.get(C)}function y(C,S,O){if(S.set)S.set.call(C,O);else{if(!S.writable)throw new TypeError("attempted to set read only private field");S.value=O}}var v=typeof Symbol!="undefined"?Symbol.toStringTag:"@@toStringTag",j=new WeakMap,A=new WeakMap,E=function(){function C(S){var O=S.executor,B=O===void 0?function(){}:O,X=S.internals,k=X===void 0?q():X,re=S.promise,Ke=re===void 0?new Promise(function(je,ge){return B(je,ge,function(ze){k.onCancelList.push(ze)})}):re;h(this,C),w(this,j,{writable:!0,value:void 0}),w(this,A,{writable:!0,value:void 0}),_(this,v,"CancelablePromise"),this.cancel=this.cancel.bind(this),m(this,j,k),m(this,A,Ke||new Promise(function(je,ge){return B(je,ge,function(ze){k.onCancelList.push(ze)})}))}return d(C,[{key:"then",value:function(O,B){return J(p(this,A).then(z(O,p(this,j)),z(B,p(this,j))),p(this,j))}},{key:"catch",value:function(O){return J(p(this,A).catch(z(O,p(this,j))),p(this,j))}},{key:"finally",value:function(O,B){var X=this;return B&&p(this,j).onCancelList.push(O),J(p(this,A).finally(z(function(){if(O)return B&&(p(X,j).onCancelList=p(X,j).onCancelList.filter(function(k){return k!==O})),O()},p(this,j))),p(this,j))}},{key:"cancel",value:function(){p(this,j).isCanceled=!0;var O=p(this,j).onCancelList;p(this,j).onCancelList=[];var B=u(O),X;try{for(B.s();!(X=B.n()).done;){var k=X.value;if(typeof k=="function")try{k()}catch(re){console.error(re)}}}catch(re){B.e(re)}finally{B.f()}}},{key:"isCanceled",value:function(){return p(this,j).isCanceled===!0}}]),C}(),T=function(C){e(O,C);var S=n(O);function O(B){return h(this,O),S.call(this,{executor:B})}return d(O)}(E);t.CancelablePromise=T,_(T,"all",function(S){return Y(S,Promise.all(S))}),_(T,"allSettled",function(S){return Y(S,Promise.allSettled(S))}),_(T,"any",function(S){return Y(S,Promise.any(S))}),_(T,"race",function(S){return Y(S,Promise.race(S))}),_(T,"resolve",function(S){return L(Promise.resolve(S))}),_(T,"reject",function(S){return L(Promise.reject(S))}),_(T,"isCancelable",P);var I=T;t.default=I;function L(C){return J(C,q())}function P(C){return C instanceof T||C instanceof E}function z(C,S){if(C)return function(O){if(!S.isCanceled){var B=C(O);return P(B)&&S.onCancelList.push(B.cancel),B}return O}}function J(C,S){return new E({internals:S,promise:C})}function Y(C,S){var O=q();return O.onCancelList.push(function(){var B=u(C),X;try{for(B.s();!(X=B.n()).done;){var k=X.value;P(k)&&k.cancel()}}catch(re){B.e(re)}finally{B.f()}}),new E({internals:O,promise:S})}function q(){return{isCanceled:!1,onCancelList:[]}}})});sd(exports,{default:()=>Vs});var fr=me(require("obsidian"));var io=me(require("obsidian"));function he(){}function ld(t,e){for(let r in e)t[r]=e[r];return t}function ao(t){return t()}function qs(){return Object.create(null)}function Xe(t){t.forEach(ao)}function dr(t){return typeof t=="function"}function Ae(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var Bn;function lo(t,e){return Bn||(Bn=document.createElement("a")),Bn.href=e,t===Bn.href}function Ys(t){return Object.keys(t).length===0}function Js(t,...e){if(t==null)return he;let r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}function Kn(t,e,r){t.$$.on_destroy.push(Js(e,r))}function pr(t,e,r,n){if(t){let i=Xs(t,e,r,n);return t[0](i)}}function Xs(t,e,r,n){return t[1]&&n?ld(r.ctx.slice(),t[1](n(e))):r.ctx}function hr(t,e,r,n){if(t[2]&&n){let i=t[2](n(r));if(e.dirty===void 0)return i;if(typeof i=="object"){let o=[],s=Math.max(e.dirty.length,i.length);for(let a=0;a<s;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function mr(t,e,r,n,i,o){if(i){let s=Xs(e,r,n,o);t.p(s,i)}}function gr(t){if(t.ctx.length>32){let e=[],r=t.ctx.length/32;for(let n=0;n<r;n++)e[n]=-1;return e}return-1}function Zs(t){return t&&dr(t.destroy)?t.destroy:he}var ea=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global,zn=class{constructor(e){this.options=e,this._listeners="WeakMap"in ea?new WeakMap:void 0}observe(e,r){return this._listeners.set(e,r),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(r=>{var n;for(let i of r)zn.entries.set(i.target,i),(n=this._listeners.get(i.target))===null||n===void 0||n(i)})}};zn.entries="WeakMap"in ea?new WeakMap:void 0;var ta=!1;function ud(){ta=!0}function cd(){ta=!1}function D(t,e){t.appendChild(e)}function $(t,e,r){t.insertBefore(e,r||null)}function V(t){t.parentNode&&t.parentNode.removeChild(t)}function Hn(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function M(t){return document.createElement(t)}function Ce(t){return document.createTextNode(t)}function W(){return Ce(" ")}function yr(){return Ce("")}function Ve(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function N(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function fd(t){return Array.from(t.childNodes)}function Ze(t,e){e=""+e,t.data!==e&&(t.data=e)}function uo(t,e){t.value=e??""}function Ge(t,e,r,n){r==null?t.style.removeProperty(e):t.style.setProperty(e,r,n?"important":"")}function co(t,e,r){t.classList[r?"add":"remove"](e)}function dd(t,e,{bubbles:r=!1,cancelable:n=!1}={}){let i=document.createEvent("CustomEvent");return i.initCustomEvent(t,r,n,e),i}var nn;function on(t){nn=t}function fo(){if(!nn)throw new Error("Function called outside component initialization");return nn}function sn(t){fo().$$.on_mount.push(t)}function an(t){fo().$$.on_destroy.push(t)}function po(){let t=fo();return(e,r,{cancelable:n=!1}={})=>{let i=t.$$.callbacks[e];if(i){let o=dd(e,r,{cancelable:n});return i.slice().forEach(s=>{s.call(t,o)}),!o.defaultPrevented}return!0}}function Qe(t,e){let r=t.$$.callbacks[e.type];r&&r.slice().forEach(n=>n.call(this,e))}var _r=[];var lt=[],vr=[],ra=[],na=Promise.resolve(),ho=!1;function ia(){ho||(ho=!0,na.then(oa))}function jt(){return ia(),na}function mo(t){vr.push(t)}var go=new Set,br=0;function oa(){if(br!==0)return;let t=nn;do{try{for(;br<_r.length;){let e=_r[br];br++,on(e),pd(e.$$)}}catch(e){throw _r.length=0,br=0,e}for(on(null),_r.length=0,br=0;lt.length;)lt.pop()();for(let e=0;e<vr.length;e+=1){let r=vr[e];go.has(r)||(go.add(r),r())}vr.length=0}while(_r.length);for(;ra.length;)ra.pop()();ho=!1,go.clear(),on(t)}function pd(t){if(t.fragment!==null){t.update(),Xe(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(mo)}}function hd(t){let e=[],r=[];vr.forEach(n=>t.indexOf(n)===-1?e.push(n):r.push(n)),r.forEach(n=>n()),vr=e}var Vn=new Set,Wt;function Ut(){Wt={r:0,c:[],p:Wt}}function Gt(){Wt.r||Xe(Wt.c),Wt=Wt.p}function ee(t,e){t&&t.i&&(Vn.delete(t),t.i(e))}function ne(t,e,r,n){if(t&&t.o){if(Vn.has(t))return;Vn.add(t),Wt.c.push(()=>{Vn.delete(t),n&&(r&&t.d(1),n())}),t.o(e)}else n&&n()}var md=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Ub=new Set([...md]);function $e(t){t&&t.c()}function Re(t,e,r,n){let{fragment:i,after_update:o}=t.$$;i&&i.m(e,r),n||mo(()=>{let s=t.$$.on_mount.map(ao).filter(dr);t.$$.on_destroy?t.$$.on_destroy.push(...s):Xe(s),t.$$.on_mount=[]}),o.forEach(mo)}function Oe(t,e){let r=t.$$;r.fragment!==null&&(hd(r.after_update),Xe(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function gd(t,e){t.$$.dirty[0]===-1&&(_r.push(t),ia(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ie(t,e,r,n,i,o,s,a=[-1]){let u=nn;on(t);let l=t.$$={fragment:null,ctx:[],props:o,update:he,not_equal:i,bound:qs(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:qs(),dirty:a,skip_bound:!1,root:e.target||u.$$.root};s&&s(l.root);let c=!1;if(l.ctx=r?r(t,e.props||{},(h,f,...d)=>{let _=d.length?d[0]:f;return l.ctx&&i(l.ctx[h],l.ctx[h]=_)&&(!l.skip_bound&&l.bound[h]&&l.bound[h](_),c&&gd(t,h)),f}):[],l.update(),c=!0,Xe(l.before_update),l.fragment=n?n(l.ctx):!1,e.target){if(e.hydrate){ud();let h=fd(e.target);l.fragment&&l.fragment.l(h),h.forEach(V)}else l.fragment&&l.fragment.c();e.intro&&ee(t.$$.fragment),Re(t,e.target,e.anchor,e.customElement),cd(),oa()}on(u)}var yd;typeof HTMLElement=="function"&&(yd=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(ao).filter(dr);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,r){this[t]=r}disconnectedCallback(){Xe(this.$$.on_disconnect)}$destroy(){Oe(this,1),this.$destroy=he}$on(t,e){if(!dr(e))return he;let r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{let n=r.indexOf(e);n!==-1&&r.splice(n,1)}}$set(t){this.$$set&&!Ys(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var Te=class{$destroy(){Oe(this,1),this.$destroy=he}$on(e,r){if(!dr(r))return he;let n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{let i=n.indexOf(r);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!Ys(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var $t=me(require("obsidian"));var wl=me(require("obsidian"));var yo=class{constructor(){this.handlers=new Map;this.disabled=[]}on(e,r,n){if(e.includes("@")||r.includes("@"))throw new Error("Invalid context/event name - Cannot contain @");this.handlers.set(`${e}@${r}`,n)}off(e,r){if(r)this.handlers.delete(`${e}@${r}`);else for(let[n]of this.handlers.entries())n.startsWith(`${e}@`)&&this.handlers.delete(n)}disable(e){this.enable(e),this.disabled.push(e)}enable(e){this.disabled=this.disabled.filter(r=>r!==e)}emit(e,...r){let n=[...this.handlers.entries()].filter(([i,o])=>!this.disabled.includes(i.split("@")[0]));for(let[i,o]of n)i.endsWith(`@${e}`)&&o(...r)}};var xr=[];function $n(t,e=he){let r,n=new Set;function i(a){if(Ae(t,a)&&(t=a,r)){let u=!xr.length;for(let l of n)l[1](),xr.push(l,t);if(u){for(let l=0;l<xr.length;l+=2)xr[l][0](xr[l+1]);xr.length=0}}}function o(a){i(a(t))}function s(a,u=he){let l=[a,u];return n.add(l),n.size===1&&(r=e(i)||he),a(t),()=>{n.delete(l),n.size===0&&r&&(r(),r=null)}}return{set:i,update:o,subscribe:s}}var U=me(require("obsidian"));var se=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,ye=Object.keys,Pe=Array.isArray;typeof Promise!="undefined"&&!se.Promise&&(se.Promise=Promise);function Le(t,e){return typeof e!="object"||ye(e).forEach(function(r){t[r]=e[r]}),t}var ln=Object.getPrototypeOf,_d={}.hasOwnProperty;function qe(t,e){return _d.call(t,e)}function wr(t,e){typeof e=="function"&&(e=e(ln(t))),(typeof Reflect=="undefined"?ye:Reflect.ownKeys)(e).forEach(r=>{ut(t,r,e[r])})}var sa=Object.defineProperty;function ut(t,e,r,n){sa(t,e,Le(r&&qe(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function jr(t){return{from:function(e){return t.prototype=Object.create(e.prototype),ut(t.prototype,"constructor",t),{extend:wr.bind(null,t.prototype)}}}}var vd=Object.getOwnPropertyDescriptor;function _o(t,e){let r=vd(t,e),n;return r||(n=ln(t))&&_o(n,e)}var bd=[].slice;function Wn(t,e,r){return bd.call(t,e,r)}function aa(t,e){return e(t)}function un(t){if(!t)throw new Error("Assertion Failed")}function la(t){se.setImmediate?setImmediate(t):setTimeout(t,0)}function ua(t,e){return t.reduce((r,n,i)=>{var o=e(n,i);return o&&(r[o[0]]=o[1]),r},{})}function xd(t,e,r){try{t.apply(null,r)}catch(n){e&&e(n)}}function ct(t,e){if(qe(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],n=0,i=e.length;n<i;++n){var o=ct(t,e[n]);r.push(o)}return r}var s=e.indexOf(".");if(s!==-1){var a=t[e.substr(0,s)];return a===void 0?void 0:ct(a,e.substr(s+1))}}function et(t,e,r){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){un(typeof r!="string"&&"length"in r);for(var n=0,i=e.length;n<i;++n)et(t,e[n],r[n])}else{var o=e.indexOf(".");if(o!==-1){var s=e.substr(0,o),a=e.substr(o+1);if(a==="")r===void 0?Pe(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=r;else{var u=t[s];(!u||!qe(t,s))&&(u=t[s]={}),et(u,a,r)}}else r===void 0?Pe(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function wd(t,e){typeof e=="string"?et(t,e,void 0):"length"in e&&[].map.call(e,function(r){et(t,r,void 0)})}function ca(t){var e={};for(var r in t)qe(t,r)&&(e[r]=t[r]);return e}var jd=[].concat;function fa(t){return jd.apply([],t)}var da="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(fa([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>se[t]),Ad=da.map(t=>se[t]);ua(da,t=>[t,!0]);var At=null;function cn(t){At=typeof WeakMap!="undefined"&&new WeakMap;let e=vo(t);return At=null,e}function vo(t){if(!t||typeof t!="object")return t;let e=At&&At.get(t);if(e)return e;if(Pe(t)){e=[],At&&At.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(vo(t[r]))}else if(Ad.indexOf(t.constructor)>=0)e=t;else{let o=ln(t);e=o===Object.prototype?{}:Object.create(o),At&&At.set(t,e);for(var i in t)qe(t,i)&&(e[i]=vo(t[i]))}return e}var{toString:Cd}={};function bo(t){return Cd.call(t).slice(8,-1)}var xo=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Sd=typeof xo=="symbol"?function(t){var e;return t!=null&&(e=t[xo])&&e.apply(t)}:function(){return null},Ar={};function ft(t){var e,r,n,i;if(arguments.length===1){if(Pe(t))return t.slice();if(this===Ar&&typeof t=="string")return[t];if(i=Sd(t)){for(r=[];n=i.next(),!n.done;)r.push(n.value);return r}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var wo=typeof Symbol!="undefined"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,rt=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pa(t,e){rt=t,ha=e}var ha=()=>!0,Ed=!new Error("").stack;function Qt(){if(Ed)try{throw Qt.arguments,new Error}catch(t){return t}return new Error}function jo(t,e){var r=t.stack;return r?(e=e||0,r.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),r.split(`
`).slice(e).filter(ha).map(n=>`
`+n).join("")):""}var Fd=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],ma=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ao=Fd.concat(ma),Td={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Cr(t,e){this._e=Qt(),this.name=t,this.message=e}jr(Cr).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+jo(this._e,2))}},toString:function(){return this.name+": "+this.message}});function ga(t,e){return t+". Errors: "+Object.keys(e).map(r=>e[r].toString()).filter((r,n,i)=>i.indexOf(r)===n).join(`
`)}function Un(t,e,r,n){this._e=Qt(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=ga(t,e)}jr(Un).from(Cr);function fn(t,e){this._e=Qt(),this.name="BulkError",this.failures=Object.keys(e).map(r=>e[r]),this.failuresByPos=e,this.message=ga(t,e)}jr(fn).from(Cr);var Co=Ao.reduce((t,e)=>(t[e]=e+"Error",t),{}),Dd=Cr,H=Ao.reduce((t,e)=>{var r=e+"Error";function n(i,o){this._e=Qt(),this.name=r,i?typeof i=="string"?(this.message=`${i}${o?`
 `+o:""}`,this.inner=o||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Td[e]||r,this.inner=null)}return jr(n).from(Dd),t[e]=n,t},{});H.Syntax=SyntaxError;H.Type=TypeError;H.Range=RangeError;var ya=ma.reduce((t,e)=>(t[e+"Error"]=H[e],t),{});function Od(t,e){if(!t||t instanceof Cr||t instanceof TypeError||t instanceof SyntaxError||!t.name||!ya[t.name])return t;var r=new ya[t.name](e||t.message,t);return"stack"in t&&ut(r,"stack",{get:function(){return this.inner.stack}}),r}var Gn=Ao.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=H[e]),t),{});Gn.ModifyError=Un;Gn.DexieError=Cr;Gn.BulkError=fn;function ie(){}function dn(t){return t}function Id(t,e){return t==null||t===dn?e:function(r){return e(t(r))}}function qt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Pd(t,e){return t===ie?e:function(){var r=t.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?qt(n,this.onsuccess):n),i&&(this.onerror=this.onerror?qt(i,this.onerror):i),o!==void 0?o:r}}function kd(t,e){return t===ie?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?qt(r,this.onsuccess):r),n&&(this.onerror=this.onerror?qt(n,this.onerror):n)}}function Md(t,e){return t===ie?e:function(r){var n=t.apply(this,arguments);Le(r,n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?qt(i,this.onsuccess):i),o&&(this.onerror=this.onerror?qt(o,this.onerror):o),n===void 0?s===void 0?void 0:s:Le(n,s)}}function Rd(t,e){return t===ie?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function So(t,e){return t===ie?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then(function(){return e.apply(n,o)})}return e.apply(this,arguments)}}var pn={},Ld=100,Nd=20,_a=100,[Eo,Qn,Fo]=typeof Promise=="undefined"?[]:(()=>{let t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,ln(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,ln(e),t]})(),va=Qn&&Qn.then,qn=Eo&&Eo.constructor,To=!!Fo,Do=!1,Bd=Fo?()=>{Fo.then(Zn)}:se.setImmediate?setImmediate.bind(null,Zn):se.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Zn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Zn,0)},hn=function(t,e){mn.push([t,e]),Yn&&(Bd(),Yn=!1)},Oo=!0,Yn=!0,Yt=[],Jn=[],Io=null,Po=dn,Sr={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ta,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Ta(t[0],t[1])}catch{}})}},K=Sr,mn=[],Jt=0,Xn=[];function R(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ie,this._lib=!1;var e=this._PSD=K;if(rt&&(this._stackHolder=Qt(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==pn)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Mo(this,this._value);return}this._state=null,this._value=null,++e.ref,xa(this,t)}var ko={get:function(){var t=K,e=ri;function r(n,i){var o=!t.global&&(t!==K||e!==ri);let s=o&&!dt();var a=new R((u,l)=>{Ro(this,new ba(ii(n,t,o,s),ii(i,t,o,s),u,l,t))});return rt&&Aa(a,this),a}return r.prototype=pn,r},set:function(t){ut(this,"then",t&&t.prototype===pn?ko:{get:function(){return t},set:ko.set})}};wr(R.prototype,{then:ko,_then:function(t,e){Ro(this,new ba(null,null,t,e,K))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],r=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?r(n):ei(n)):this.then(null,n=>n&&n.name===e?r(n):ei(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),ei(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Do=!0;var t=ja(this,[],Nd),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Do=!1}}},timeout:function(t,e){return t<1/0?new R((r,n)=>{var i=setTimeout(()=>n(new H.Timeout(e)),t);this.then(r,n).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&ut(R.prototype,Symbol.toStringTag,"Dexie.Promise");Sr.env=Ca();function ba(t,e,r,n,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=n,this.psd=i}wr(R,{all:function(){var t=ft.apply(null,arguments).map(ni);return new R(function(e,r){t.length===0&&e([]);var n=t.length;t.forEach((i,o)=>R.resolve(i).then(s=>{t[o]=s,--n||e(t)},r))})},resolve:t=>{if(t instanceof R)return t;if(t&&typeof t.then=="function")return new R((r,n)=>{t.then(r,n)});var e=new R(pn,!0,t);return Aa(e,Io),e},reject:ei,race:function(){var t=ft.apply(null,arguments).map(ni);return new R((e,r)=>{t.map(n=>R.resolve(n).then(e,r))})},PSD:{get:()=>K,set:t=>K=t},totalEchoes:{get:()=>ri},newPSD:Ct,usePSD:Fr,scheduler:{get:()=>hn,set:t=>{hn=t}},rejectionMapper:{get:()=>Po,set:t=>{Po=t}},follow:(t,e)=>new R((r,n)=>Ct((i,o)=>{var s=K;s.unhandleds=[],s.onunhandled=o,s.finalize=qt(function(){zd(()=>{this.unhandleds.length===0?i():o(this.unhandleds[0])})},s.finalize),t()},e,r,n))});qn&&(qn.allSettled&&ut(R,"allSettled",function(){let t=ft.apply(null,arguments).map(ni);return new R(e=>{t.length===0&&e([]);let r=t.length,n=new Array(r);t.forEach((i,o)=>R.resolve(i).then(s=>n[o]={status:"fulfilled",value:s},s=>n[o]={status:"rejected",reason:s}).then(()=>--r||e(n)))})}),qn.any&&typeof AggregateError!="undefined"&&ut(R,"any",function(){let t=ft.apply(null,arguments).map(ni);return new R((e,r)=>{t.length===0&&r(new AggregateError([]));let n=t.length,i=new Array(n);t.forEach((o,s)=>R.resolve(o).then(a=>e(a),a=>{i[s]=a,--n||r(new AggregateError(i))}))})}));function xa(t,e){try{e(r=>{if(t._state===null){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&gn();r&&typeof r.then=="function"?xa(t,(i,o)=>{r instanceof R?r._then(i,o):r.then(i,o)}):(t._state=!0,t._value=r,wa(t)),n&&yn()}},Mo.bind(null,t))}catch(r){Mo(t,r)}}function Mo(t,e){if(Jn.push(e),t._state===null){var r=t._lib&&gn();e=Po(e),t._state=!1,t._value=e,rt&&e!==null&&typeof e=="object"&&!e._promise&&xd(()=>{var n=_o(e,"stack");e._promise=t,ut(e,"stack",{get:()=>Do?n&&(n.get?n.get.apply(e):n.value):t.stack})}),Hd(t),wa(t),r&&yn()}}function wa(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)Ro(t,e[r]);var i=t._PSD;--i.ref||i.finalize(),Jt===0&&(++Jt,hn(()=>{--Jt==0&&Lo()},[]))}function Ro(t,e){if(t._state===null){t._listeners.push(e);return}var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Jt,hn(Kd,[r,t,e])}function Kd(t,e,r){try{Io=e;var n,i=e._value;e._state?n=t(i):(Jn.length&&(Jn=[]),n=t(i),Jn.indexOf(i)===-1&&Vd(e)),r.resolve(n)}catch(o){r.reject(o)}finally{Io=null,--Jt==0&&Lo(),--r.psd.ref||r.psd.finalize()}}function ja(t,e,r){if(e.length===r)return e;var n="";if(t._state===!1){var i=t._value,o,s;i!=null?(o=i.name||"Error",s=i.message||i,n=jo(i,0)):(o=i,s=""),e.push(o+(s?": "+s:"")+n)}return rt&&(n=jo(t._stackHolder,2),n&&e.indexOf(n)===-1&&e.push(n),t._prev&&ja(t._prev,e,r)),e}function Aa(t,e){var r=e?e._numPrev+1:0;r<Ld&&(t._prev=e,t._numPrev=r)}function Zn(){gn()&&yn()}function gn(){var t=Oo;return Oo=!1,Yn=!1,t}function yn(){var t,e,r;do for(;mn.length>0;)for(t=mn,mn=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}while(mn.length>0);Oo=!0,Yn=!0}function Lo(){var t=Yt;Yt=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=Xn.slice(0),r=e.length;r;)e[--r]()}function zd(t){function e(){t(),Xn.splice(Xn.indexOf(e),1)}Xn.push(e),++Jt,hn(()=>{--Jt==0&&Lo()},[])}function Hd(t){Yt.some(e=>e._value===t._value)||Yt.push(t)}function Vd(t){for(var e=Yt.length;e;)if(Yt[--e]._value===t._value){Yt.splice(e,1);return}}function ei(t){return new R(pn,!1,t)}function ue(t,e){var r=K;return function(){var n=gn(),i=K;try{return St(r,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{St(i,!1),n&&yn()}}}var ke={awaits:0,echoes:0,id:0},$d=0,ti=[],No=0,ri=0,Wd=0;function Ct(t,e,r,n){var i=K,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Wd;var s=Sr.env;o.env=To?{Promise:R,PromiseProp:{value:R,configurable:!0,writable:!0},all:R.all,race:R.race,allSettled:R.allSettled,any:R.any,resolve:R.resolve,reject:R.reject,nthen:Ea(s.nthen,o),gthen:Ea(s.gthen,o)}:{},e&&Le(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Fr(o,t,r,n);return o.ref===0&&o.finalize(),a}function Er(){return ke.id||(ke.id=++$d),++ke.awaits,ke.echoes+=_a,ke.id}function dt(){return ke.awaits?(--ke.awaits==0&&(ke.id=0),ke.echoes=ke.awaits*_a,!0):!1}(""+va).indexOf("[native code]")===-1&&(Er=dt=ie);function ni(t){return ke.echoes&&t&&t.constructor===qn?(Er(),t.then(e=>(dt(),e),e=>(dt(),xe(e)))):t}function Ud(t){++ri,(!ke.echoes||--ke.echoes==0)&&(ke.echoes=ke.id=0),ti.push(K),St(t,!0)}function Gd(){var t=ti[ti.length-1];ti.pop(),St(t,!1)}function St(t,e){var r=K;if((e?ke.echoes&&(!No++||t!==K):No&&(!--No||t!==K))&&Sa(e?Ud.bind(null,t):Gd),t!==K&&(K=t,r===Sr&&(Sr.env=Ca()),To)){var n=Sr.env.Promise,i=t.env;Qn.then=i.nthen,n.prototype.then=i.gthen,(r.global||t.global)&&(Object.defineProperty(se,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function Ca(){var t=se.Promise;return To?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(se,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Qn.then,gthen:t.prototype.then}:{}}function Fr(t,e,r,n,i){var o=K;try{return St(t,!0),e(r,n,i)}finally{St(o,!1)}}function Sa(t){va.call(Eo,t)}function ii(t,e,r,n){return typeof t!="function"?t:function(){var i=K;r&&Er(),St(e,!0);try{return t.apply(this,arguments)}finally{St(i,!1),n&&Sa(dt)}}}function Ea(t,e){return function(r,n){return t.call(this,ii(r,e),ii(n,e))}}var Fa="unhandledrejection";function Ta(t,e){var r;try{r=e.onuncatched(t)}catch{}if(r!==!1)try{var n,i={promise:e,reason:t};if(se.document&&document.createEvent?(n=document.createEvent("Event"),n.initEvent(Fa,!0,!0),Le(n,i)):se.CustomEvent&&(n=new CustomEvent(Fa,{detail:i}),Le(n,i)),n&&se.dispatchEvent&&(dispatchEvent(n),!se.PromiseRejectionEvent&&se.onunhandledrejection))try{se.onunhandledrejection(n)}catch{}rt&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var xe=R.reject;function Bo(t,e,r,n){if(!t.idbdb||!t._state.openComplete&&!K.letThrough&&!t._vip){if(t._state.openComplete)return xe(new H.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return xe(new H.DatabaseClosed);t.open().catch(ie)}return t._state.dbReadyPromise.then(()=>Bo(t,e,r,n))}else{var i=t._createTransaction(e,r,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===Co.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Bo(t,e,r,n))):xe(o)}return i._promise(e,(o,s)=>Ct(()=>(K.trans=i,n(o,s,i)))).then(o=>i._completion.then(()=>o))}}var Da="3.2.4",Xt=String.fromCharCode(65535),Ko=-1/0,pt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Oa="String expected.",_n=[],oi=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Qd=oi,qd=oi,Ia=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),si="__dbnames",zo="readonly",Ho="readwrite";function Zt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Pa={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ai(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=cn(e),delete e[t]),e):e=>e}var ka=class{_trans(e,r,n){let i=this._tx||K.trans,o=this.name;function s(u,l,c){if(!c.schema[o])throw new H.NotFound("Table "+o+" not part of transaction");return r(c.idbtrans,c)}let a=gn();try{return i&&i.db===this.db?i===K.trans?i._promise(e,s,n):Ct(()=>i._promise(e,s,n),{trans:i,transless:K.transless||K}):Bo(this.db,e,[this.name],s)}finally{a&&yn()}}get(e,r){return e&&e.constructor===Object?this.where(e).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(i=>this.hook.reading.fire(i))).then(r)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Pe(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let r=ye(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);let n=this.schema.indexes.concat(this.schema.primKey).filter(l=>l.compound&&r.every(c=>l.keyPath.indexOf(c)>=0)&&l.keyPath.every(c=>r.indexOf(c)>=0))[0];if(n&&this.db._maxKey!==Xt)return this.where(n.name).equals(n.keyPath.map(l=>e[l]));!n&&rt&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);let{idxByName:i}=this.schema,o=this.db._deps.indexedDB;function s(l,c){try{return o.cmp(l,c)===0}catch{return!1}}let[a,u]=r.reduce(([l,c],h)=>{let f=i[h],d=e[h];return[l||f,l||!f?Zt(c,f&&f.multi?_=>{let w=ct(_,h);return Pe(w)&&w.some(b=>s(d,b))}:_=>s(d,ct(_,h))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(u):n?this.filter(u):this.where(r).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Pe(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let r=n=>{if(!n)return n;let i=Object.create(e.prototype);for(var o in n)if(qe(n,o))try{i[o]=n[o]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e}defineClass(){function e(r){Le(this,r)}return this.mapToClass(e)}add(e,r){let{auto:n,keyPath:i}=this.schema.primKey,o=e;return i&&n&&(o=ai(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:r!=null?[r]:null,values:[o]})).then(s=>s.numFailures?R.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{et(e,i,s)}catch{}return s})}update(e,r){if(typeof e=="object"&&!Pe(e)){let n=ct(e,this.schema.primKey.keyPath);if(n===void 0)return xe(new H.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?ye(r).forEach(i=>{et(e,i,r[i])}):r(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}else return this.where(":id").equals(e).modify(r)}put(e,r){let{auto:n,keyPath:i}=this.schema.primKey,o=e;return i&&n&&(o=ai(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[o],keys:r!=null?[r]:null})).then(s=>s.numFailures?R.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{et(e,i,s)}catch{}return s})}delete(e){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[e]})).then(r=>r.numFailures?R.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Pa})).then(e=>e.numFailures?R.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",r=>this.core.getMany({keys:e,trans:r}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let o=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new H.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");let l=e.length,c=u&&a?e.map(ai(u)):e;return this.core.mutate({trans:s,type:"add",keys:i,values:c,wantResults:o}).then(({numFailures:h,results:f,lastResult:d,failures:_})=>{let w=o?f:d;if(h===0)return w;throw new fn(`${this.name}.bulkAdd(): ${h} of ${l} operations failed`,_)})})}bulkPut(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let o=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new H.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");let l=e.length,c=u&&a?e.map(ai(u)):e;return this.core.mutate({trans:s,type:"put",keys:i,values:c,wantResults:o}).then(({numFailures:h,results:f,lastResult:d,failures:_})=>{let w=o?f:d;if(h===0)return w;throw new fn(`${this.name}.bulkPut(): ${h} of ${l} operations failed`,_)})})}bulkDelete(e){let r=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:i,failures:o})=>{if(n===0)return i;throw new fn(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,o)})}};function vn(t){var e={},r=function(a,u){if(u){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return e[a].subscribe.apply(null,c),t}else if(typeof a=="string")return e[a]};r.addEventType=o;for(var n=1,i=arguments.length;n<i;++n)o(arguments[n]);return r;function o(a,u,l){if(typeof a=="object")return s(a);u||(u=Rd),l||(l=ie);var c={subscribers:[],fire:l,subscribe:function(h){c.subscribers.indexOf(h)===-1&&(c.subscribers.push(h),c.fire=u(c.fire,h))},unsubscribe:function(h){c.subscribers=c.subscribers.filter(function(f){return f!==h}),c.fire=c.subscribers.reduce(u,l)}};return e[a]=r[a]=c,c}function s(a){ye(a).forEach(function(u){var l=a[u];if(Pe(l))o(u,a[u][0],a[u][1]);else if(l==="asap")var c=o(u,dn,function(){for(var f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];c.subscribers.forEach(function(_){la(function(){_.apply(null,d)})})});else throw new H.InvalidArgument("Invalid event config")})}}function bn(t,e){return jr(e).from({prototype:t}),e}function Yd(t){return bn(ka.prototype,function(r,n,i){this.db=t,this._tx=i,this.name=r,this.schema=n,this.hook=t._allTables[r]?t._allTables[r].hook:vn(null,{creating:[Pd,ie],reading:[Id,dn],updating:[Md,ie],deleting:[kd,ie]})})}function Tr(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Vo(t,e){t.filter=Zt(t.filter,e)}function $o(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>Zt(n(),e()):e,t.justLimit=r&&!n}function Jd(t,e){t.isMatch=Zt(t.isMatch,e)}function li(t,e){if(t.isPrimKey)return e.primaryKey;let r=e.getIndexByKeyPath(t.index);if(!r)throw new H.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function Ma(t,e,r){let n=li(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function ui(t,e,r,n){let i=t.replayFilter?Zt(t.filter,t.replayFilter()):t.filter;if(t.or){let o={},s=(a,u,l)=>{if(!i||i(u,l,f=>u.stop(f),f=>u.fail(f))){var c=u.primaryKey,h=""+c;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(c)),qe(o,h)||(o[h]=!0,e(a,u,l))}};return Promise.all([t.or._iterate(s,r),Ra(Ma(t,n,r),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}else return Ra(Ma(t,n,r),Zt(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Ra(t,e,r,n){var i=n?(s,a,u)=>r(n(s),a,u):r,o=ue(i);return t.then(s=>{if(s)return s.start(()=>{var a=()=>s.continue();(!e||e(s,u=>a=u,u=>{s.stop(u),a=ie},u=>{s.fail(u),a=ie}))&&o(s.value,s,u=>a=u),a()})})}function Ne(t,e){try{let r=La(t),n=La(e);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Zd(Na(t),Na(e));case"Array":return Xd(t,e)}}catch{}return NaN}function Xd(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let o=0;o<i;++o){let s=Ne(t[o],e[o]);if(s!==0)return s}return r===n?0:r<n?-1:1}function Zd(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let o=0;o<i;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return r===n?0:r<n?-1:1}function La(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let r=bo(t);return r==="ArrayBuffer"?"binary":r}function Na(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Ba=class{_read(e,r){var n=this._ctx;return n.error?n.table._trans(null,xe.bind(null,n.error)):n.table._trans("readonly",e).then(r)}_write(e){var r=this._ctx;return r.error?r.table._trans(null,xe.bind(null,r.error)):r.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var r=this._ctx;r.algorithm=Zt(r.algorithm,e)}_iterate(e,r){return ui(this._ctx,e,r,this._ctx.table.core)}clone(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Le(n,e),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(e){var r=this._ctx;return this._read(n=>ui(r,e,n,r.table.core))}count(e){return this._read(r=>{let n=this._ctx,i=n.table.core;if(Tr(n,!0))return i.count({trans:r,query:{index:li(n,i.schema),range:n.range}}).then(s=>Math.min(s,n.limit));var o=0;return ui(n,()=>(++o,!1),r,i).then(()=>o)}).then(e)}sortBy(e,r){let n=e.split(".").reverse(),i=n[0],o=n.length-1;function s(l,c){return c?s(l[n[c]],c-1):l[i]}var a=this._ctx.dir==="next"?1:-1;function u(l,c){var h=s(l,o),f=s(c,o);return h<f?-a:h>f?a:0}return this.toArray(function(l){return l.sort(u)}).then(r)}toArray(e){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&Tr(n,!0)&&n.limit>0){let{valueMapper:i}=n,o=li(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then(({result:s})=>i?s.map(i):s)}else{let i=[];return ui(n,o=>i.push(o),r,n.table.core).then(()=>i)}},e)}offset(e){var r=this._ctx;return e<=0?this:(r.offset+=e,Tr(r)?$o(r,()=>{var n=e;return(i,o)=>n===0?!0:n===1?(--n,!1):(o(()=>{i.advance(n),n=0}),!1)}):$o(r,()=>{var n=e;return()=>--n<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),$o(this._ctx,()=>{var r=e;return function(n,i,o){return--r<=0&&i(o),r>=0}},!0),this}until(e,r){return Vo(this._ctx,function(n,i,o){return e(n.value)?(i(o),r):!0}),this}first(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return Vo(this._ctx,function(r){return e(r.value)}),Jd(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})}keys(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.key)}).then(function(){return n}).then(e)}primaryKeys(e){var r=this._ctx;if(r.dir==="next"&&Tr(r,!0)&&r.limit>0)return this._read(i=>{var o=li(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(({result:i})=>i).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(r){return r[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var n={};return Vo(this._ctx,function(i){var o=i.primaryKey.toString(),s=qe(n,o);return n[o]=!0,!s}),this}modify(e){var r=this._ctx;return this._write(n=>{var i;if(typeof e=="function")i=e;else{var o=ye(e),s=o.length;i=function(w){for(var b=!1,p=0;p<s;++p){var x=o[p],m=e[x];ct(w,x)!==m&&(et(w,x,m),b=!0)}return b}}let a=r.table.core,{outbound:u,extractKey:l}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,h=[],f=0,d=[],_=(w,b)=>{let{failures:p,numFailures:x}=b;f+=w-x;for(let m of ye(p))h.push(p[m])};return this.clone().primaryKeys().then(w=>{let b=p=>{let x=Math.min(c,w.length-p);return a.getMany({trans:n,keys:w.slice(p,p+x),cache:"immutable"}).then(m=>{let g=[],y=[],v=u?[]:null,j=[];for(let E=0;E<x;++E){let T=m[E],I={value:cn(T),primKey:w[p+E]};i.call(I,I.value,I)!==!1&&(I.value==null?j.push(w[p+E]):!u&&Ne(l(T),l(I.value))!==0?(j.push(w[p+E]),g.push(I.value)):(y.push(I.value),u&&v.push(w[p+E])))}let A=Tr(r)&&r.limit===1/0&&(typeof e!="function"||e===Wo)&&{index:r.index,range:r.range};return Promise.resolve(g.length>0&&a.mutate({trans:n,type:"add",values:g}).then(E=>{for(let T in E.failures)j.splice(parseInt(T),1);_(g.length,E)})).then(()=>(y.length>0||A&&typeof e=="object")&&a.mutate({trans:n,type:"put",keys:v,values:y,criteria:A,changeSpec:typeof e!="function"&&e}).then(E=>_(y.length,E))).then(()=>(j.length>0||A&&e===Wo)&&a.mutate({trans:n,type:"delete",keys:j,criteria:A}).then(E=>_(j.length,E))).then(()=>w.length>p+x&&b(p+c))})};return b(0).then(()=>{if(h.length>0)throw new Un("Error modifying one or more objects",h,f,d);return w.length})})})}delete(){var e=this._ctx,r=e.range;return Tr(e)&&(e.isPrimKey&&!qd||r.type===3)?this._write(n=>{let{primaryKey:i}=e.table.core.schema,o=r;return e.table.core.count({trans:n,query:{index:i,range:o}}).then(s=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(({failures:a,lastResult:u,results:l,numFailures:c})=>{if(c)throw new Un("Could not delete some values",Object.keys(a).map(h=>a[h]),s-c);return s-c}))}):this.modify(Wo)}},Wo=(t,e)=>e.value=null;function ep(t){return bn(Ba.prototype,function(r,n){this.db=t;let i=Pa,o=null;if(n)try{i=n()}catch(l){o=l}let s=r._ctx,a=s.table,u=a.hook.reading.fire;this._ctx={table:a,index:s.index,isPrimKey:!s.index||a.schema.primKey.keyPath&&s.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:o,or:s.or,valueMapper:u!==dn?u:null}})}function tp(t,e){return t<e?-1:t===e?0:1}function rp(t,e){return t>e?-1:t===e?0:1}function Ye(t,e,r){var n=t instanceof Uo?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function Dr(t){return new t.Collection(t,()=>Ka("")).limit(0)}function np(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function ip(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function op(t,e,r,n,i,o){for(var s=Math.min(t.length,n.length),a=-1,u=0;u<s;++u){var l=e[u];if(l!==n[u])return i(t[u],r[u])<0?t.substr(0,u)+r[u]+r.substr(u+1):i(t[u],n[u])<0?t.substr(0,u)+n[u]+r.substr(u+1):a>=0?t.substr(0,a)+e[a]+r.substr(a+1):null;i(t[u],l)<0&&(a=u)}return s<n.length&&o==="next"?t+r.substr(t.length):s<t.length&&o==="prev"?t.substr(0,r.length):a<0?null:t.substr(0,a)+n[a]+r.substr(a+1)}function ci(t,e,r,n){var i,o,s,a,u,l,c,h=r.length;if(!r.every(w=>typeof w=="string"))return Ye(t,Oa);function f(w){i=np(w),o=ip(w),s=w==="next"?tp:rp;var b=r.map(function(p){return{lower:o(p),upper:i(p)}}).sort(function(p,x){return s(p.lower,x.lower)});a=b.map(function(p){return p.upper}),u=b.map(function(p){return p.lower}),l=w,c=w==="next"?"":n}f("next");var d=new t.Collection(t,()=>Et(a[0],u[h-1]+n));d._ondirectionchange=function(w){f(w)};var _=0;return d._addAlgorithm(function(w,b,p){var x=w.key;if(typeof x!="string")return!1;var m=o(x);if(e(m,u,_))return!0;for(var g=null,y=_;y<h;++y){var v=op(x,m,a[y],u[y],s,l);v===null&&g===null?_=y+1:(g===null||s(g,v)>0)&&(g=v)}return b(g!==null?function(){w.continue(g+c)}:p),!1}),d}function Et(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function Ka(t){return{type:1,lower:t,upper:t}}var Uo=class{get Collection(){return this._ctx.table.db.Collection}between(e,r,n,i){n=n!==!1,i=i===!0;try{return this._cmp(e,r)>0||this._cmp(e,r)===0&&(n||i)&&!(n&&i)?Dr(this):new this.Collection(this,()=>Et(e,r,!n,!i))}catch{return Ye(this,pt)}}equals(e){return e==null?Ye(this,pt):new this.Collection(this,()=>Ka(e))}above(e){return e==null?Ye(this,pt):new this.Collection(this,()=>Et(e,void 0,!0))}aboveOrEqual(e){return e==null?Ye(this,pt):new this.Collection(this,()=>Et(e,void 0,!1))}below(e){return e==null?Ye(this,pt):new this.Collection(this,()=>Et(void 0,e,!1,!0))}belowOrEqual(e){return e==null?Ye(this,pt):new this.Collection(this,()=>Et(void 0,e))}startsWith(e){return typeof e!="string"?Ye(this,Oa):this.between(e,e+Xt,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):ci(this,(r,n)=>r.indexOf(n[0])===0,[e],Xt)}equalsIgnoreCase(e){return ci(this,(r,n)=>r===n[0],[e],"")}anyOfIgnoreCase(){var e=ft.apply(Ar,arguments);return e.length===0?Dr(this):ci(this,(r,n)=>n.indexOf(r)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=ft.apply(Ar,arguments);return e.length===0?Dr(this):ci(this,(r,n)=>n.some(i=>r.indexOf(i)===0),e,Xt)}anyOf(){let e=ft.apply(Ar,arguments),r=this._cmp;try{e.sort(r)}catch{return Ye(this,pt)}if(e.length===0)return Dr(this);let n=new this.Collection(this,()=>Et(e[0],e[e.length-1]));n._ondirectionchange=o=>{r=o==="next"?this._ascending:this._descending,e.sort(r)};let i=0;return n._addAlgorithm((o,s,a)=>{let u=o.key;for(;r(u,e[i])>0;)if(++i,i===e.length)return s(a),!1;return r(u,e[i])===0?!0:(s(()=>{o.continue(e[i])}),!1)}),n}notEqual(e){return this.inAnyRange([[Ko,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=ft.apply(Ar,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ye(this,pt)}let r=e.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[Ko,i]],null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,r){let n=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(e.length===0)return Dr(this);if(!e.every(g=>g[0]!==void 0&&g[1]!==void 0&&i(g[0],g[1])<=0))return Ye(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",H.InvalidArgument);let u=!r||r.includeLowers!==!1,l=r&&r.includeUppers===!0;function c(g,y){let v=0,j=g.length;for(;v<j;++v){let A=g[v];if(n(y[0],A[1])<0&&n(y[1],A[0])>0){A[0]=s(A[0],y[0]),A[1]=a(A[1],y[1]);break}}return v===j&&g.push(y),g}let h=i;function f(g,y){return h(g[0],y[0])}let d;try{d=e.reduce(c,[]),d.sort(f)}catch{return Ye(this,pt)}let _=0,w=l?g=>i(g,d[_][1])>0:g=>i(g,d[_][1])>=0,b=u?g=>o(g,d[_][0])>0:g=>o(g,d[_][0])>=0;function p(g){return!w(g)&&!b(g)}let x=w,m=new this.Collection(this,()=>Et(d[0][0],d[d.length-1][1],!u,!l));return m._ondirectionchange=g=>{g==="next"?(x=w,h=i):(x=b,h=o),d.sort(f)},m._addAlgorithm((g,y,v)=>{for(var j=g.key;x(j);)if(++_,_===d.length)return y(v),!1;return p(j)?!0:(this._cmp(j,d[_][1])===0||this._cmp(j,d[_][0])===0||y(()=>{h===i?g.continue(d[_][0]):g.continue(d[_][1])}),!1)}),m}startsWithAnyOf(){let e=ft.apply(Ar,arguments);return e.every(r=>typeof r=="string")?e.length===0?Dr(this):this.inAnyRange(e.map(r=>[r,r+Xt])):Ye(this,"startsWithAnyOf() only works with strings")}};function sp(t){return bn(Uo.prototype,function(r,n,i){this.db=t,this._ctx={table:r,index:n===":id"?null:n,or:i};let o=t._deps.indexedDB;if(!o)throw new H.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=(s,a)=>o.cmp(a,s),this._max=(s,a)=>o.cmp(s,a)>0?s:a,this._min=(s,a)=>o.cmp(s,a)<0?s:a,this._IDBKeyRange=t._deps.IDBKeyRange})}function nt(t){return ue(function(e){return xn(e),t(e.target.error),!1})}function xn(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var wn="storagemutated",Ft="x-storagemutated-1",Tt=vn(null,wn),za=class{_lock(){return un(!K.global),++this._reculock,this._reculock===1&&!K.global&&(K.lockOwnerFor=this),this}_unlock(){if(un(!K.global),--this._reculock==0)for(K.global||(K.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Fr(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&K.lockOwnerFor!==this}create(e){if(!this.mode)return this;let r=this.db.idbdb,n=this.db._state.dbOpenError;if(un(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new H.DatabaseClosed(n);case"MissingAPIError":throw new H.MissingAPI(n.message,n);default:throw new H.OpenFailed(n)}if(!this.active)throw new H.TransactionInactive;return un(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=ue(i=>{xn(i),this._reject(e.error)}),e.onabort=ue(i=>{xn(i),this.active&&this._reject(new H.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=ue(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Tt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,r,n){if(e==="readwrite"&&this.mode!=="readwrite")return xe(new H.ReadOnly("Transaction is readonly"));if(!this.active)return xe(new H.TransactionInactive);if(this._locked())return new R((o,s)=>{this._blockedFuncs.push([()=>{this._promise(e,r,n).then(o,s)},K])});if(n)return Ct(()=>{var o=new R((s,a)=>{this._lock();let u=r(s,a,this);u&&u.then&&u.then(s,a)});return o.finally(()=>this._unlock()),o._lib=!0,o});var i=new R((o,s)=>{var a=r(o,s,this);a&&a.then&&a.then(o,s)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var r=this._root();let n=R.resolve(e);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function s(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=s)})()}var o=r._waitingFor;return new R((s,a)=>{n.then(u=>r._waitingQueue.push(ue(s.bind(null,u))),u=>r._waitingQueue.push(ue(a.bind(null,u)))).finally(()=>{r._waitingFor===o&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new H.Abort))}table(e){let r=this._memoizedTables||(this._memoizedTables={});if(qe(r,e))return r[e];let n=this.schema[e];if(!n)throw new H.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,n,this);return i.core=this.db.core.table(e),r[e]=i,i}};function ap(t){return bn(za.prototype,function(r,n,i,o,s){this.db=t,this.mode=r,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=vn(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new R((a,u)=>{this._resolve=a,this._reject=u}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var u=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):u&&this.idbtrans&&this.idbtrans.abort(),xe(a)})})}function Go(t,e,r,n,i,o,s){return{name:t,keyPath:e,unique:r,multi:n,auto:i,compound:o,src:(r&&!s?"&":"")+(n?"*":"")+(i?"++":"")+Ha(e)}}function Ha(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Va(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:ua(r,n=>[n.name,n])}}function lp(t){return t.length===1?t[0]:t}var jn=t=>{try{return t.only([[]]),jn=()=>[[]],[[]]}catch{return jn=()=>Xt,Xt}};function Qo(t){return t==null?()=>{}:typeof t=="string"?up(t):e=>ct(e,t)}function up(t){return t.split(".").length===1?r=>r[t]:r=>ct(r,t)}function $a(t){return[].slice.call(t)}var cp=0;function An(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function fp(t,e,r){function n(c,h){let f=$a(c.objectStoreNames);return{schema:{name:c.name,tables:f.map(d=>h.objectStore(d)).map(d=>{let{keyPath:_,autoIncrement:w}=d,b=Pe(_),p=_==null,x={},m={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:b,keyPath:_,autoIncrement:w,unique:!0,extractKey:Qo(_)},indexes:$a(d.indexNames).map(g=>d.index(g)).map(g=>{let{name:y,unique:v,multiEntry:j,keyPath:A}=g,E=Pe(A),T={name:y,compound:E,keyPath:A,unique:v,multiEntry:j,extractKey:Qo(A)};return x[An(A)]=T,T}),getIndexByKeyPath:g=>x[An(g)]};return x[":id"]=m.primaryKey,_!=null&&(x[An(_)]=m.primaryKey),m})},hasGetAll:f.length>0&&"getAll"in h.objectStore(f[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:h,upper:f,lowerOpen:d,upperOpen:_}=c;return h===void 0?f===void 0?null:e.upperBound(f,!!_):f===void 0?e.lowerBound(h,!!d):e.bound(h,f,!!d,!!_)}function o(c){let h=c.name;function f({trans:w,type:b,keys:p,values:x,range:m}){return new Promise((g,y)=>{g=ue(g);let v=w.objectStore(h),j=v.keyPath==null,A=b==="put"||b==="add";if(!A&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);let{length:E}=p||x||{length:1};if(p&&x&&p.length!==x.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let T,I=[],L=[],P=0,z=Y=>{++P,xn(Y)};if(b==="deleteRange"){if(m.type===4)return g({numFailures:P,failures:L,results:[],lastResult:void 0});m.type===3?I.push(T=v.clear()):I.push(T=v.delete(i(m)))}else{let[Y,q]=A?j?[x,p]:[x,null]:[p,null];if(A)for(let C=0;C<E;++C)I.push(T=q&&q[C]!==void 0?v[b](Y[C],q[C]):v[b](Y[C])),T.onerror=z;else for(let C=0;C<E;++C)I.push(T=v[b](Y[C])),T.onerror=z}let J=Y=>{let q=Y.target.result;I.forEach((C,S)=>C.error!=null&&(L[S]=C.error)),g({numFailures:P,failures:L,results:b==="delete"?p:I.map(C=>C.result),lastResult:q})};T.onerror=Y=>{z(Y),J(Y)},T.onsuccess=J})}function d({trans:w,values:b,query:p,reverse:x,unique:m}){return new Promise((g,y)=>{g=ue(g);let{index:v,range:j}=p,A=w.objectStore(h),E=v.isPrimaryKey?A:A.index(v.name),T=x?m?"prevunique":"prev":m?"nextunique":"next",I=b||!("openKeyCursor"in E)?E.openCursor(i(j),T):E.openKeyCursor(i(j),T);I.onerror=nt(y),I.onsuccess=ue(L=>{let P=I.result;if(!P){g(null);return}P.___id=++cp,P.done=!1;let z=P.continue.bind(P),J=P.continuePrimaryKey;J&&(J=J.bind(P));let Y=P.advance.bind(P),q=()=>{throw new Error("Cursor not started")},C=()=>{throw new Error("Cursor not stopped")};P.trans=w,P.stop=P.continue=P.continuePrimaryKey=P.advance=q,P.fail=ue(y),P.next=function(){let S=1;return this.start(()=>S--?this.continue():this.stop()).then(()=>this)},P.start=S=>{let O=new Promise((X,k)=>{X=ue(X),I.onerror=nt(k),P.fail=k,P.stop=re=>{P.stop=P.continue=P.continuePrimaryKey=P.advance=C,X(re)}}),B=()=>{if(I.result)try{S()}catch(X){P.fail(X)}else P.done=!0,P.start=()=>{throw new Error("Cursor behind last entry")},P.stop()};return I.onsuccess=ue(X=>{I.onsuccess=B,B()}),P.continue=z,P.continuePrimaryKey=J,P.advance=Y,B(),O},g(P)},y)})}function _(w){return b=>new Promise((p,x)=>{p=ue(p);let{trans:m,values:g,limit:y,query:v}=b,j=y===1/0?void 0:y,{index:A,range:E}=v,T=m.objectStore(h),I=A.isPrimaryKey?T:T.index(A.name),L=i(E);if(y===0)return p({result:[]});if(w){let P=g?I.getAll(L,j):I.getAllKeys(L,j);P.onsuccess=z=>p({result:z.target.result}),P.onerror=nt(x)}else{let P=0,z=g||!("openKeyCursor"in I)?I.openCursor(L):I.openKeyCursor(L),J=[];z.onsuccess=Y=>{let q=z.result;if(!q)return p({result:J});if(J.push(g?q.value:q.primaryKey),++P===y)return p({result:J});q.continue()},z.onerror=nt(x)}})}return{name:h,schema:c,mutate:f,getMany({trans:w,keys:b}){return new Promise((p,x)=>{p=ue(p);let m=w.objectStore(h),g=b.length,y=new Array(g),v=0,j=0,A,E=I=>{let L=I.target;(y[L._pos]=L.result)!=null,++j===v&&p(y)},T=nt(x);for(let I=0;I<g;++I)b[I]!=null&&(A=m.get(b[I]),A._pos=I,A.onsuccess=E,A.onerror=T,++v);v===0&&p(y)})},get({trans:w,key:b}){return new Promise((p,x)=>{p=ue(p);let g=w.objectStore(h).get(b);g.onsuccess=y=>p(y.target.result),g.onerror=nt(x)})},query:_(a),openCursor:d,count({query:w,trans:b}){let{index:p,range:x}=w;return new Promise((m,g)=>{let y=b.objectStore(h),v=p.isPrimaryKey?y:y.index(p.name),j=i(x),A=j?v.count(j):v.count();A.onsuccess=ue(E=>m(E.target.result)),A.onerror=nt(g)})}}}let{schema:s,hasGetAll:a}=n(t,r),u=s.tables.map(c=>o(c)),l={};return u.forEach(c=>l[c.name]=c),{stack:"dbcore",transaction:t.transaction.bind(t),table(c){if(!l[c])throw new Error(`Table '${c}' not found`);return l[c]},MIN_KEY:-1/0,MAX_KEY:jn(e),schema:s}}function dp(t,e){return e.reduce((r,{create:n})=>pe(pe({},r),n(r)),t)}function pp(t,e,{IDBKeyRange:r,indexedDB:n},i){return{dbcore:dp(fp(e,r,i),t.dbcore)}}function qo({_novip:t},e){let r=e.db,n=pp(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach(i=>{let o=i.name;t.core.schema.tables.some(s=>s.name===o)&&(i.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=i.core))})}function fi({_novip:t},e,r,n){r.forEach(i=>{let o=n[i];e.forEach(s=>{let a=_o(s,i);(!a||"value"in a&&a.value===void 0)&&(s===t.Transaction.prototype||s instanceof t.Transaction?ut(s,i,{get(){return this.table(i)},set(u){sa(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new t.Table(i,o))})})}function Yo({_novip:t},e){e.forEach(r=>{for(let n in r)r[n]instanceof t.Table&&delete r[n]})}function hp(t,e){return t._cfg.version-e._cfg.version}function mp(t,e,r,n){let i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(r),o._completion.catch(n);let s=o._reject.bind(o),a=K.transless||K;Ct(()=>{K.trans=o,K.transless=a,e===0?(ye(i).forEach(u=>{Jo(r,u,i[u].primKey,i[u].indexes)}),qo(t,r),R.follow(()=>t.on.populate.fire(o)).catch(s)):gp(t,e,o,r).catch(s)})}function gp({_novip:t},e,r,n){let i=[],o=t._versions,s=t._dbSchema=Zo(t,t.idbdb,n),a=!1;o.filter(c=>c._cfg.version>=e).forEach(c=>{i.push(()=>{let h=s,f=c._cfg.dbschema;es(t,h,n),es(t,f,n),s=t._dbSchema=f;let d=Wa(h,f);d.add.forEach(w=>{Jo(n,w[0],w[1].primKey,w[1].indexes)}),d.change.forEach(w=>{if(w.recreate)throw new H.Upgrade("Not yet support for changing primary key");{let b=n.objectStore(w.name);w.add.forEach(p=>Xo(b,p)),w.change.forEach(p=>{b.deleteIndex(p.name),Xo(b,p)}),w.del.forEach(p=>b.deleteIndex(p))}});let _=c._cfg.contentUpgrade;if(_&&c._cfg.version>e){qo(t,n),r._memoizedTables={},a=!0;let w=ca(f);d.del.forEach(m=>{w[m]=h[m]}),Yo(t,[t.Transaction.prototype]),fi(t,[t.Transaction.prototype],ye(w),w),r.schema=w;let b=wo(_);b&&Er();let p,x=R.follow(()=>{if(p=_(r),p&&b){var m=dt.bind(null,null);p.then(m,m)}});return p&&typeof p.then=="function"?R.resolve(p):x.then(()=>p)}}),i.push(h=>{if(!a||!Qd){let f=c._cfg.dbschema;_p(f,h)}Yo(t,[t.Transaction.prototype]),fi(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),r.schema=t._dbSchema})});function l(){return i.length?R.resolve(i.shift()(r.idbtrans)).then(l):R.resolve()}return l().then(()=>{yp(s,n)})}function Wa(t,e){let r={del:[],add:[],change:[]},n;for(n in t)e[n]||r.del.push(n);for(n in e){let i=t[n],o=e[n];if(!i)r.add.push([n,o]);else{let s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!oi)s.recreate=!0,r.change.push(s);else{let a=i.idxByName,u=o.idxByName,l;for(l in a)u[l]||s.del.push(l);for(l in u){let c=a[l],h=u[l];c?c.src!==h.src&&s.change.push(h):s.add.push(h)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}}return r}function Jo(t,e,r,n){let i=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(o=>Xo(i,o)),i}function yp(t,e){ye(t).forEach(r=>{e.db.objectStoreNames.contains(r)||Jo(e,r,t[r].primKey,t[r].indexes)})}function _p(t,e){[].slice.call(e.db.objectStoreNames).forEach(r=>t[r]==null&&e.db.deleteObjectStore(r))}function Xo(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Zo(t,e,r){let n={};return Wn(e.objectStoreNames,0).forEach(o=>{let s=r.objectStore(o),a=s.keyPath,u=Go(Ha(a),a||"",!1,!1,!!s.autoIncrement,a&&typeof a!="string",!0),l=[];for(let h=0;h<s.indexNames.length;++h){let f=s.index(s.indexNames[h]);a=f.keyPath;var c=Go(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&typeof a!="string",!1);l.push(c)}n[o]=Va(o,u,l)}),n}function vp({_novip:t},e,r){t.verno=e.version/10;let n=t._dbSchema=Zo(t,e,r);t._storeNames=Wn(e.objectStoreNames,0),fi(t,[t._allTables],ye(n),n)}function bp(t,e){let r=Zo(t,t.idbdb,e),n=Wa(r,t._dbSchema);return!(n.add.length||n.change.some(i=>i.add.length||i.change.length))}function es({_novip:t},e,r){let n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){let o=n[i],s=r.objectStore(o);t._hasGetAll="getAll"in s;for(let a=0;a<s.indexNames.length;++a){let u=s.indexNames[a],l=s.index(u).keyPath,c=typeof l=="string"?l:"["+Wn(l).join("+")+"]";if(e[o]){let h=e[o].idxByName[c];h&&(h.name=u,delete e[o].idxByName[c],e[o].idxByName[u]=h)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&se.WorkerGlobalScope&&se instanceof se.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function xp(t){return t.split(",").map((e,r)=>{e=e.trim();let n=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Go(n,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Pe(i),r===0)})}var Ua=class{_parseStoresSpec(e,r){ye(e).forEach(n=>{if(e[n]!==null){var i=xp(e[n]),o=i.shift();if(o.multi)throw new H.Schema("Primary key cannot be multi-valued");i.forEach(s=>{if(s.auto)throw new H.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new H.Schema("Index must have a name and cannot be an empty string")}),r[n]=Va(n,o,i)}})}stores(e){let r=this.db;this._cfg.storesSource=this._cfg.storesSource?Le(this._cfg.storesSource,e):e;let n=r._versions,i={},o={};return n.forEach(s=>{Le(i,s._cfg.storesSource),o=s._cfg.dbschema={},s._parseStoresSpec(i,o)}),r._dbSchema=o,Yo(r,[r._allTables,r,r.Transaction.prototype]),fi(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],ye(o),o),r._storeNames=ye(o),this}upgrade(e){return this._cfg.contentUpgrade=So(this._cfg.contentUpgrade||ie,e),this}};function wp(t){return bn(Ua.prototype,function(r){this.db=t,this._cfg={version:r,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function ts(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new mt(si,{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function rs(t){return t&&typeof t.databases=="function"}function jp({indexedDB:t,IDBKeyRange:e}){return rs(t)?Promise.resolve(t.databases()).then(r=>r.map(n=>n.name).filter(n=>n!==si)):ts(t,e).toCollection().primaryKeys()}function Ap({indexedDB:t,IDBKeyRange:e},r){!rs(t)&&r!==si&&ts(t,e).put({name:r}).catch(ie)}function Cp({indexedDB:t,IDBKeyRange:e},r){!rs(t)&&r!==si&&ts(t,e).delete(r).catch(ie)}function ns(t){return Ct(function(){return K.letThrough=!0,t()})}function Sp(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(r){var n=function(){return indexedDB.databases().finally(r)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)})}function Ep(t){let e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?xe(e.dbOpenError):t);rt&&(e.openCanceller._stackHolder=Qt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let n=e.openCanceller;function i(){if(e.openCanceller!==n)throw new H.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,s=null,a=!1;return R.race([n,(typeof navigator=="undefined"?R.resolve():Sp()).then(()=>new R((u,l)=>{if(i(),!r)throw new H.MissingAPI;let c=t.name,h=e.autoSchema?r.open(c):r.open(c,Math.round(t.verno*10));if(!h)throw new H.MissingAPI;h.onerror=nt(l),h.onblocked=ue(t._fireOnBlocked),h.onupgradeneeded=ue(f=>{if(s=h.transaction,e.autoSchema&&!t._options.allowEmptyDB){h.onerror=xn,s.abort(),h.result.close();let _=r.deleteDatabase(c);_.onsuccess=_.onerror=ue(()=>{l(new H.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{s.onerror=nt(l);var d=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=d<1,t._novip.idbdb=h.result,mp(t,d/10,s,l)}},l),h.onsuccess=ue(()=>{s=null;let f=t._novip.idbdb=h.result,d=Wn(f.objectStoreNames);if(d.length>0)try{let _=f.transaction(lp(d),"readonly");e.autoSchema?vp(t,f,_):(es(t,t._dbSchema,_),bp(t,_)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),qo(t,_)}catch{}_n.push(t),f.onversionchange=ue(_=>{e.vcFired=!0,t.on("versionchange").fire(_)}),f.onclose=ue(_=>{t.on("close").fire(_)}),a&&Ap(t._deps,c),u()},l)}))]).then(()=>(i(),e.onReadyBeingFired=[],R.resolve(ns(()=>t.on.ready.fire(t.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let l=e.onReadyBeingFired.reduce(So,ie);return e.onReadyBeingFired=[],R.resolve(ns(()=>l(t.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(u=>{e.dbOpenError=u;try{s&&s.abort()}catch{}return n===e.openCanceller&&t._close(),xe(u)}).finally(()=>{e.openComplete=!0,o()})}function is(t){var e=s=>t.next(s),r=s=>t.throw(s),n=o(e),i=o(r);function o(s){return a=>{var u=s(a),l=u.value;return u.done?l:!l||typeof l.then!="function"?Pe(l)?Promise.all(l).then(n,i):n(l):l.then(n,i)}}return o(e)()}function Fp(t,e,r){var n=arguments.length;if(n<2)throw new H.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var o=fa(i);return[t,o,r]}function Ga(t,e,r,n,i){return R.resolve().then(()=>{let o=K.transless||K,s=t._createTransaction(e,r,t._dbSchema,n),a={trans:s,transless:o};if(n)s.idbtrans=n.idbtrans;else try{s.create(),t._state.PR1398_maxLoop=3}catch(h){return h.name===Co.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Ga(t,e,r,null,i))):xe(h)}let u=wo(i);u&&Er();let l,c=R.follow(()=>{if(l=i.call(s,s),l)if(u){var h=dt.bind(null,null);l.then(h,h)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=is(l))},a);return(l&&typeof l.then=="function"?R.resolve(l).then(h=>s.active?h:xe(new H.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>l)).then(h=>(n&&s._resolve(),s._completion.then(()=>h))).catch(h=>(s._reject(h),xe(h)))})}function di(t,e,r){let n=Pe(t)?t.slice():[t];for(let i=0;i<r;++i)n.push(e);return n}function Tp(t){return Me(pe({},t),{table(e){let r=t.table(e),{schema:n}=r,i={},o=[];function s(f,d,_){let w=An(f),b=i[w]=i[w]||[],p=f==null?0:typeof f=="string"?1:f.length,x=d>0,m=Me(pe({},_),{isVirtual:x,keyTail:d,keyLength:p,extractKey:Qo(f),unique:!x&&_.unique});if(b.push(m),m.isPrimaryKey||o.push(m),p>1){let g=p===2?f[0]:f.slice(0,p-1);s(g,d+1,_)}return b.sort((g,y)=>g.keyTail-y.keyTail),m}let a=s(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(let f of n.indexes)s(f.keyPath,0,f);function u(f){let d=i[An(f)];return d&&d[0]}function l(f,d){return{type:f.type===1?2:f.type,lower:di(f.lower,f.lowerOpen?t.MAX_KEY:t.MIN_KEY,d),lowerOpen:!0,upper:di(f.upper,f.upperOpen?t.MIN_KEY:t.MAX_KEY,d),upperOpen:!0}}function c(f){let d=f.query.index;return d.isVirtual?Me(pe({},f),{query:{index:d,range:l(f.query.range,d.keyTail)}}):f}return Me(pe({},r),{schema:Me(pe({},n),{primaryKey:a,indexes:o,getIndexByKeyPath:u}),count(f){return r.count(c(f))},query(f){return r.query(c(f))},openCursor(f){let{keyTail:d,isVirtual:_,keyLength:w}=f.query.index;if(!_)return r.openCursor(f);function b(p){function x(g){g!=null?p.continue(di(g,f.reverse?t.MAX_KEY:t.MIN_KEY,d)):f.unique?p.continue(p.key.slice(0,w).concat(f.reverse?t.MIN_KEY:t.MAX_KEY,d)):p.continue()}return Object.create(p,{continue:{value:x},continuePrimaryKey:{value(g,y){p.continuePrimaryKey(di(g,t.MAX_KEY,d),y)}},primaryKey:{get(){return p.primaryKey}},key:{get(){let g=p.key;return w===1?g[0]:g.slice(0,w)}},value:{get(){return p.value}}})}return r.openCursor(c(f)).then(p=>p&&b(p))}})}})}var Dp={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Tp};function os(t,e,r,n){return r=r||{},n=n||"",ye(t).forEach(i=>{if(!qe(e,i))r[n+i]=void 0;else{var o=t[i],s=e[i];if(typeof o=="object"&&typeof s=="object"&&o&&s){let a=bo(o),u=bo(s);a!==u?r[n+i]=e[i]:a==="Object"?os(o,s,r,n+i+"."):o!==s&&(r[n+i]=e[i])}else o!==s&&(r[n+i]=e[i])}}),ye(e).forEach(i=>{qe(t,i)||(r[n+i]=e[i])}),r}function Op(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Ip={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>Me(pe({},t),{table(e){let r=t.table(e),{primaryKey:n}=r.schema;return Me(pe({},r),{mutate(o){let s=K.trans,{deleting:a,creating:u,updating:l}=s.table(e).hook;switch(o.type){case"add":if(u.fire===ie)break;return s._promise("readwrite",()=>c(o),!0);case"put":if(u.fire===ie&&l.fire===ie)break;return s._promise("readwrite",()=>c(o),!0);case"delete":if(a.fire===ie)break;return s._promise("readwrite",()=>c(o),!0);case"deleteRange":if(a.fire===ie)break;return s._promise("readwrite",()=>h(o),!0)}return r.mutate(o);function c(d){let _=K.trans,w=d.keys||Op(n,d);if(!w)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?Me(pe({},d),{keys:w}):pe({},d),d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),Pp(r,d,w).then(b=>{let p=w.map((x,m)=>{let g=b[m],y={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(y,x,g,_);else if(d.type==="add"||g===void 0){let v=u.fire.call(y,x,d.values[m],_);x==null&&v!=null&&(x=v,d.keys[m]=x,n.outbound||et(d.values[m],n.keyPath,x))}else{let v=os(g,d.values[m]),j=l.fire.call(y,v,x,g,_);if(j){let A=d.values[m];Object.keys(j).forEach(E=>{qe(A,E)?A[E]=j[E]:et(A,E,j[E])})}}return y});return r.mutate(d).then(({failures:x,results:m,numFailures:g,lastResult:y})=>{for(let v=0;v<w.length;++v){let j=m?m[v]:w[v],A=p[v];j==null?A.onerror&&A.onerror(x[v]):A.onsuccess&&A.onsuccess(d.type==="put"&&b[v]?d.values[v]:j)}return{failures:x,results:m,numFailures:g,lastResult:y}}).catch(x=>(p.forEach(m=>m.onerror&&m.onerror(x)),Promise.reject(x)))})}function h(d){return f(d.trans,d.range,1e4)}function f(d,_,w){return r.query({trans:d,values:!1,query:{index:n,range:_},limit:w}).then(({result:b})=>c({type:"delete",keys:b,trans:d}).then(p=>p.numFailures>0?Promise.reject(p.failures[0]):b.length<w?{failures:[],numFailures:0,lastResult:void 0}:f(d,Me(pe({},_),{lower:b[b.length-1],lowerOpen:!0}),w)))}}})}})};function Pp(t,e,r){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:r,cache:"immutable"})}function Qa(t,e,r){try{if(!e||e.keys.length<t.length)return null;let n=[];for(let i=0,o=0;i<e.keys.length&&o<t.length;++i)Ne(e.keys[i],t[o])===0&&(n.push(r?cn(e.values[i]):e.values[i]),++o);return n.length===t.length?n:null}catch{return null}}var kp={stack:"dbcore",level:-1,create:t=>({table:e=>{let r=t.table(e);return Me(pe({},r),{getMany:n=>{if(!n.cache)return r.getMany(n);let i=Qa(n.keys,n.trans._cache,n.cache==="clone");return i?R.resolve(i):r.getMany(n).then(o=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?cn(o):o},o))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))})}})};function ss(t){return!("from"in t)}var ht=function(t,e){if(this)Le(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let r=new ht;return t&&"d"in t&&Le(r,t),r}};wr(ht.prototype,{add(t){return pi(this,t),this},addKey(t){return Cn(this,t,t),this},addKeys(t){return t.forEach(e=>Cn(this,e,e)),this},[xo](){return as(this)}});function Cn(t,e,r){let n=Ne(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(ss(t))return Le(t,{from:e,to:r,d:1});let i=t.l,o=t.r;if(Ne(r,t.from)<0)return i?Cn(i,e,r):t.l={from:e,to:r,d:1,l:null,r:null},qa(t);if(Ne(e,t.to)>0)return o?Cn(o,e,r):t.r={from:e,to:r,d:1,l:null,r:null},qa(t);Ne(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),Ne(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);let s=!t.r;i&&!t.l&&pi(t,i),o&&s&&pi(t,o)}function pi(t,e){function r(n,{from:i,to:o,l:s,r:a}){Cn(n,i,o),s&&r(n,s),a&&r(n,a)}ss(e)||r(t,e)}function Mp(t,e){let r=as(e),n=r.next();if(n.done)return!1;let i=n.value,o=as(t),s=o.next(i.from),a=s.value;for(;!n.done&&!s.done;){if(Ne(a.from,i.to)<=0&&Ne(a.to,i.from)>=0)return!0;Ne(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function as(t){let e=ss(t)?null:{s:0,n:t};return{next(r){let n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Ne(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Ne(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function qa(t){var e,r;let n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((r=t.l)===null||r===void 0?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){let o=i==="r"?"l":"r",s=pe({},t),a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],s[i]=a[o],t[o]=s,s.d=Ya(s)}t.d=Ya(t)}function Ya({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var Rp={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,r=new ht(t.MIN_KEY,t.MAX_KEY);return Me(pe({},t),{table:n=>{let i=t.table(n),{schema:o}=i,{primaryKey:s}=o,{extractKey:a,outbound:u}=s,l=Me(pe({},i),{mutate:f=>{let d=f.trans,_=d.mutatedParts||(d.mutatedParts={}),w=v=>{let j=`idb://${e}/${n}/${v}`;return _[j]||(_[j]=new ht)},b=w(""),p=w(":dels"),{type:x}=f,[m,g]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],y=f.trans._cache;return i.mutate(f).then(v=>{if(Pe(m)){x!=="delete"&&(m=v.results),b.addKeys(m);let j=Qa(m,y);!j&&x!=="add"&&p.addKeys(m),(j||g)&&Lp(w,o,j,g)}else if(m){let j={from:m.lower,to:m.upper};p.add(j),b.add(j)}else b.add(r),p.add(r),o.indexes.forEach(j=>w(j.name).add(r));return v})}}),c=({query:{index:f,range:d}})=>{var _,w;return[f,new ht((_=d.lower)!==null&&_!==void 0?_:t.MIN_KEY,(w=d.upper)!==null&&w!==void 0?w:t.MAX_KEY)]},h={get:f=>[s,new ht(f.key)],getMany:f=>[s,new ht().addKeys(f.keys)],count:c,query:c,openCursor:c};return ye(h).forEach(f=>{l[f]=function(d){let{subscr:_}=K;if(_){let w=g=>{let y=`idb://${e}/${n}/${g}`;return _[y]||(_[y]=new ht)},b=w(""),p=w(":dels"),[x,m]=h[f](d);if(w(x.name||"").add(m),!x.isPrimaryKey)if(f==="count")p.add(r);else{let g=f==="query"&&u&&d.values&&i.query(Me(pe({},d),{values:!1}));return i[f].apply(this,arguments).then(y=>{if(f==="query"){if(u&&d.values)return g.then(({result:j})=>(b.addKeys(j),y));let v=d.values?y.result.map(a):y.result;d.values?b.addKeys(v):p.addKeys(v)}else if(f==="openCursor"){let v=y,j=d.values;return v&&Object.create(v,{key:{get(){return p.addKey(v.primaryKey),v.key}},primaryKey:{get(){let A=v.primaryKey;return p.addKey(A),A}},value:{get(){return j&&b.addKey(v.primaryKey),v.value}}})}return y})}}return i[f].apply(this,arguments)}}),l}})}};function Lp(t,e,r,n){function i(o){let s=t(o.name||"");function a(l){return l!=null?o.extractKey(l):null}let u=l=>o.multiEntry&&Pe(l)?l.forEach(c=>s.addKey(c)):s.addKey(l);(r||n).forEach((l,c)=>{let h=r&&a(r[c]),f=n&&a(n[c]);Ne(h,f)!==0&&(h!=null&&u(h),f!=null&&u(f))})}e.indexes.forEach(i)}var mt=class{constructor(e,r){this._middlewares={},this.verno=0;let n=mt.dependencies;this._options=r=pe({addons:mt.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};let{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ie,dbReadyPromise:null,cancelOpen:ie,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};o.dbReadyPromise=new R(s=>{o.dbReadyResolve=s}),o.openCanceller=new R((s,a)=>{o.cancelOpen=a}),this._state=o,this.name=e,this.on=vn(this,"populate","blocked","versionchange","close",{ready:[So,ie]}),this.on.ready.subscribe=aa(this.on.ready.subscribe,s=>(a,u)=>{mt.vip(()=>{let l=this._state;if(l.openComplete)l.dbOpenError||R.resolve().then(a),u&&s(a);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(a),u&&s(a);else{s(a);let c=this;u||s(function h(){c.on.ready.unsubscribe(a),c.on.ready.unsubscribe(h)})}})}),this.Collection=ep(this),this.Table=Yd(this),this.Transaction=ap(this),this.Version=wp(this),this.WhereClause=sp(this),this.on("versionchange",s=>{s.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",s=>{!s.newVersion||s.newVersion<s.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${s.oldVersion/10}`)}),this._maxKey=jn(r.IDBKeyRange),this._createTransaction=(s,a,u,l)=>new this.Transaction(s,a,u,this._options.chromeTransactionDurability,l),this._fireOnBlocked=s=>{this.on("blocked").fire(s),_n.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(s))},this.use(Dp),this.use(Ip),this.use(Rp),this.use(kp),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(s=>s(this))}version(e){if(isNaN(e)||e<.1)throw new H.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new H.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let r=this._versions;var n=r.filter(i=>i._cfg.version===e)[0];return n||(n=new this.Version(e),r.push(n),r.sort(hp),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||K.letThrough||this._vip)?e():new R((r,n)=>{if(this._state.openComplete)return n(new H.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){n(new H.DatabaseClosed);return}this.open().catch(ie)}this._state.dbReadyPromise.then(r,n)}).then(e)}use({stack:e,create:r,level:n,name:i}){i&&this.unuse({stack:e,name:i});let o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:r,level:n??10,name:i}),o.sort((s,a)=>s.level-a.level),this}unuse({stack:e,name:r,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>n?i.create!==n:r?i.name!==r:!1)),this}open(){return Ep(this)}_close(){let e=this._state,r=_n.indexOf(this);if(r>=0&&_n.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new R(n=>{e.dbReadyResolve=n}),e.openCanceller=new R((n,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new H.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,r=this._state;return new R((n,i)=>{let o=()=>{this.close();var s=this._deps.indexedDB.deleteDatabase(this.name);s.onsuccess=ue(()=>{Cp(this._deps,this.name),n()}),s.onerror=nt(i),s.onblocked=this._fireOnBlocked};if(e)throw new H.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ye(this._allTables).map(e=>this._allTables[e])}transaction(){let e=Fp.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,r,n){let i=K.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let o=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let s,a;try{if(a=r.map(l=>{var c=l instanceof this.Table?l.name:l;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===zo)s=zo;else if(e=="rw"||e==Ho)s=Ho;else throw new H.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===zo&&s===Ho)if(o)i=null;else throw new H.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(l=>{if(i&&i.storeNames.indexOf(l)===-1)if(o)i=null;else throw new H.SubTransaction("Table "+l+" not included in parent transaction.")}),o&&i&&!i.active&&(i=null)}}catch(l){return i?i._promise(null,(c,h)=>{h(l)}):xe(l)}let u=Ga.bind(null,this,s,a,i,n);return i?i._promise(s,u,"lock"):K.trans?Fr(K.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!qe(this._allTables,e))throw new H.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},Np=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",Ja=class{constructor(e){this._subscribe=e}subscribe(e,r,n){return this._subscribe(!e||typeof e=="function"?{next:e,error:r,complete:n}:e)}[Np](){return this}};function Xa(t,e){return ye(e).forEach(r=>{let n=t[r]||(t[r]=new ht);pi(n,e[r])}),t}function Bp(t){let e=!1,r,n=new Ja(i=>{let o=wo(t);function s(b){o&&Er();let p=()=>Ct(t,{subscr:b,trans:null}),x=K.trans?Fr(K.transless,p):p();return o&&x.then(dt,dt),x}let a=!1,u={},l={},c={get closed(){return a},unsubscribe:()=>{a=!0,Tt.storagemutated.unsubscribe(_)}};i.start&&i.start(c);let h=!1,f=!1;function d(){return ye(l).some(b=>u[b]&&Mp(u[b],l[b]))}let _=b=>{Xa(u,b),d()&&w()},w=()=>{if(h||a)return;u={};let b={},p=s(b);f||(Tt(wn,_),f=!0),h=!0,Promise.resolve(p).then(x=>{e=!0,r=x,h=!1,!a&&(d()?w():(u={},l=b,i.next&&i.next(x)))},x=>{h=!1,e=!1,i.error&&i.error(x),c.unsubscribe()})};return w(),c});return n.hasValue=()=>e,n.getValue=()=>r,n}var ls;try{ls={indexedDB:se.indexedDB||se.mozIndexedDB||se.webkitIndexedDB||se.msIndexedDB,IDBKeyRange:se.IDBKeyRange||se.webkitIDBKeyRange}}catch{ls={indexedDB:null,IDBKeyRange:null}}var er=mt;wr(er,Me(pe({},Gn),{delete(t){return new er(t,{addons:[]}).delete()},exists(t){return new er(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return jp(er.dependencies).then(t)}catch{return xe(new H.MissingAPI)}},defineClass(){function t(e){Le(this,e)}return t},ignoreTransaction(t){return K.trans?Fr(K.transless,t):t()},vip:ns,async:function(t){return function(){try{var e=is(t.apply(this,arguments));return!e||typeof e.then!="function"?R.resolve(e):e}catch(r){return xe(r)}}},spawn:function(t,e,r){try{var n=is(t.apply(r,e||[]));return!n||typeof n.then!="function"?R.resolve(n):n}catch(i){return xe(i)}},currentTransaction:{get:()=>K.trans||null},waitFor:function(t,e){let r=R.resolve(typeof t=="function"?er.ignoreTransaction(t):t).timeout(e||6e4);return K.trans?K.trans.waitFor(r):r},Promise:R,debug:{get:()=>rt,set:t=>{pa(t,t==="dexie"?()=>!0:Ia)}},derive:jr,extend:Le,props:wr,override:aa,Events:vn,on:Tt,liveQuery:Bp,extendObservabilitySet:Xa,getByKeyPath:ct,setByKeyPath:et,delByKeyPath:wd,shallowClone:ca,deepClone:cn,getObjectDiff:os,cmp:Ne,asap:la,minKey:Ko,addons:[],connections:_n,errnames:Co,dependencies:ls,semVer:Da,version:Da.split(".").map(t=>parseInt(t)).reduce((t,e,r)=>t+e/Math.pow(10,r*2))}));er.maxKey=jn(er.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(Tt(wn,t=>{if(!gt){let e;oi?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Ft,!0,!0,t)):e=new CustomEvent(Ft,{detail:t}),gt=!0,dispatchEvent(e),gt=!1}}),addEventListener(Ft,({detail:t})=>{gt||hi(t)}));function hi(t){let e=gt;try{gt=!0,Tt.storagemutated.fire(t)}finally{gt=e}}var gt=!1;if(typeof BroadcastChannel!="undefined"){let t=new BroadcastChannel(Ft);typeof t.unref=="function"&&t.unref(),Tt(wn,e=>{gt||t.postMessage(e)}),t.onmessage=e=>{e.data&&hi(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){Tt(wn,e=>{try{gt||(typeof localStorage!="undefined"&&localStorage.setItem(Ft,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:Ft,changedParts:e})))}catch{}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===Ft){let r=JSON.parse(e.newValue);r&&hi(r.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",Kp)}function Kp({data:t}){t&&t.type===Ft&&hi(t.changedParts)}R.rejectionMapper=Od;pa(rt,Ia);var Za=me(require("obsidian")),it=class extends mt{constructor(){super(it.dbName);this.version(it.dbVersion).stores({searchHistory:"++id",minisearch:"date"})}static async clearOldDatabases(){let e=(await indexedDB.databases()).filter(r=>r.name===it.dbName&&r.version!==it.dbVersion*10);if(e.length){console.log("Omnisearch - Those IndexedDb databases will be deleted:");for(let r of e)r.name&&indexedDB.deleteDatabase(r.name)}}static getInstance(){return it.instance||(it.instance=new it),it.instance}async clearCache(){new Za.Notice("Omnisearch - Cache cleared. Please restart Obsidian."),await this.minisearch.clear()}},Or=it;Or.dbVersion=8,Or.dbName="omnisearch/cache/"+app.appId;var Se=Or.getInstance();var tr=$n(!1),mi='<strong style="color: var(--text-accent)">Needs a restart to fully take effect.</strong>',us=class extends U.PluginSettingTab{constructor(e){super(app,e);this.plugin=e,tr.subscribe(async r=>{F.showExcerpt=r,await ae(this.plugin)})}display(){let{containerEl:e}=this;if(e.empty(),app.loadLocalStorage(Sn)=="1"){let d=e.createEl("span");d.innerHTML='<strong style="color: var(--text-accent)">\u26A0\uFE0F OMNISEARCH IS DISABLED \u26A0\uFE0F</strong>'}e.createEl("h2",{text:"Omnisearch"});let r=e.createDiv();r.innerHTML=`
        <iframe src="https://github.com/sponsors/scambier/button" title="Sponsor scambier" height="35" width="116" style="border: 0;"></iframe>
        <a href='https://ko-fi.com/B0B6LQ2C' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://cdn.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
    `;let n=new DocumentFragment;n.createSpan({},d=>{d.innerHTML='\u26A0\uFE0F <span style="color: var(--text-accent)">Changing indexing settings will clear the cache, and requires a restart of Obsidian.</span><br/><br/>',ot()?d.innerHTML+=`
        \u{1F44D} You have installed <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a>, Omnisearch can use it to index PDFs and images contents.
            <br />Text extraction only works on desktop, but the cache can be synchronized with your mobile device.`:d.innerHTML+='\u26A0\uFE0F Omnisearch requires <a href="https://github.com/scambier/obsidian-text-extractor">Text Extractor</a> to index PDFs and images.'}),new U.Setting(e).setName("Indexing").setHeading().setDesc(n);let i=new DocumentFragment;i.createSpan({},d=>{d.innerHTML="Omnisearch will use Text Extractor to index the content of your PDFs"}),new U.Setting(e).setName(`PDFs content indexing ${ot()?"":"\u26A0\uFE0F Disabled"}`).setDesc(i).addToggle(d=>d.setValue(F.PDFIndexing).onChange(async _=>{await Se.clearCache(),F.PDFIndexing=_,await ae(this.plugin)})).setDisabled(!ot());let o=new DocumentFragment;o.createSpan({},d=>{d.innerHTML="Omnisearch will use Text Extractor to OCR your images and index their content"}),new U.Setting(e).setName(`Images OCR indexing ${ot()?"":"\u26A0\uFE0F Disabled"}`).setDesc(o).addToggle(d=>d.setValue(F.imagesIndexing).onChange(async _=>{await Se.clearCache(),F.imagesIndexing=_,await ae(this.plugin)})).setDisabled(!ot());let s=new DocumentFragment;s.createSpan({},d=>{d.innerHTML=`
      Omnisearch can index file<strong>names</strong> of "unsupported" files, such as e.g. <pre style="display:inline">.mp4</pre>, <pre style="display:inline">.xlsx</pre>, 
      or non-extracted PDFs & images.<br/>
      "Obsidian setting" will respect the value of "Files & Links > Detect all file extensions"`}),new U.Setting(e).setName("Index paths of unsupported files").setDesc(s).addDropdown(d=>{d.addOptions({yes:"Yes",no:"No",default:"Obsidian setting"}).setValue(F.unsupportedFilesIndexing).onChange(async _=>{await Se.clearCache(),F.unsupportedFilesIndexing=_,await ae(this.plugin)})});let a=new DocumentFragment;a.createSpan({},d=>{d.innerHTML=`In addition to standard <code>md</code> files, Omnisearch can also index other <strong style="color: var(--text-accent)">PLAINTEXT</strong> files.<br/>
      Add extensions separated by a space, without the dot. Example: "<code>txt org csv</code>".<br />
      \u26A0\uFE0F <span style="color: var(--text-accent)">Using extensions of non-plaintext files (like .docx or .pptx) WILL cause crashes,
      because Omnisearch will try to index their content.</span>`}),new U.Setting(e).setName("Additional TEXT files to index").setDesc(a).addText(d=>{d.setValue(F.indexedFileTypes.join(" ")).setPlaceholder("Example: txt org csv").onChange(async _=>{await Se.clearCache(),F.indexedFileTypes=_.split(" "),await ae(this.plugin)})}),new U.Setting(e).setName("Behavior").setHeading(),new U.Setting(e).setName("Save index to cache").setDesc("Enable caching to speed up indexing time. In rare cases, the cache write may cause a crash in Obsidian. This option will disable itself if it happens.").addToggle(d=>d.setValue(F.useCache).onChange(async _=>{F.useCache=_,await ae(this.plugin)})),new U.Setting(e).setName(`Respect Obsidian's "Excluded Files"`).setDesc(`By default, files that are in Obsidian's "Options > Files & Links > Excluded Files" list are downranked in results.
        Enable this option to completely hide them`).addToggle(d=>d.setValue(F.hideExcluded).onChange(async _=>{F.hideExcluded=_,await ae(this.plugin)}));let u=new DocumentFragment;u.createSpan({},d=>{d.innerHTML=`Enable this if you want to be able to search for CamelCaseWords as separate words.<br/>        
        \u26A0\uFE0F <span style="color: var(--text-accent)">Changing this setting will clear the cache.</span><br>
        ${mi}
        `}),new U.Setting(e).setName("Split CamelCaseWords").setDesc(u).addToggle(d=>d.setValue(F.splitCamelCase).onChange(async _=>{await Se.clearCache(),F.splitCamelCase=_,await ae(this.plugin)})),new U.Setting(e).setName("Simpler search").setDesc(`Enable this if Obsidian often freezes while making searches.
        Words shorter than 3 characters won't be used as prefixes; this can reduce search delay but will return fewer results.`).addToggle(d=>d.setValue(F.simpleSearch).onChange(async _=>{F.simpleSearch=_,await ae(this.plugin)})),new U.Setting(e).setName("Open in new pane").setDesc("Open and create files in a new pane instead of the current pane.").addToggle(d=>d.setValue(F.openInNewPane).onChange(async _=>{F.openInNewPane=_,await ae(this.plugin)})),new U.Setting(e).setName("Set Vim like navigation keys").setDesc("Navigate down the results with Ctrl/\u2318 + J/N, or navigate up with Ctrl/\u2318 + K/P").addToggle(d=>d.setValue(F.vimLikeNavigationShortcut).onChange(async _=>{F.vimLikeNavigationShortcut=_,await ae(this.plugin)})),new U.Setting(e).setName("Fuzziness").setDesc("Define the level of fuzziness for the search. The higher the fuzziness, the more results you'll get.").addDropdown(d=>d.addOptions({0:"Exact match",1:"Not too fuzzy",2:"Fuzzy enough"}).setValue(F.fuzziness).onChange(async _=>{["0","1","2"].includes(_)||(_="2"),F.fuzziness=_,await ae(this.plugin)})),new U.Setting(e).setName("User Interface").setHeading(),new U.Setting(e).setName("Show ribbon button").setDesc("Add a button on the sidebar to open the Vault search modal.").addToggle(d=>d.setValue(F.ribbonIcon).onChange(async _=>{F.ribbonIcon=_,await ae(this.plugin),_?this.plugin.addRibbonButton():this.plugin.removeRibbonButton()})),new U.Setting(e).setName("Show excerpts").setDesc("Shows the contextual part of the note that matches the search. Disable this to only show filenames in results.").addToggle(d=>d.setValue(F.showExcerpt).onChange(async _=>{tr.set(_)})),new U.Setting(e).setName("Render line return in excerpts").setDesc("Activate this option to render line returns in result excerpts.").addToggle(d=>d.setValue(F.renderLineReturnInExcerpts).onChange(async _=>{F.renderLineReturnInExcerpts=_,await ae(this.plugin)})),new U.Setting(e).setName("Show previous query results").setDesc("Re-executes the previous query when opening Omnisearch.").addToggle(d=>d.setValue(F.showPreviousQueryResults).onChange(async _=>{F.showPreviousQueryResults=_,await ae(this.plugin)}));let l=new DocumentFragment;l.createSpan({},d=>{d.innerHTML=`Shows a button next to the search input, to create a note.
        Acts the same as the <code>shift \u21B5</code> shortcut, can be useful for mobile device users.`}),new U.Setting(e).setName('Show "Create note" button').setDesc(l).addToggle(d=>d.setValue(F.showCreateButton).onChange(async _=>{F.showCreateButton=_,await ae(this.plugin)})),new U.Setting(e).setName("Highlight matching words in results").setDesc("Will highlight matching results when enabled. See README for more customization options.").addToggle(d=>d.setValue(F.highlight).onChange(async _=>{F.highlight=_,await ae(this.plugin)})),new U.Setting(e).setName("Results weighting").setHeading(),new U.Setting(e).setName(`File name & declared aliases (default: ${Dt.weightBasename})`).addSlider(d=>this.weightSlider(d,"weightBasename")),new U.Setting(e).setName(`File directory (default: ${Dt.weightDirectory})`).addSlider(d=>this.weightSlider(d,"weightDirectory")),new U.Setting(e).setName(`Headings level 1 (default: ${Dt.weightH1})`).addSlider(d=>this.weightSlider(d,"weightH1")),new U.Setting(e).setName(`Headings level 2 (default: ${Dt.weightH2})`).addSlider(d=>this.weightSlider(d,"weightH2")),new U.Setting(e).setName(`Headings level 3 (default: ${Dt.weightH3})`).addSlider(d=>this.weightSlider(d,"weightH3")),new U.Setting(e).setName(`Tags without the # (default: ${Dt.weightUnmarkedTags})`).addSlider(d=>this.weightSlider(d,"weightUnmarkedTags")),new U.Setting(e).setName("Debugging").setHeading(),new U.Setting(e).setName("Enable verbose logging").setDesc("Adds a LOT of logs for debugging purposes. Don't forget to disable it.").addToggle(d=>d.setValue(F.verboseLogging).onChange(async _=>{F.verboseLogging=_,await ae(this.plugin)}));let c=new DocumentFragment;c.createSpan({},d=>{d.innerHTML='Omnisearch can be used through a simple HTTP server (<a href="https://publish.obsidian.md/omnisearch/Public+API+%26+URL+Scheme#HTTP">more information</a>).'}),new U.Setting(e).setName("API Access Through HTTP").setHeading().setDesc(c),new U.Setting(e).setName("Enable the HTTP server").addToggle(d=>d.setValue(F.httpApiEnabled).onChange(async _=>{F.httpApiEnabled=_,_?this.plugin.apiHttpServer.listen(F.httpApiPort):this.plugin.apiHttpServer.close(),await ae(this.plugin)})),new U.Setting(e).setName("HTTP Port").addText(d=>{d.setValue(F.httpApiPort).setPlaceholder("51361").onChange(async _=>{parseInt(_)>65535&&(_=F.httpApiPort,d.setValue(F.httpApiPort)),F.httpApiPort=_,F.httpApiEnabled&&(this.plugin.apiHttpServer.close(),this.plugin.apiHttpServer.listen(F.httpApiPort)),await ae(this.plugin)})}),new U.Setting(e).setName("Danger Zone").setHeading();let h=new DocumentFragment;h.createSpan({},d=>{d.innerHTML=`Normalize diacritics in search terms. Words like "br\xFBl\xE9e" or "\u017Elu\u0165ou\u010Dk\xFD" will be indexed as "brulee" and "zlutoucky".<br/>
        \u26A0\uFE0F <span style="color: var(--text-accent)">You probably should <strong>NOT</strong> disable this.</span><br>
        \u26A0\uFE0F <span style="color: var(--text-accent)">Changing this setting will clear the cache.</span><br>
        ${mi}
        `}),new U.Setting(e).setName("Ignore diacritics").setDesc(h).addToggle(d=>d.setValue(F.ignoreDiacritics).onChange(async _=>{await Se.clearCache(),F.ignoreDiacritics=_,await ae(this.plugin)}));let f=new DocumentFragment;if(f.createSpan({},d=>{d.innerHTML=`Disable Omnisearch on this device only.<br>
        ${mi}`}),new U.Setting(e).setName("Disable on this device").setDesc(f).addToggle(d=>d.setValue(cs()).onChange(async _=>{_?app.saveLocalStorage(Sn,"1"):app.saveLocalStorage(Sn),new U.Notice("Omnisearch - Disabled. Please restart Obsidian.")})),Ot()){let d=new DocumentFragment;d.createSpan({},_=>{_.innerHTML=`Erase all Omnisearch cache data.
          Use this if Omnisearch results are inconsistent, missing, or appear outdated.<br>
          ${mi}`}),new U.Setting(e).setName("Clear cache data").setDesc(d).addButton(_=>{_.setButtonText("Clear cache"),_.onClick(async()=>{await Se.clearCache()})})}}weightSlider(e,r){e.setLimits(1,5,.1).setValue(F[r]).setDynamicTooltip().onChange(async n=>{F[r]=n,await ae(this.plugin)})}},Dt={useCache:!0,hideExcluded:!1,ignoreDiacritics:!0,indexedFileTypes:[],PDFIndexing:!1,imagesIndexing:!1,unsupportedFilesIndexing:"no",splitCamelCase:!1,openInNewPane:!1,vimLikeNavigationShortcut:app.vault.getConfig("vimMode"),ribbonIcon:!0,showExcerpt:!0,renderLineReturnInExcerpts:!0,showCreateButton:!1,highlight:!0,showPreviousQueryResults:!0,simpleSearch:!1,fuzziness:"1",weightBasename:3,weightDirectory:2,weightH1:1.5,weightH2:1.3,weightH3:1.1,weightUnmarkedTags:1.1,httpApiEnabled:!1,httpApiPort:"51361",welcomeMessage:"",verboseLogging:!1},F=Object.assign({},Dt);async function el(t){F=Object.assign({},Dt,await t.loadData()),tr.set(F.showExcerpt)}async function ae(t){await t.saveData(F)}function cs(){return app.loadLocalStorage(Sn)==="1"}function tl(){return F.unsupportedFilesIndexing==="yes"||F.unsupportedFilesIndexing==="default"&&!!app.vault.getConfig("showUnsupportedFiles")}var rl=me(require("obsidian"));var nl=/[\u4e00-\u9fa5]/;var il=100,En=300,ol=`suggestion-highlight omnisearch-highlight ${F.highlight?"omnisearch-default-highlight":""}`,Sn="omnisearch-disabled",G=new yo,gi={ToggleExcerpts:"toggle-excerpts"},Je=(o=>(o[o.Done=0]="Done",o[o.LoadingCache=1]="LoadingCache",o[o.ReadingFiles=2]="ReadingFiles",o[o.IndexingFiles=3]="IndexingFiles",o[o.WritingCache=4]="WritingCache",o))(Je||{}),te=(c=>(c.Enter="enter",c.OpenInBackground="open-in-background",c.CreateNote="create-note",c.OpenInNewPane="open-in-new-pane",c.InsertLink="insert-link",c.Tab="tab",c.ArrowUp="arrow-up",c.ArrowDown="arrow-down",c.PrevSearchHistory="prev-search-history",c.NextSearchHistory="next-search-history",c))(te||{});var It=$n(0),sl=!1;function fs(t){sl=t}function ds(){return sl}function yi(){return app.plugins.plugins["cm-chs-patch"]}function ot(){return app.plugins?.plugins?.["text-extractor"]?.api}function Ot(){return!rl.Platform.isIosApp&&F.useCache}var al=/[|\t\n\r= -#%-*,.`\/<>:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/.toString().slice(1,-1),ps=new RegExp(`${al}`,"u"),Fn=new RegExp(`${al}+`,"u");var bl=me(require("obsidian"));var rr=me(require("obsidian"));var ul=me(require("crypto")),cl=me(ll());function fl(t){let e=t.split("/");return e.pop(),e.join("/")}function _i(t,e){return t.headings?.filter(r=>r.level===e).map(r=>r.heading)??[]}function vi(t,e){return(t+e)%e}function ms(t){return t.replace(/(\*|_)+(.+?)(\*|_)+/g,(e,r,n)=>n)}function dl(t){return t?.frontmatter?(0,rr.parseFrontMatterAliases)(t.frontmatter)??[]:[]}function pl(t){let e=t?(0,rr.getAllTags)(t)??[]:[];return e=[...new Set(e.reduce((r,n)=>[...r,...n.split("/").filter(i=>i).map(i=>i.startsWith("#")?i:`#${i}`),n],[]))],e}function yt(t){return t==null?"":(t=t.replaceAll("`","[__omnisearch__backtick__]"),t=t.normalize("NFD").replace(/\p{Diacritic}/gu,""),t=t.replaceAll("[__omnisearch__backtick__]","`"),t)}function nr(){return rr.Platform.isMacOS?"\u2318":"ctrl"}function zp(t){let e=!!ot(),r=e&&F.PDFIndexing,n=e&&F.imagesIndexing;return bi(t)||Pr(t)||xi(t)||r&&ir(t)||n&&Ir(t)}function gs(t){return tl()||bi(t)||Pr(t)||xi(t)}function Dn(t){return gs(t)||zp(t)}function Ir(t){let e=or(t);return e==="png"||e==="jpg"||e==="jpeg"||e==="webp"}function ir(t){return or(t)==="pdf"}function bi(t){return[...F.indexedFileTypes,"md"].some(e=>t.endsWith(`.${e}`))}function Pr(t){return t.endsWith(".canvas")}function xi(t){return t.endsWith(".loom")}function or(t){let e=t.split(".");return e[e.length-1]??""}function hl(t){return rr.Platform.isMobileApp?(0,cl.md5)(t.toString()):(0,ul.createHash)("md5").update(t).digest("hex")}function ml(t,e){let r=[],n=0,i=t.length;for(;n<i;)r.push(t.slice(n,n+=e));return r}function gl(t){return/[a-z][A-Z]/.test(t)?t.replace(/([a-z](?=[A-Z]))/g,"$1 ").split(" ").filter(r=>r):[]}function yl(t){return t.includes("-")?t.split("-").filter(e=>e):[]}function fe(...t){vl(console.log,...t)}function _l(...t){vl(console.warn,...t)}function vl(t,...e){if(F.verboseLogging){let r=new Date,n=`${r.getMinutes()}:${r.getSeconds()}:${r.getMilliseconds()}`;t("Omnisearch -",n+" -",...e)}}async function Hp(t){let e=app.vault.getFiles().find(s=>s.path===t);if(!e)throw new Error(`Invalid file path: "${t}"`);let r=null,n=ot();if(bi(t))r=await app.vault.cachedRead(e);else if(Pr(t)){let s=JSON.parse(await app.vault.cachedRead(e)),a=[];for(let u of s.nodes)u.type==="text"?a.push(u.text):u.type==="file"&&a.push(u.file);for(let u of s.edges.filter(l=>!!l.label))a.push(u.label);r=a.join(`\r
`)}else if(xi(t))try{let s=JSON.parse(await app.vault.cachedRead(e)),a=[],u=l=>{for(let c in l)typeof l[c]=="object"?u(l[c]):c==="content"&&a.push(l[c])};u(s),r=a.join(`\r
`)}catch(s){console.error("Omnisearch: Error while parsing Dataloom file",t),console.error(s)}else Ir(t)&&F.imagesIndexing&&n?.canFileBeExtracted(t)?r=await n.extractText(e):ir(t)&&F.PDFIndexing&&n?.canFileBeExtracted(t)?r=await n.extractText(e):gs(t)&&(r=e.path);r==null&&(console.warn(`Omnisearch: ${r} content for file`,e.path),r=""),r=yt(r);let i=app.metadataCache.getFileCache(e);if(i&&i.frontmatter?.["excalidraw-plugin"]){let s=i.sections?.filter(a=>a.type==="comment")??[];for(let{start:a,end:u}of s.map(l=>l.position))r=r.substring(0,a.offset-1)+r.substring(u.offset)}let o=pl(i);return{basename:yt(e.basename),content:r,path:e.path,mtime:e.stat.mtime,tags:o,unmarkedTags:o.map(s=>s.replace("#","")),aliases:dl(i).join(""),headings1:i?_i(i,1).join(" "):"",headings2:i?_i(i,2).join(" "):"",headings3:i?_i(i,3).join(" "):""}}var xl=class{constructor(){this.nextQueryIsEmpty=!1;this.documents=new Map}async addToLiveCache(e){try{let r=await Hp(e);if(!r.path){console.error(`Missing .path field in IndexedDocument "${r.basename}", skipping`);return}this.documents.set(e,r)}catch(r){console.warn(`Omnisearch: Error while adding "${e}" to live cache`,r),this.removeFromLiveCache(e)}}removeFromLiveCache(e){this.documents.delete(e)}async getDocument(e){return this.documents.has(e)?this.documents.get(e):(fe("Generating IndexedDocument from",e),await this.addToLiveCache(e),this.documents.get(e))}async addToSearchHistory(e){if(!e){this.nextQueryIsEmpty=!0;return}this.nextQueryIsEmpty=!1;let r=await Se.searchHistory.toArray();r=r.filter(n=>n.query!==e).reverse(),r.unshift({query:e}),r=r.slice(0,10),await Se.searchHistory.clear(),await Se.searchHistory.bulkAdd(r)}async getSearchHistory(){let e=(await Se.searchHistory.toArray()).reverse().map(r=>r.query);return this.nextQueryIsEmpty&&e.unshift(""),e}getDocumentsChecksum(e){return hl(JSON.stringify(e.sort((r,n)=>r.path<n.path?-1:r.path>n.path?1:0)))}async getMinisearchCache(){try{return(await Se.minisearch.toArray())[0]}catch(e){return new bl.Notice("Omnisearch - Cache missing or invalid. Some freezes may occur while Omnisearch indexes your vault."),console.error("Omnisearch - Error while loading Minisearch cache"),console.error(e),null}}async writeMinisearchCache(e,r){let n=Array.from(r).map(([i,o])=>({path:i,mtime:o}));await Se.minisearch.clear(),await Se.minisearch.add({date:new Date().toISOString(),paths:n,data:e.toJSON()}),console.log("Omnisearch - Search cache written")}},Ee=new xl;function Vp(t){let e,r,n,i,o,s,a,u,l=t[8].default,c=pr(l,t,t[7],null);return{c(){e=M("div"),r=M("div"),n=M("input"),o=W(),c&&c.c(),N(n,"class","prompt-input"),N(n,"placeholder",t[0]),N(n,"spellcheck","false"),N(n,"type","text"),N(r,"class","omnisearch-input-field"),N(e,"class","omnisearch-input-container")},m(h,f){$(h,e,f),D(e,r),D(r,n),t[9](n),uo(n,t[1]),D(e,o),c&&c.m(e,null),s=!0,a||(u=[Ve(n,"input",t[10]),Zs(i=t[3].call(null,n)),Ve(n,"compositionend",t[11]),Ve(n,"compositionstart",t[12]),Ve(n,"input",t[4])],a=!0)},p(h,[f]){(!s||f&1)&&N(n,"placeholder",h[0]),f&2&&n.value!==h[1]&&uo(n,h[1]),c&&c.p&&(!s||f&128)&&mr(c,l,h,h[7],s?hr(l,h[7],f,null):gr(h[7]),null)},i(h){s||(ee(c,h),s=!0)},o(h){ne(c,h),s=!1},d(h){h&&V(e),t[9](null),c&&c.d(h),a=!1,Xe(u)}}}function $p(t,e,r){let{$$slots:n={},$$scope:i}=e,{initialValue:o=""}=e,{placeholder:s=""}=e,a=!1,u="",l,c=po();function h(m){r(1,u=m)}function f(m){m&&!a&&!u&&(a=!0,r(1,u=m),d())}function d(m){jt().then(()=>(l.focus(),jt())).then(()=>{l.select()})}let _=(0,wl.debounce)(()=>{Ee.addToSearchHistory(""),c("input",u)},300);function w(m){lt[m?"unshift":"push"](()=>{l=m,r(2,l)})}function b(){u=this.value,r(1,u)}let p=m=>fs(!1),x=m=>fs(!0);return t.$$set=m=>{"initialValue"in m&&r(5,o=m.initialValue),"placeholder"in m&&r(0,s=m.placeholder),"$$scope"in m&&r(7,i=m.$$scope)},t.$$.update=()=>{if(t.$$.dirty&32){e:f(o)}},[s,u,l,d,_,o,h,i,n,w,b,p,x]}var jl=class extends Te{constructor(e){super();Ie(this,e,$p,Vp,Ae,{initialValue:5,placeholder:0,setInputValue:6})}get setInputValue(){return this.$$.ctx[6]}},wi=jl;function Wp(t){let e,r,n,i,o=t[1].default,s=pr(o,t,t[0],null);return{c(){e=M("div"),s&&s.c(),N(e,"class","prompt-results")},m(a,u){$(a,e,u),s&&s.m(e,null),r=!0,n||(i=Ve(e,"mousedown",Up),n=!0)},p(a,[u]){s&&s.p&&(!r||u&1)&&mr(s,o,a,a[0],r?hr(o,a[0],u,null):gr(a[0]),null)},i(a){r||(ee(s,a),r=!0)},o(a){ne(s,a),r=!1},d(a){a&&V(e),s&&s.d(a),n=!1,i()}}}var Up=t=>t.preventDefault();function Gp(t,e,r){let{$$slots:n={},$$scope:i}=e;return t.$$set=o=>{"$$scope"in o&&r(0,i=o.$$scope)},[i,n]}var Al=class extends Te{constructor(e){super();Ie(this,e,Gp,Wp,Ae,{})}},ji=Al;var As=me(require("obsidian"));var rf=me(require("obsidian"));var Qp=typeof global=="object"&&global&&global.Object===Object&&global,Ai=Qp;var qp=typeof self=="object"&&self&&self.Object===Object&&self,Yp=Ai||qp||Function("return this")(),_e=Yp;var Jp=_e.Symbol,Fe=Jp;var Cl=Object.prototype,Xp=Cl.hasOwnProperty,Zp=Cl.toString,On=Fe?Fe.toStringTag:void 0;function eh(t){var e=Xp.call(t,On),r=t[On];try{t[On]=void 0;var n=!0}catch{}var i=Zp.call(t);return n&&(e?t[On]=r:delete t[On]),i}var Sl=eh;var th=Object.prototype,rh=th.toString;function nh(t){return rh.call(t)}var El=nh;var ih="[object Null]",oh="[object Undefined]",Fl=Fe?Fe.toStringTag:void 0;function sh(t){return t==null?t===void 0?oh:ih:Fl&&Fl in Object(t)?Sl(t):El(t)}var tt=sh;function ah(t){return t!=null&&typeof t=="object"}var Be=ah;var lh="[object Symbol]";function uh(t){return typeof t=="symbol"||Be(t)&&tt(t)==lh}var _t=uh;function ch(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var kr=ch;var fh=Array.isArray,de=fh;var dh=1/0,Tl=Fe?Fe.prototype:void 0,Dl=Tl?Tl.toString:void 0;function Ol(t){if(typeof t=="string")return t;if(de(t))return kr(t,Ol)+"";if(_t(t))return Dl?Dl.call(t):"";var e=t+"";return e=="0"&&1/t==-dh?"-0":e}var Il=Ol;function ph(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var We=ph;function hh(t){return t}var Pt=hh;var mh="[object AsyncFunction]",gh="[object Function]",yh="[object GeneratorFunction]",_h="[object Proxy]";function vh(t){if(!We(t))return!1;var e=tt(t);return e==gh||e==yh||e==mh||e==_h}var Ci=vh;var bh=_e["__core-js_shared__"],Si=bh;var Pl=function(){var t=/[^.]+$/.exec(Si&&Si.keys&&Si.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function xh(t){return!!Pl&&Pl in t}var kl=xh;var wh=Function.prototype,jh=wh.toString;function Ah(t){if(t!=null){try{return jh.call(t)}catch{}try{return t+""}catch{}}return""}var vt=Ah;var Ch=/[\\^$.*+?()[\]{}|]/g,Sh=/^\[object .+?Constructor\]$/,Eh=Function.prototype,Fh=Object.prototype,Th=Eh.toString,Dh=Fh.hasOwnProperty,Oh=RegExp("^"+Th.call(Dh).replace(Ch,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ih(t){if(!We(t)||kl(t))return!1;var e=Ci(t)?Oh:Sh;return e.test(vt(t))}var Ml=Ih;function Ph(t,e){return t==null?void 0:t[e]}var Rl=Ph;function kh(t,e){var r=Rl(t,e);return Ml(r)?r:void 0}var Ue=kh;var Mh=Ue(_e,"WeakMap"),Ei=Mh;var Ll=Object.create,Rh=function(){function t(){}return function(e){if(!We(e))return{};if(Ll)return Ll(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Nl=Rh;function Lh(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var Bl=Lh;function Nh(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var Kl=Nh;var Bh=800,Kh=16,zh=Date.now;function Hh(t){var e=0,r=0;return function(){var n=zh(),i=Kh-(n-r);if(r=n,i>0){if(++e>=Bh)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var zl=Hh;function Vh(t){return function(){return t}}var Hl=Vh;var $h=function(){try{var t=Ue(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Mr=$h;var Wh=Mr?function(t,e){return Mr(t,"toString",{configurable:!0,enumerable:!1,value:Hl(e),writable:!0})}:Pt,Vl=Wh;var Uh=zl(Vl),$l=Uh;function Gh(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}var Wl=Gh;var Qh=9007199254740991,qh=/^(?:0|[1-9]\d*)$/;function Yh(t,e){var r=typeof t;return e=e??Qh,!!e&&(r=="number"||r!="symbol"&&qh.test(t))&&t>-1&&t%1==0&&t<e}var Rr=Yh;function Jh(t,e,r){e=="__proto__"&&Mr?Mr(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Fi=Jh;function Xh(t,e){return t===e||t!==t&&e!==e}var kt=Xh;var Zh=Object.prototype,em=Zh.hasOwnProperty;function tm(t,e,r){var n=t[e];(!(em.call(t,e)&&kt(n,r))||r===void 0&&!(e in t))&&Fi(t,e,r)}var Ti=tm;function rm(t,e,r,n){var i=!r;r||(r={});for(var o=-1,s=e.length;++o<s;){var a=e[o],u=n?n(r[a],t[a],a,r,t):void 0;u===void 0&&(u=t[a]),i?Fi(r,a,u):Ti(r,a,u)}return r}var Mt=rm;var Ul=Math.max;function nm(t,e,r){return e=Ul(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,o=Ul(n.length-e,0),s=Array(o);++i<o;)s[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(s),Bl(t,this,a)}}var Gl=nm;function im(t,e){return $l(Gl(t,e,Pt),t+"")}var Ql=im;var om=9007199254740991;function sm(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=om}var Lr=sm;function am(t){return t!=null&&Lr(t.length)&&!Ci(t)}var st=am;function lm(t,e,r){if(!We(r))return!1;var n=typeof e;return(n=="number"?st(r)&&Rr(e,r.length):n=="string"&&e in r)?kt(r[e],t):!1}var ys=lm;var um=Object.prototype;function cm(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||um;return t===r}var Nr=cm;function fm(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var ql=fm;var dm="[object Arguments]";function pm(t){return Be(t)&&tt(t)==dm}var _s=pm;var Yl=Object.prototype,hm=Yl.hasOwnProperty,mm=Yl.propertyIsEnumerable,gm=_s(function(){return arguments}())?_s:function(t){return Be(t)&&hm.call(t,"callee")&&!mm.call(t,"callee")},Br=gm;function ym(){return!1}var Jl=ym;var Xl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Zl=Xl&&typeof module=="object"&&module&&!module.nodeType&&module,_m=Zl&&Zl.exports===Xl,eu=_m?_e.Buffer:void 0,vm=eu?eu.isBuffer:void 0,bm=vm||Jl,sr=bm;var xm="[object Arguments]",wm="[object Array]",jm="[object Boolean]",Am="[object Date]",Cm="[object Error]",Sm="[object Function]",Em="[object Map]",Fm="[object Number]",Tm="[object Object]",Dm="[object RegExp]",Om="[object Set]",Im="[object String]",Pm="[object WeakMap]",km="[object ArrayBuffer]",Mm="[object DataView]",Rm="[object Float32Array]",Lm="[object Float64Array]",Nm="[object Int8Array]",Bm="[object Int16Array]",Km="[object Int32Array]",zm="[object Uint8Array]",Hm="[object Uint8ClampedArray]",Vm="[object Uint16Array]",$m="[object Uint32Array]",le={};le[Rm]=le[Lm]=le[Nm]=le[Bm]=le[Km]=le[zm]=le[Hm]=le[Vm]=le[$m]=!0;le[xm]=le[wm]=le[km]=le[jm]=le[Mm]=le[Am]=le[Cm]=le[Sm]=le[Em]=le[Fm]=le[Tm]=le[Dm]=le[Om]=le[Im]=le[Pm]=!1;function Wm(t){return Be(t)&&Lr(t.length)&&!!le[tt(t)]}var tu=Wm;function Um(t){return function(e){return t(e)}}var Rt=Um;var ru=typeof exports=="object"&&exports&&!exports.nodeType&&exports,In=ru&&typeof module=="object"&&module&&!module.nodeType&&module,Gm=In&&In.exports===ru,vs=Gm&&Ai.process,Qm=function(){try{var t=In&&In.require&&In.require("util").types;return t||vs&&vs.binding&&vs.binding("util")}catch{}}(),bt=Qm;var nu=bt&&bt.isTypedArray,qm=nu?Rt(nu):tu,Di=qm;var Ym=Object.prototype,Jm=Ym.hasOwnProperty;function Xm(t,e){var r=de(t),n=!r&&Br(t),i=!r&&!n&&sr(t),o=!r&&!n&&!i&&Di(t),s=r||n||i||o,a=s?ql(t.length,String):[],u=a.length;for(var l in t)(e||Jm.call(t,l))&&!(s&&(l=="length"||i&&(l=="offset"||l=="parent")||o&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Rr(l,u)))&&a.push(l);return a}var Oi=Xm;function Zm(t,e){return function(r){return t(e(r))}}var Ii=Zm;var eg=Ii(Object.keys,Object),iu=eg;var tg=Object.prototype,rg=tg.hasOwnProperty;function ng(t){if(!Nr(t))return iu(t);var e=[];for(var r in Object(t))rg.call(t,r)&&r!="constructor"&&e.push(r);return e}var ou=ng;function ig(t){return st(t)?Oi(t):ou(t)}var at=ig;function og(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var su=og;var sg=Object.prototype,ag=sg.hasOwnProperty;function lg(t){if(!We(t))return su(t);var e=Nr(t),r=[];for(var n in t)n=="constructor"&&(e||!ag.call(t,n))||r.push(n);return r}var au=lg;function ug(t){return st(t)?Oi(t,!0):au(t)}var Kr=ug;var cg=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,fg=/^\w*$/;function dg(t,e){if(de(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||_t(t)?!0:fg.test(t)||!cg.test(t)||e!=null&&t in Object(e)}var zr=dg;var pg=Ue(Object,"create"),xt=pg;function hg(){this.__data__=xt?xt(null):{},this.size=0}var lu=hg;function mg(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var uu=mg;var gg="__lodash_hash_undefined__",yg=Object.prototype,_g=yg.hasOwnProperty;function vg(t){var e=this.__data__;if(xt){var r=e[t];return r===gg?void 0:r}return _g.call(e,t)?e[t]:void 0}var cu=vg;var bg=Object.prototype,xg=bg.hasOwnProperty;function wg(t){var e=this.__data__;return xt?e[t]!==void 0:xg.call(e,t)}var fu=wg;var jg="__lodash_hash_undefined__";function Ag(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=xt&&e===void 0?jg:e,this}var du=Ag;function Hr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Hr.prototype.clear=lu;Hr.prototype.delete=uu;Hr.prototype.get=cu;Hr.prototype.has=fu;Hr.prototype.set=du;var bs=Hr;function Cg(){this.__data__=[],this.size=0}var pu=Cg;function Sg(t,e){for(var r=t.length;r--;)if(kt(t[r][0],e))return r;return-1}var Lt=Sg;var Eg=Array.prototype,Fg=Eg.splice;function Tg(t){var e=this.__data__,r=Lt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Fg.call(e,r,1),--this.size,!0}var hu=Tg;function Dg(t){var e=this.__data__,r=Lt(e,t);return r<0?void 0:e[r][1]}var mu=Dg;function Og(t){return Lt(this.__data__,t)>-1}var gu=Og;function Ig(t,e){var r=this.__data__,n=Lt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var yu=Ig;function Vr(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Vr.prototype.clear=pu;Vr.prototype.delete=hu;Vr.prototype.get=mu;Vr.prototype.has=gu;Vr.prototype.set=yu;var Nt=Vr;var Pg=Ue(_e,"Map"),Bt=Pg;function kg(){this.size=0,this.__data__={hash:new bs,map:new(Bt||Nt),string:new bs}}var _u=kg;function Mg(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var vu=Mg;function Rg(t,e){var r=t.__data__;return vu(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Kt=Rg;function Lg(t){var e=Kt(this,t).delete(t);return this.size-=e?1:0,e}var bu=Lg;function Ng(t){return Kt(this,t).get(t)}var xu=Ng;function Bg(t){return Kt(this,t).has(t)}var wu=Bg;function Kg(t,e){var r=Kt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var ju=Kg;function $r(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}$r.prototype.clear=_u;$r.prototype.delete=bu;$r.prototype.get=xu;$r.prototype.has=wu;$r.prototype.set=ju;var ar=$r;var zg="Expected a function";function xs(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(zg);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=t.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(xs.Cache||ar),r}xs.Cache=ar;var Au=xs;var Hg=500;function Vg(t){var e=Au(t,function(n){return r.size===Hg&&r.clear(),n}),r=e.cache;return e}var Cu=Vg;var $g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Wg=/\\(\\)?/g,Ug=Cu(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace($g,function(r,n,i,o){e.push(i?o.replace(Wg,"$1"):n||r)}),e}),Su=Ug;function Gg(t){return t==null?"":Il(t)}var Pi=Gg;function Qg(t,e){return de(t)?t:zr(t,e)?[t]:Su(Pi(t))}var ki=Qg;var qg=1/0;function Yg(t){if(typeof t=="string"||_t(t))return t;var e=t+"";return e=="0"&&1/t==-qg?"-0":e}var zt=Yg;function Jg(t,e){e=ki(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[zt(e[r++])];return r&&r==n?t:void 0}var Wr=Jg;function Xg(t,e,r){var n=t==null?void 0:Wr(t,e);return n===void 0?r:n}var Eu=Xg;function Zg(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var Ur=Zg;var Fu=Fe?Fe.isConcatSpreadable:void 0;function ey(t){return de(t)||Br(t)||!!(Fu&&t&&t[Fu])}var Tu=ey;function Du(t,e,r,n,i){var o=-1,s=t.length;for(r||(r=Tu),i||(i=[]);++o<s;){var a=t[o];e>0&&r(a)?e>1?Du(a,e-1,r,n,i):Ur(i,a):n||(i[i.length]=a)}return i}var Ou=Du;var ty=Ii(Object.getPrototypeOf,Object),Mi=ty;function ry(){this.__data__=new Nt,this.size=0}var Iu=ry;function ny(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var Pu=ny;function iy(t){return this.__data__.get(t)}var ku=iy;function oy(t){return this.__data__.has(t)}var Mu=oy;var sy=200;function ay(t,e){var r=this.__data__;if(r instanceof Nt){var n=r.__data__;if(!Bt||n.length<sy-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new ar(n)}return r.set(t,e),this.size=r.size,this}var Ru=ay;function Gr(t){var e=this.__data__=new Nt(t);this.size=e.size}Gr.prototype.clear=Iu;Gr.prototype.delete=Pu;Gr.prototype.get=ku;Gr.prototype.has=Mu;Gr.prototype.set=Ru;var Ht=Gr;function ly(t,e){return t&&Mt(e,at(e),t)}var Lu=ly;function uy(t,e){return t&&Mt(e,Kr(e),t)}var Nu=uy;var Bu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ku=Bu&&typeof module=="object"&&module&&!module.nodeType&&module,cy=Ku&&Ku.exports===Bu,zu=cy?_e.Buffer:void 0,Hu=zu?zu.allocUnsafe:void 0;function fy(t,e){if(e)return t.slice();var r=t.length,n=Hu?Hu(r):new t.constructor(r);return t.copy(n),n}var Vu=fy;function dy(t,e){for(var r=-1,n=t==null?0:t.length,i=0,o=[];++r<n;){var s=t[r];e(s,r,t)&&(o[i++]=s)}return o}var $u=dy;function py(){return[]}var Ri=py;var hy=Object.prototype,my=hy.propertyIsEnumerable,Wu=Object.getOwnPropertySymbols,gy=Wu?function(t){return t==null?[]:(t=Object(t),$u(Wu(t),function(e){return my.call(t,e)}))}:Ri,Qr=gy;function yy(t,e){return Mt(t,Qr(t),e)}var Uu=yy;var _y=Object.getOwnPropertySymbols,vy=_y?function(t){for(var e=[];t;)Ur(e,Qr(t)),t=Mi(t);return e}:Ri,Li=vy;function by(t,e){return Mt(t,Li(t),e)}var Gu=by;function xy(t,e,r){var n=e(t);return de(t)?n:Ur(n,r(t))}var Ni=xy;function wy(t){return Ni(t,at,Qr)}var Pn=wy;function jy(t){return Ni(t,Kr,Li)}var Qu=jy;var Ay=Ue(_e,"DataView"),Bi=Ay;var Cy=Ue(_e,"Promise"),Ki=Cy;var Sy=Ue(_e,"Set"),zi=Sy;var qu="[object Map]",Ey="[object Object]",Yu="[object Promise]",Ju="[object Set]",Xu="[object WeakMap]",Zu="[object DataView]",Fy=vt(Bi),Ty=vt(Bt),Dy=vt(Ki),Oy=vt(zi),Iy=vt(Ei),lr=tt;(Bi&&lr(new Bi(new ArrayBuffer(1)))!=Zu||Bt&&lr(new Bt)!=qu||Ki&&lr(Ki.resolve())!=Yu||zi&&lr(new zi)!=Ju||Ei&&lr(new Ei)!=Xu)&&(lr=function(t){var e=tt(t),r=e==Ey?t.constructor:void 0,n=r?vt(r):"";if(n)switch(n){case Fy:return Zu;case Ty:return qu;case Dy:return Yu;case Oy:return Ju;case Iy:return Xu}return e});var wt=lr;var Py=Object.prototype,ky=Py.hasOwnProperty;function My(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&ky.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var ec=My;var Ry=_e.Uint8Array,qr=Ry;function Ly(t){var e=new t.constructor(t.byteLength);return new qr(e).set(new qr(t)),e}var Yr=Ly;function Ny(t,e){var r=e?Yr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var tc=Ny;var By=/\w*$/;function Ky(t){var e=new t.constructor(t.source,By.exec(t));return e.lastIndex=t.lastIndex,e}var rc=Ky;var nc=Fe?Fe.prototype:void 0,ic=nc?nc.valueOf:void 0;function zy(t){return ic?Object(ic.call(t)):{}}var oc=zy;function Hy(t,e){var r=e?Yr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var sc=Hy;var Vy="[object Boolean]",$y="[object Date]",Wy="[object Map]",Uy="[object Number]",Gy="[object RegExp]",Qy="[object Set]",qy="[object String]",Yy="[object Symbol]",Jy="[object ArrayBuffer]",Xy="[object DataView]",Zy="[object Float32Array]",e_="[object Float64Array]",t_="[object Int8Array]",r_="[object Int16Array]",n_="[object Int32Array]",i_="[object Uint8Array]",o_="[object Uint8ClampedArray]",s_="[object Uint16Array]",a_="[object Uint32Array]";function l_(t,e,r){var n=t.constructor;switch(e){case Jy:return Yr(t);case Vy:case $y:return new n(+t);case Xy:return tc(t,r);case Zy:case e_:case t_:case r_:case n_:case i_:case o_:case s_:case a_:return sc(t,r);case Wy:return new n;case Uy:case qy:return new n(t);case Gy:return rc(t);case Qy:return new n;case Yy:return oc(t)}}var ac=l_;function u_(t){return typeof t.constructor=="function"&&!Nr(t)?Nl(Mi(t)):{}}var lc=u_;var c_="[object Map]";function f_(t){return Be(t)&&wt(t)==c_}var uc=f_;var cc=bt&&bt.isMap,d_=cc?Rt(cc):uc,fc=d_;var p_="[object Set]";function h_(t){return Be(t)&&wt(t)==p_}var dc=h_;var pc=bt&&bt.isSet,m_=pc?Rt(pc):dc,hc=m_;var g_=1,y_=2,__=4,mc="[object Arguments]",v_="[object Array]",b_="[object Boolean]",x_="[object Date]",w_="[object Error]",gc="[object Function]",j_="[object GeneratorFunction]",A_="[object Map]",C_="[object Number]",yc="[object Object]",S_="[object RegExp]",E_="[object Set]",F_="[object String]",T_="[object Symbol]",D_="[object WeakMap]",O_="[object ArrayBuffer]",I_="[object DataView]",P_="[object Float32Array]",k_="[object Float64Array]",M_="[object Int8Array]",R_="[object Int16Array]",L_="[object Int32Array]",N_="[object Uint8Array]",B_="[object Uint8ClampedArray]",K_="[object Uint16Array]",z_="[object Uint32Array]",oe={};oe[mc]=oe[v_]=oe[O_]=oe[I_]=oe[b_]=oe[x_]=oe[P_]=oe[k_]=oe[M_]=oe[R_]=oe[L_]=oe[A_]=oe[C_]=oe[yc]=oe[S_]=oe[E_]=oe[F_]=oe[T_]=oe[N_]=oe[B_]=oe[K_]=oe[z_]=!0;oe[w_]=oe[gc]=oe[D_]=!1;function Hi(t,e,r,n,i,o){var s,a=e&g_,u=e&y_,l=e&__;if(r&&(s=i?r(t,n,i,o):r(t)),s!==void 0)return s;if(!We(t))return t;var c=de(t);if(c){if(s=ec(t),!a)return Kl(t,s)}else{var h=wt(t),f=h==gc||h==j_;if(sr(t))return Vu(t,a);if(h==yc||h==mc||f&&!i){if(s=u||f?{}:lc(t),!a)return u?Gu(t,Nu(s,t)):Uu(t,Lu(s,t))}else{if(!oe[h])return i?t:{};s=ac(t,h,a)}}o||(o=new Ht);var d=o.get(t);if(d)return d;o.set(t,s),hc(t)?t.forEach(function(b){s.add(Hi(b,e,r,b,t,o))}):fc(t)&&t.forEach(function(b,p){s.set(p,Hi(b,e,r,p,t,o))});var _=l?u?Qu:Pn:u?Kr:at,w=c?void 0:_(t);return Wl(w||t,function(b,p){w&&(p=b,b=t[p]),Ti(s,p,Hi(b,e,r,p,t,o))}),s}var _c=Hi;var H_=1,V_=4;function $_(t){return _c(t,H_|V_)}var kn=$_;var W_="__lodash_hash_undefined__";function U_(t){return this.__data__.set(t,W_),this}var vc=U_;function G_(t){return this.__data__.has(t)}var bc=G_;function Vi(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new ar;++e<r;)this.add(t[e])}Vi.prototype.add=Vi.prototype.push=vc;Vi.prototype.has=bc;var xc=Vi;function Q_(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}var wc=Q_;function q_(t,e){return t.has(e)}var jc=q_;var Y_=1,J_=2;function X_(t,e,r,n,i,o){var s=r&Y_,a=t.length,u=e.length;if(a!=u&&!(s&&u>a))return!1;var l=o.get(t),c=o.get(e);if(l&&c)return l==e&&c==t;var h=-1,f=!0,d=r&J_?new xc:void 0;for(o.set(t,e),o.set(e,t);++h<a;){var _=t[h],w=e[h];if(n)var b=s?n(w,_,h,e,t,o):n(_,w,h,t,e,o);if(b!==void 0){if(b)continue;f=!1;break}if(d){if(!wc(e,function(p,x){if(!jc(d,x)&&(_===p||i(_,p,r,n,o)))return d.push(x)})){f=!1;break}}else if(!(_===w||i(_,w,r,n,o))){f=!1;break}}return o.delete(t),o.delete(e),f}var $i=X_;function Z_(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}var Ac=Z_;function ev(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var Cc=ev;var tv=1,rv=2,nv="[object Boolean]",iv="[object Date]",ov="[object Error]",sv="[object Map]",av="[object Number]",lv="[object RegExp]",uv="[object Set]",cv="[object String]",fv="[object Symbol]",dv="[object ArrayBuffer]",pv="[object DataView]",Sc=Fe?Fe.prototype:void 0,ws=Sc?Sc.valueOf:void 0;function hv(t,e,r,n,i,o,s){switch(r){case pv:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case dv:return!(t.byteLength!=e.byteLength||!o(new qr(t),new qr(e)));case nv:case iv:case av:return kt(+t,+e);case ov:return t.name==e.name&&t.message==e.message;case lv:case cv:return t==e+"";case sv:var a=Ac;case uv:var u=n&tv;if(a||(a=Cc),t.size!=e.size&&!u)return!1;var l=s.get(t);if(l)return l==e;n|=rv,s.set(t,e);var c=$i(a(t),a(e),n,i,o,s);return s.delete(t),c;case fv:if(ws)return ws.call(t)==ws.call(e)}return!1}var Ec=hv;var mv=1,gv=Object.prototype,yv=gv.hasOwnProperty;function _v(t,e,r,n,i,o){var s=r&mv,a=Pn(t),u=a.length,l=Pn(e),c=l.length;if(u!=c&&!s)return!1;for(var h=u;h--;){var f=a[h];if(!(s?f in e:yv.call(e,f)))return!1}var d=o.get(t),_=o.get(e);if(d&&_)return d==e&&_==t;var w=!0;o.set(t,e),o.set(e,t);for(var b=s;++h<u;){f=a[h];var p=t[f],x=e[f];if(n)var m=s?n(x,p,f,e,t,o):n(p,x,f,t,e,o);if(!(m===void 0?p===x||i(p,x,r,n,o):m)){w=!1;break}b||(b=f=="constructor")}if(w&&!b){var g=t.constructor,y=e.constructor;g!=y&&"constructor"in t&&"constructor"in e&&!(typeof g=="function"&&g instanceof g&&typeof y=="function"&&y instanceof y)&&(w=!1)}return o.delete(t),o.delete(e),w}var Fc=_v;var vv=1,Tc="[object Arguments]",Dc="[object Array]",Wi="[object Object]",bv=Object.prototype,Oc=bv.hasOwnProperty;function xv(t,e,r,n,i,o){var s=de(t),a=de(e),u=s?Dc:wt(t),l=a?Dc:wt(e);u=u==Tc?Wi:u,l=l==Tc?Wi:l;var c=u==Wi,h=l==Wi,f=u==l;if(f&&sr(t)){if(!sr(e))return!1;s=!0,c=!1}if(f&&!c)return o||(o=new Ht),s||Di(t)?$i(t,e,r,n,i,o):Ec(t,e,u,r,n,i,o);if(!(r&vv)){var d=c&&Oc.call(t,"__wrapped__"),_=h&&Oc.call(e,"__wrapped__");if(d||_){var w=d?t.value():t,b=_?e.value():e;return o||(o=new Ht),i(w,b,r,n,o)}}return f?(o||(o=new Ht),Fc(t,e,r,n,i,o)):!1}var Ic=xv;function Pc(t,e,r,n,i){return t===e?!0:t==null||e==null||!Be(t)&&!Be(e)?t!==t&&e!==e:Ic(t,e,r,n,Pc,i)}var Ui=Pc;var wv=1,jv=2;function Av(t,e,r,n){var i=r.length,o=i,s=!n;if(t==null)return!o;for(t=Object(t);i--;){var a=r[i];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<o;){a=r[i];var u=a[0],l=t[u],c=a[1];if(s&&a[2]){if(l===void 0&&!(u in t))return!1}else{var h=new Ht;if(n)var f=n(l,c,u,t,e,h);if(!(f===void 0?Ui(c,l,wv|jv,n,h):f))return!1}}return!0}var kc=Av;function Cv(t){return t===t&&!We(t)}var Gi=Cv;function Sv(t){for(var e=at(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,Gi(i)]}return e}var Mc=Sv;function Ev(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}var Qi=Ev;function Fv(t){var e=Mc(t);return e.length==1&&e[0][2]?Qi(e[0][0],e[0][1]):function(r){return r===t||kc(r,t,e)}}var Rc=Fv;function Tv(t,e){return t!=null&&e in Object(t)}var Lc=Tv;function Dv(t,e,r){e=ki(e,t);for(var n=-1,i=e.length,o=!1;++n<i;){var s=zt(e[n]);if(!(o=t!=null&&r(t,s)))break;t=t[s]}return o||++n!=i?o:(i=t==null?0:t.length,!!i&&Lr(i)&&Rr(s,i)&&(de(t)||Br(t)))}var Nc=Dv;function Ov(t,e){return t!=null&&Nc(t,e,Lc)}var Bc=Ov;var Iv=1,Pv=2;function kv(t,e){return zr(t)&&Gi(e)?Qi(zt(t),e):function(r){var n=Eu(r,t);return n===void 0&&n===e?Bc(r,t):Ui(e,n,Iv|Pv)}}var Kc=kv;function Mv(t){return function(e){return e==null?void 0:e[t]}}var zc=Mv;function Rv(t){return function(e){return Wr(e,t)}}var Hc=Rv;function Lv(t){return zr(t)?zc(zt(t)):Hc(t)}var Vc=Lv;function Nv(t){return typeof t=="function"?t:t==null?Pt:typeof t=="object"?de(t)?Kc(t[0],t[1]):Rc(t):Vc(t)}var $c=Nv;function Bv(t){return function(e,r,n){for(var i=-1,o=Object(e),s=n(e),a=s.length;a--;){var u=s[t?a:++i];if(r(o[u],u,o)===!1)break}return e}}var Wc=Bv;var Kv=Wc(),Uc=Kv;function zv(t,e){return t&&Uc(t,e,at)}var Gc=zv;function Hv(t,e){return function(r,n){if(r==null)return r;if(!st(r))return t(r,n);for(var i=r.length,o=e?i:-1,s=Object(r);(e?o--:++o<i)&&n(s[o],o,s)!==!1;);return r}}var Qc=Hv;var Vv=Qc(Gc),qc=Vv;var Yc=/[\\^$.*+?()[\]{}|]/g,$v=RegExp(Yc.source);function Wv(t){return t=Pi(t),t&&$v.test(t)?t.replace(Yc,"\\$&"):t}var Mn=Wv;function Uv(t,e){var r=-1,n=st(t)?Array(t.length):[];return qc(t,function(i,o,s){n[++r]=e(i,o,s)}),n}var Jc=Uv;function Gv(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}var Xc=Gv;function Qv(t,e){if(t!==e){var r=t!==void 0,n=t===null,i=t===t,o=_t(t),s=e!==void 0,a=e===null,u=e===e,l=_t(e);if(!a&&!l&&!o&&t>e||o&&s&&u&&!a&&!l||n&&s&&u||!r&&u||!i)return 1;if(!n&&!o&&!l&&t<e||l&&r&&i&&!n&&!o||a&&r&&i||!s&&i||!u)return-1}return 0}var Zc=Qv;function qv(t,e,r){for(var n=-1,i=t.criteria,o=e.criteria,s=i.length,a=r.length;++n<s;){var u=Zc(i[n],o[n]);if(u){if(n>=a)return u;var l=r[n];return u*(l=="desc"?-1:1)}}return t.index-e.index}var ef=qv;function Yv(t,e,r){e.length?e=kr(e,function(o){return de(o)?function(s){return Wr(s,o.length===1?o[0]:o)}:o}):e=[Pt];var n=-1;e=kr(e,Rt($c));var i=Jc(t,function(o,s,a){var u=kr(e,function(l){return l(o)});return{criteria:u,index:++n,value:o}});return Xc(i,function(o,s){return ef(o,s,r)})}var tf=Yv;var Jv=Ql(function(t,e){if(t==null)return[];var r=e.length;return r>1&&ys(t,e[0],e[1])?e=[]:r>2&&ys(e[0],e[1],e[2])&&(e=[e[0]]),tf(t,Ou(e,1),[])}),js=Jv;function Vt(t,e){try{return t.replace(new RegExp(e.map(r=>`\\b${Mn(r.match)}\\b`).join("|"),"giu"),r=>e.find(i=>r.match(new RegExp(`\\b${Mn(i.match)}\\b`,"giu")))?`<span class="${ol}">${r}</span>`:r)}catch(r){return console.error("Omnisearch - Error in highlightText()",r),t}}function Xv(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function Jr(t){if(!t.length)return/^$/g;t.sort((r,n)=>n.length-r.length);let e="("+(yi()?"":F.splitCamelCase?`^|${ps.source}|-|[A-Z]`:`^|${ps.source}|-`)+`)(${t.map(r=>Mn(r)).join("|")})`;return new RegExp(`${e}`,"gu")}function qi(t,e,r){t=t.toLowerCase();let n=new Date().getTime(),i=null,o=[],s=0;for(;(i=e.exec(t))!==null;){if(++s>=100||new Date().getTime()-n>50){_l("Stopped getMatches at",s,"results");break}let a=i[2];a&&i.index>=0&&o.push({match:a,offset:i.index+1})}if(r&&r.query.text.length>1){let a=t.indexOf(r.segmentsToStr());a>-1&&o.find(u=>u.offset===a)&&(o=o.filter(u=>u.offset!==a),o.unshift({offset:a,match:r.segmentsToStr()}))}return o}function Xr(t,e){try{let r=e??-1,n=Math.max(0,r-il),i=Math.min(t.length,r+En);if(r>-1?t=(n>0?"\u2026":"")+t.slice(n,i).trim()+(i<t.length-1?"\u2026":""):t=t.slice(0,En),F.renderLineReturnInExcerpts){let o=new RegExp(/(?:\r\n|\r|\n)/g);t=t.split(o).filter(a=>a).join(`
`);let s=t.lastIndexOf(`
`,r-n);s>0&&(t=t.slice(s))}return t=Xv(t),F.renderLineReturnInExcerpts&&(t=t.trim().replaceAll(`
`,"<br>")),{content:t,offset:r}}catch(r){return new rf.Notice("Omnisearch - Error while creating excerpt, see developer console"),console.error("Omnisearch - Error while creating excerpt"),console.error(r),{content:"",offset:-1}}}async function Yi(t,e=!1){let r=Jr(t.foundWords);r.exec(t.content);let n=r.lastIndex,i=!1;app.workspace.iterateAllLeaves(a=>{a.view instanceof As.MarkdownView&&!e&&a.getViewState().state?.file===t.path&&a.getViewState()?.pinned&&(app.workspace.setActiveLeaf(a,{focus:!0}),i=!0)}),i||await app.workspace.openLinkText(t.path,"",e);let o=app.workspace.getActiveViewOfType(As.MarkdownView);if(!o)return;let s=o.editor.offsetToPos(n);s.ch=0,o.editor.setCursor(s),o.editor.scrollIntoView({from:{line:s.line-10,ch:0},to:{line:s.line+10,ch:0}})}async function nf(t,e=!1){try{let r;switch(app.vault.getConfig("newFileLocation")){case"current":r=(app.workspace.getActiveFile()?.parent?.path??"")+"/";break;case"folder":r=app.vault.getConfig("newFileFolderPath")+"/";break;default:r="";break}await app.workspace.openLinkText(`${r}${t}.md`,"",e)}catch(r){throw r.message="OmniSearch - Could not create note: "+r.message,console.error(r),r}}function Zv(t){let e;return{c(){e=M("span"),e.innerHTML='<svg viewBox="0 0 100 100" class="add-note-glyph" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="M23.3,6.7c-3.7,0-6.7,3-6.7,6.7v73.3c0,3.7,3,6.7,6.7,6.7h28.4c-3.2-4.8-5.1-10.5-5.1-16.7c0-16.6,13.4-30,30-30 c2.3,0,4.5,0.3,6.7,0.8V31.7c0-0.9-0.3-1.7-1-2.4L60.7,7.6c-0.6-0.6-1.5-1-2.4-1L23.3,6.7z M56.7,13L77,33.3H60 c-1.8,0-3.3-1.5-3.3-3.3L56.7,13z M76.7,53.3c-12.9,0-23.3,10.4-23.3,23.3S63.8,100,76.7,100S100,89.6,100,76.7 S89.6,53.3,76.7,53.3z M76.7,63.3c1.8,0,3.3,1.5,3.3,3.3v6.7h6.7c1.8,0,3.3,1.5,3.3,3.3c0,1.8-1.5,3.3-3.3,3.3H80v6.7 c0,1.8-1.5,3.3-3.3,3.3c-1.8,0-3.3-1.5-3.3-3.3V80h-6.7c-1.8,0-3.3-1.5-3.3-3.3s1.5-3.3,3.3-3.3h6.7v-6.7 C73.3,64.8,74.8,63.3,76.7,63.3L76.7,63.3z"></path></svg>',N(e,"class","suggestion-flair"),N(e,"aria-label","Not created yet, select to create")},m(r,n){$(r,e,n)},p:he,i:he,o:he,d(r){r&&V(e)}}}function eb(t){"use strict";return[]}var of=class extends Te{constructor(e){super();Ie(this,e,eb,Zv,Ae,{})}},sf=of;function af(t){let e,r;return e=new sf({}),{c(){$e(e.$$.fragment)},m(n,i){Re(e,n,i),r=!0},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){ne(e.$$.fragment,n),r=!1},d(n){Oe(e,n)}}}function tb(t){let e,r,n,i,o,s=t[2]&&af(t),a=t[4].default,u=pr(a,t,t[3],null);return{c(){e=M("div"),s&&s.c(),r=W(),u&&u.c(),N(e,"data-result-id",t[0]),N(e,"class","suggestion-item omnisearch-result"),co(e,"is-selected",t[1])},m(l,c){$(l,e,c),s&&s.m(e,null),D(e,r),u&&u.m(e,null),n=!0,i||(o=[Ve(e,"mousemove",t[5]),Ve(e,"click",t[6]),Ve(e,"keypress",t[7]),Ve(e,"auxclick",t[8])],i=!0)},p(l,[c]){l[2]?s?c&4&&ee(s,1):(s=af(l),s.c(),ee(s,1),s.m(e,r)):s&&(Ut(),ne(s,1,1,()=>{s=null}),Gt()),u&&u.p&&(!n||c&8)&&mr(u,a,l,l[3],n?hr(a,l[3],c,null):gr(l[3]),null),(!n||c&1)&&N(e,"data-result-id",l[0]),(!n||c&2)&&co(e,"is-selected",l[1])},i(l){n||(ee(s),ee(u,l),n=!0)},o(l){ne(s),ne(u,l),n=!1},d(l){l&&V(e),s&&s.d(),u&&u.d(l),i=!1,Xe(o)}}}function rb(t,e,r){let{$$slots:n={},$$scope:i}=e,{id:o}=e,{selected:s=!1}=e,{glyph:a=!1}=e;function u(f){Qe.call(this,t,f)}function l(f){Qe.call(this,t,f)}function c(f){Qe.call(this,t,f)}function h(f){Qe.call(this,t,f)}return t.$$set=f=>{"id"in f&&r(0,o=f.id),"selected"in f&&r(1,s=f.selected),"glyph"in f&&r(2,a=f.glyph),"$$scope"in f&&r(3,i=f.$$scope)},[o,s,a,i,n,u,l,c,h]}var lf=class extends Te{constructor(e){super();Ie(this,e,rb,tb,Ae,{id:0,selected:1,glyph:2})}},Ji=lf;var Zr=me(require("obsidian"));function uf(t){let e,r=t[1].matches.length+"",n,i,o=(t[1].matches.length>1?"matches":"match")+"",s;return{c(){e=M("span"),n=Ce(r),i=Ce("\xA0"),s=Ce(o),N(e,"class","omnisearch-result__counter")},m(a,u){$(a,e,u),D(e,n),D(e,i),D(e,s)},p(a,u){u&2&&r!==(r=a[1].matches.length+"")&&Ze(n,r),u&2&&o!==(o=(a[1].matches.length>1?"matches":"match")+"")&&Ze(s,o)},d(a){a&&V(e)}}}function cf(t){let e,r,n,i,o;return{c(){e=M("div"),r=M("span"),n=W(),i=M("span"),o=Ce(t[7]),N(e,"class","omnisearch-result__folder-path")},m(s,a){$(s,e,a),D(e,r),t[14](r),D(e,n),D(e,i),D(i,o)},p(s,a){a&128&&Ze(o,s[7])},d(s){s&&V(e),t[14](null)}}}function ff(t){let e,r=Vt(t[5].content,t[9])+"";return{c(){e=M("div"),N(e,"class","omnisearch-result__body")},m(n,i){$(n,e,i),e.innerHTML=r},p(n,i){i&544&&r!==(r=Vt(n[5].content,n[9])+"")&&(e.innerHTML=r)},d(n){n&&V(e)}}}function df(t){let e,r,n;return{c(){e=M("div"),r=M("img"),Ge(r,"width","100px"),lo(r.src,n=t[6])||N(r,"src",n),N(r,"alt",""),N(e,"class","omnisearch-result__image-container")},m(i,o){$(i,e,o),D(e,r)},p(i,o){o&64&&!lo(r.src,n=i[6])&&N(r,"src",n)},d(i){i&&V(e)}}}function nb(t){let e,r,n,i,o,s,a=Vt(t[2],t[10])+"",u,l,c,h=or(t[1].path)+"",f,d,_,w,b,p,x=t[1].matches.length>0&&uf(t),m=t[7]&&cf(t),g=t[11]&&ff(t),y=t[6]&&df(t);return{c(){e=M("div"),r=M("div"),n=M("span"),i=M("span"),o=W(),s=M("span"),u=W(),l=M("span"),c=Ce("."),f=Ce(h),d=W(),x&&x.c(),_=W(),m&&m.c(),w=W(),b=M("div"),g&&g.c(),p=W(),y&&y.c(),N(l,"class","omnisearch-result__extension"),N(n,"class","omnisearch-result__title"),N(r,"class","omnisearch-result__title-container"),Ge(b,"display","flex"),Ge(b,"flex-direction","row")},m(v,j){$(v,e,j),D(e,r),D(r,n),D(n,i),t[13](i),D(n,o),D(n,s),s.innerHTML=a,D(n,u),D(n,l),D(l,c),D(l,f),D(n,d),x&&x.m(n,null),D(e,_),m&&m.m(e,null),D(e,w),D(e,b),g&&g.m(b,null),D(b,p),y&&y.m(b,null)},p(v,j){j&1028&&a!==(a=Vt(v[2],v[10])+"")&&(s.innerHTML=a),j&2&&h!==(h=or(v[1].path)+"")&&Ze(f,h),v[1].matches.length>0?x?x.p(v,j):(x=uf(v),x.c(),x.m(n,null)):x&&(x.d(1),x=null),v[7]?m?m.p(v,j):(m=cf(v),m.c(),m.m(e,w)):m&&(m.d(1),m=null),v[11]?g?g.p(v,j):(g=ff(v),g.c(),g.m(b,p)):g&&(g.d(1),g=null),v[6]?y?y.p(v,j):(y=df(v),y.c(),y.m(b,null)):y&&(y.d(1),y=null)},d(v){v&&V(e),t[13](null),x&&x.d(),m&&m.d(),g&&g.d(),y&&y.d()}}}function ib(t){let e,r;return e=new Ji({props:{glyph:t[8],id:t[1].path,selected:t[0],$$slots:{default:[nb]},$$scope:{ctx:t}}}),e.$on("click",t[15]),e.$on("auxclick",t[16]),e.$on("mousemove",t[17]),{c(){$e(e.$$.fragment)},m(n,i){Re(e,n,i),r=!0},p(n,[i]){let o={};i&256&&(o.glyph=n[8]),i&2&&(o.id=n[1].path),i&1&&(o.selected=n[0]),i&265982&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){ne(e.$$.fragment,n),r=!1},d(n){Oe(e,n)}}}function ob(t,e,r){let n,i,o,s,a,u;Kn(t,tr,y=>r(11,u=y));let{selected:l=!1}=e,{note:c}=e,h=null,f="",d="",_,w;function b(y){lt[y?"unshift":"push"](()=>{w=y,r(4,w)})}function p(y){lt[y?"unshift":"push"](()=>{_=y,r(3,_)})}function x(y){Qe.call(this,t,y)}function m(y){Qe.call(this,t,y)}function g(y){Qe.call(this,t,y)}t.$$set=y=>{"selected"in y&&r(0,l=y.selected),"note"in y&&r(1,c=y.note)},t.$$.update=()=>{if(t.$$.dirty&2){e:if(r(6,h=null),Ir(c.path)){let y=app.vault.getFiles().find(v=>v.path===c.path);y&&r(6,h=app.vault.getResourcePath(y))}}if(t.$$.dirty&2){e:r(12,n=Jr(c.foundWords))}if(t.$$.dirty&30){e:r(2,f=c.basename),r(7,d=fl(c.path)),F.ignoreDiacritics&&r(2,f=yt(f)),_&&(0,Zr.setIcon)(_,"folder-open"),w&&(Ir(c.path)?(0,Zr.setIcon)(w,"image"):ir(c.path)?(0,Zr.setIcon)(w,"file-text"):Pr(c.path)?(0,Zr.setIcon)(w,"layout-dashboard"):(0,Zr.setIcon)(w,"file"))}if(t.$$.dirty&4100){e:r(10,i=qi(f,n))}if(t.$$.dirty&2){e:r(5,s=Xr(c.content,c.matches[0]?.offset??-1))}if(t.$$.dirty&34){e:r(9,o=kn(c.matches).map(y=>(y.offset=y.offset-s.offset,y)))}};e:r(8,a=!1);return[l,c,f,_,w,s,h,d,a,o,i,u,n,b,p,x,m,g]}var pf=class extends Te{constructor(e){super();Ie(this,e,ob,ib,Ae,{selected:0,note:1})}},hf=pf;var _f=me(yf()),Cs=["ext","path"],ur=class{#e;constructor(e=""){F.ignoreDiacritics&&(e=yt(e));let r=(0,_f.parse)(e.toLowerCase(),{tokenize:!0,keywords:Cs});r.text=r.text??[],r.exclude=r.exclude??{},r.exclude.text=r.exclude.text??[],Array.isArray(r.exclude.text)||(r.exclude.text=[r.exclude.text]),r.exclude.text=r.exclude.text.filter(n=>n.length);for(let n of Cs){let i=r[n];i&&(r[n]=Array.isArray(i)?i:[i]);let o=r.exclude[n];o&&(r.exclude[n]=Array.isArray(o)?o:[o])}this.query=r,this.#e=e.match(/"([^"]+)"/g)?.map(n=>n.replace(/"/g,""))??[]}isEmpty(){for(let e of Cs)if(this.query[e]?.length||this.query.text.length)return!1;return!0}segmentsToStr(){return this.query.text.join(" ")}getTags(){return this.query.text.filter(e=>e.startsWith("#"))}getTagsWithoutHashtag(){return this.getTags().map(e=>e.replace(/^#/,""))}getExactTerms(){return[...new Set([...this.query.text.filter(e=>e.split(" ").length>1),...this.#e].map(e=>e.toLowerCase()))]}};var ce=function(){return ce=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},ce.apply(this,arguments)};function sb(t,e,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(c){try{l(n.next(c))}catch(h){s(h)}}function u(c){try{l(n.throw(c))}catch(h){s(h)}}function l(c){c.done?o(c.value):i(c.value).then(a,u)}l((n=n.apply(t,e||[])).next())})}function ab(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(c){l=[6,c],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Q(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ve(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}var lb="ENTRIES",vf="KEYS",bf="VALUES",De="",Ss=function(){function t(e,r){var n=e._tree,i=Array.from(n.keys());this.set=e,this._type=r,this._path=i.length>0?[{node:n,keys:i}]:[]}return t.prototype.next=function(){var e=this.dive();return this.backtrack(),e},t.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=en(this._path),r=e.node,n=e.keys;if(en(n)===De)return{done:!1,value:this.result()};var i=r.get(en(n));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},t.prototype.backtrack=function(){if(this._path.length!==0){var e=en(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},t.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var r=e.keys;return en(r)}).filter(function(e){return e!==De}).join("")},t.prototype.value=function(){return en(this._path).node.get(De)},t.prototype.result=function(){switch(this._type){case bf:return this.value();case vf:return this.key();default:return[this.key(),this.value()]}},t.prototype[Symbol.iterator]=function(){return this},t}(),en=function(t){return t[t.length-1]},ub=function(t,e,r){var n=new Map;if(e===void 0)return n;for(var i=e.length+1,o=i+r,s=new Uint8Array(o*i).fill(r+1),a=0;a<i;++a)s[a]=a;for(var u=1;u<o;++u)s[u*i]=u;return xf(t,e,r,n,s,1,i,""),n},xf=function(t,e,r,n,i,o,s,a){var u,l,c=o*s;try{e:for(var h=Q(t.keys()),f=h.next();!f.done;f=h.next()){var d=f.value;if(d===De){var _=i[c-1];_<=r&&n.set(a,[t.get(d),_])}else{for(var w=o,b=0;b<d.length;++b,++w){for(var p=d[b],x=s*w,m=x-s,g=i[x],y=Math.max(0,w-r-1),v=Math.min(s-1,w+r),j=y;j<v;++j){var A=p!==e[j],E=i[m+j]+ +A,T=i[m+j+1]+1,I=i[x+j]+1,L=i[x+j+1]=Math.min(E,T,I);L<g&&(g=L)}if(g>r)continue e}xf(t.get(d),e,r,n,i,w,s,a+d)}}}catch(P){u={error:P}}finally{try{f&&!f.done&&(l=h.return)&&l.call(h)}finally{if(u)throw u.error}}},Es=function(){function t(e,r){e===void 0&&(e=new Map),r===void 0&&(r=""),this._size=void 0,this._tree=e,this._prefix=r}return t.prototype.atPrefix=function(e){var r,n;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=ve(Zi(this._tree,e.slice(this._prefix.length)),2),o=i[0],s=i[1];if(o===void 0){var a=ve(Ds(s),2),u=a[0],l=a[1];try{for(var c=Q(u.keys()),h=c.next();!h.done;h=c.next()){var f=h.value;if(f!==De&&f.startsWith(l)){var d=new Map;return d.set(f.slice(l.length),u.get(f)),new t(d,e)}}}catch(_){r={error:_}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}return new t(o,e)},t.prototype.clear=function(){this._size=void 0,this._tree.clear()},t.prototype.delete=function(e){return this._size=void 0,cb(this._tree,e)},t.prototype.entries=function(){return new Ss(this,lb)},t.prototype.forEach=function(e){var r,n;try{for(var i=Q(this),o=i.next();!o.done;o=i.next()){var s=ve(o.value,2),a=s[0],u=s[1];e(a,u,this)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.fuzzyGet=function(e,r){return ub(this._tree,e,r)},t.prototype.get=function(e){var r=Fs(this._tree,e);return r!==void 0?r.get(De):void 0},t.prototype.has=function(e){var r=Fs(this._tree,e);return r!==void 0&&r.has(De)},t.prototype.keys=function(){return new Ss(this,vf)},t.prototype.set=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Ts(this._tree,e);return n.set(De,r),this},Object.defineProperty(t.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),t.prototype.update=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Ts(this._tree,e);return n.set(De,r(n.get(De))),this},t.prototype.fetch=function(e,r){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var n=Ts(this._tree,e),i=n.get(De);return i===void 0&&n.set(De,i=r()),i},t.prototype.values=function(){return new Ss(this,bf)},t.prototype[Symbol.iterator]=function(){return this.entries()},t.from=function(e){var r,n,i=new t;try{for(var o=Q(e),s=o.next();!s.done;s=o.next()){var a=ve(s.value,2),u=a[0],l=a[1];i.set(u,l)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},t.fromObject=function(e){return t.from(Object.entries(e))},t}(),Zi=function(t,e,r){var n,i;if(r===void 0&&(r=[]),e.length===0||t==null)return[t,r];try{for(var o=Q(t.keys()),s=o.next();!s.done;s=o.next()){var a=s.value;if(a!==De&&e.startsWith(a))return r.push([t,a]),Zi(t.get(a),e.slice(a.length),r)}}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r.push([t,e]),Zi(void 0,"",r)},Fs=function(t,e){var r,n;if(e.length===0||t==null)return t;try{for(var i=Q(t.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;if(s!==De&&e.startsWith(s))return Fs(t.get(s),e.slice(s.length))}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},Ts=function(t,e){var r,n,i=e.length;e:for(var o=0;t&&o<i;){try{for(var s=(r=void 0,Q(t.keys())),a=s.next();!a.done;a=s.next()){var u=a.value;if(u!==De&&e[o]===u[0]){for(var l=Math.min(i-o,u.length),c=1;c<l&&e[o+c]===u[c];)++c;var h=t.get(u);if(c===u.length)t=h;else{var f=new Map;f.set(u.slice(c),h),t.set(e.slice(o,o+c),f),t.delete(u),t=f}o+=c;continue e}}}catch(_){r={error:_}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}var d=new Map;return t.set(e.slice(o),d),d}return t},cb=function(t,e){var r=ve(Zi(t,e),2),n=r[0],i=r[1];if(n!==void 0){if(n.delete(De),n.size===0)wf(i);else if(n.size===1){var o=ve(n.entries().next().value,2),s=o[0],a=o[1];jf(i,s,a)}}},wf=function(t){if(t.length!==0){var e=ve(Ds(t),2),r=e[0],n=e[1];if(r.delete(n),r.size===0)wf(t.slice(0,-1));else if(r.size===1){var i=ve(r.entries().next().value,2),o=i[0],s=i[1];o!==De&&jf(t.slice(0,-1),o,s)}}},jf=function(t,e,r){if(t.length!==0){var n=ve(Ds(t),2),i=n[0],o=n[1];i.set(o+e,r),i.delete(o)}},Ds=function(t){return t[t.length-1]},Rn,Os="or",Af="and",fb="and_not",Is=function(){function t(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var r=e.autoVacuum==null||e.autoVacuum===!0?Ls:e.autoVacuum;this._options=ce(ce(ce({},ks),e),{autoVacuum:r,searchOptions:ce(ce({},Cf),e.searchOptions||{}),autoSuggestOptions:ce(ce({},gb),e.autoSuggestOptions||{})}),this._index=new Es,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Rs,this.addFields(this._options.fields)}return t.prototype.add=function(e){var r,n,i,o,s,a,u=this._options,l=u.extractField,c=u.tokenize,h=u.processTerm,f=u.fields,d=u.idField,_=l(e,d);if(_==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(_))throw new Error("MiniSearch: duplicate ID ".concat(_));var w=this.addDocumentId(_);this.saveStoredFields(w,e);try{for(var b=Q(f),p=b.next();!p.done;p=b.next()){var x=p.value,m=l(e,x);if(m!=null){var g=c(m.toString(),x),y=this._fieldIds[x],v=new Set(g).size;this.addFieldLength(w,y,this._documentCount-1,v);try{for(var j=(i=void 0,Q(g)),A=j.next();!A.done;A=j.next()){var E=A.value,T=h(E,x);if(Array.isArray(T))try{for(var I=(s=void 0,Q(T)),L=I.next();!L.done;L=I.next()){var P=L.value;this.addTerm(y,w,P)}}catch(z){s={error:z}}finally{try{L&&!L.done&&(a=I.return)&&a.call(I)}finally{if(s)throw s.error}}else T&&this.addTerm(y,w,T)}}catch(z){i={error:z}}finally{try{A&&!A.done&&(o=j.return)&&o.call(j)}finally{if(i)throw i.error}}}}}catch(z){r={error:z}}finally{try{p&&!p.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}},t.prototype.addAll=function(e){var r,n;try{for(var i=Q(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.addAllAsync=function(e,r){var n=this;r===void 0&&(r={});var i=r.chunkSize,o=i===void 0?10:i,s={chunk:[],promise:Promise.resolve()},a=e.reduce(function(c,h,f){var d=c.chunk,_=c.promise;return d.push(h),(f+1)%o==0?{chunk:[],promise:_.then(function(){return new Promise(function(w){return setTimeout(w,0)})}).then(function(){return n.addAll(d)})}:{chunk:d,promise:_}},s),u=a.chunk,l=a.promise;return l.then(function(){return n.addAll(u)})},t.prototype.remove=function(e){var r,n,i,o,s,a,u=this._options,l=u.tokenize,c=u.processTerm,h=u.extractField,f=u.fields,d=u.idField,_=h(e,d);if(_==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var w=this._idToShortId.get(_);if(w==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(_,": it is not in the index"));try{for(var b=Q(f),p=b.next();!p.done;p=b.next()){var x=p.value,m=h(e,x);if(m!=null){var g=l(m.toString(),x),y=this._fieldIds[x],v=new Set(g).size;this.removeFieldLength(w,y,this._documentCount,v);try{for(var j=(i=void 0,Q(g)),A=j.next();!A.done;A=j.next()){var E=A.value,T=c(E,x);if(Array.isArray(T))try{for(var I=(s=void 0,Q(T)),L=I.next();!L.done;L=I.next()){var P=L.value;this.removeTerm(y,w,P)}}catch(z){s={error:z}}finally{try{L&&!L.done&&(a=I.return)&&a.call(I)}finally{if(s)throw s.error}}else T&&this.removeTerm(y,w,T)}}catch(z){i={error:z}}finally{try{A&&!A.done&&(o=j.return)&&o.call(j)}finally{if(i)throw i.error}}}}}catch(z){r={error:z}}finally{try{p&&!p.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}this._storedFields.delete(w),this._documentIds.delete(w),this._idToShortId.delete(_),this._fieldLength.delete(w),this._documentCount-=1},t.prototype.removeAll=function(e){var r,n;if(e)try{for(var i=Q(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.remove(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Es,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},t.prototype.discard=function(e){var r=this,n=this._idToShortId.get(e);if(n==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach(function(i,o){r.removeFieldLength(n,o,r._documentCount,i)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},t.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,r=e.minDirtFactor,n=e.minDirtCount,i=e.batchSize,o=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:o},{minDirtCount:n,minDirtFactor:r})}},t.prototype.discardAll=function(e){var r,n,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var o=Q(e),s=o.next();!s.done;s=o.next()){var a=s.value;this.discard(a)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},t.prototype.replace=function(e){var r=this._options,n=r.idField,i=r.extractField,o=i(e,n);this.discard(o),this.add(e)},t.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},t.prototype.conditionalVacuum=function(e,r){var n=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&r,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=n._enqueuedVacuumConditions;return n._enqueuedVacuumConditions=Rs,n.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(r)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},t.prototype.performVacuuming=function(e,r){return sb(this,void 0,void 0,function(){var n,i,o,s,a,u,l,c,h,f,d,_,w,b,p,x,m,g,y,v,j,A,E,T,I;return ab(this,function(L){switch(L.label){case 0:if(n=this._dirtCount,!this.vacuumConditionsMet(r))return[3,10];i=e.batchSize||Ms.batchSize,o=e.batchWait||Ms.batchWait,s=1,L.label=1;case 1:L.trys.push([1,7,8,9]),a=Q(this._index),u=a.next(),L.label=2;case 2:if(u.done)return[3,6];l=ve(u.value,2),c=l[0],h=l[1];try{for(f=(A=void 0,Q(h)),d=f.next();!d.done;d=f.next()){_=ve(d.value,2),w=_[0],b=_[1];try{for(p=(T=void 0,Q(b)),x=p.next();!x.done;x=p.next())m=ve(x.value,1),g=m[0],!this._documentIds.has(g)&&(b.size<=1?h.delete(w):b.delete(g))}catch(P){T={error:P}}finally{try{x&&!x.done&&(I=p.return)&&I.call(p)}finally{if(T)throw T.error}}}}catch(P){A={error:P}}finally{try{d&&!d.done&&(E=f.return)&&E.call(f)}finally{if(A)throw A.error}}return this._index.get(c).size===0&&this._index.delete(c),s%i!=0?[3,4]:[4,new Promise(function(P){return setTimeout(P,o)})];case 3:L.sent(),L.label=4;case 4:s+=1,L.label=5;case 5:return u=a.next(),[3,2];case 6:return[3,9];case 7:return y=L.sent(),v={error:y},[3,9];case 8:try{u&&!u.done&&(j=a.return)&&j.call(a)}finally{if(v)throw v.error}return[7];case 9:this._dirtCount-=n,L.label=10;case 10:return[4,null];case 11:return L.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},t.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var r=e.minDirtCount,n=e.minDirtFactor;return r=r||Ls.minDirtCount,n=n||Ls.minDirtFactor,this.dirtCount>=r&&this.dirtFactor>=n},Object.defineProperty(t.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),t.prototype.has=function(e){return this._idToShortId.has(e)},t.prototype.search=function(e,r){var n,i;r===void 0&&(r={});var o=this.executeQuery(e,r),s=[];try{for(var a=Q(o),u=a.next();!u.done;u=a.next()){var l=ve(u.value,2),c=l[0],h=l[1],f=h.score,d=h.terms,_=h.match,w=d.length,b={id:this._documentIds.get(c),score:f*w,terms:Object.keys(_),match:_};Object.assign(b,this._storedFields.get(c)),(r.filter==null||r.filter(b))&&s.push(b)}}catch(p){n={error:p}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s.sort(Ef),s},t.prototype.autoSuggest=function(e,r){var n,i,o,s;r===void 0&&(r={}),r=ce(ce({},this._options.autoSuggestOptions),r);var a=new Map;try{for(var u=Q(this.search(e,r)),l=u.next();!l.done;l=u.next()){var c=l.value,h=c.score,f=c.terms,d=f.join(" "),_=a.get(d);_!=null?(_.score+=h,_.count+=1):a.set(d,{score:h,terms:f,count:1})}}catch(y){n={error:y}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}var w=[];try{for(var b=Q(a),p=b.next();!p.done;p=b.next()){var x=ve(p.value,2),_=x[0],m=x[1],h=m.score,f=m.terms,g=m.count;w.push({suggestion:_,terms:f,score:h/g})}}catch(y){o={error:y}}finally{try{p&&!p.done&&(s=b.return)&&s.call(b)}finally{if(o)throw o.error}}return w.sort(Ef),w},Object.defineProperty(t.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),t.loadJSON=function(e,r){if(r==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),r)},t.getDefault=function(e){if(ks.hasOwnProperty(e))return Ps(ks,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},t.loadJS=function(e,r){var n,i,o,s,a,u,l=e.index,c=e.documentCount,h=e.nextId,f=e.documentIds,d=e.fieldIds,_=e.fieldLength,w=e.averageFieldLength,b=e.storedFields,p=e.dirtCount,x=e.serializationVersion;if(x!==1&&x!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var m=new t(r);m._documentCount=c,m._nextId=h,m._documentIds=eo(f),m._idToShortId=new Map,m._fieldIds=d,m._fieldLength=eo(_),m._avgFieldLength=w,m._storedFields=eo(b),m._dirtCount=p||0,m._index=new Es;try{for(var g=Q(m._documentIds),y=g.next();!y.done;y=g.next()){var v=ve(y.value,2),j=v[0],A=v[1];m._idToShortId.set(A,j)}}catch(S){n={error:S}}finally{try{y&&!y.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}try{for(var E=Q(l),T=E.next();!T.done;T=E.next()){var I=ve(T.value,2),L=I[0],P=I[1],z=new Map;try{for(var J=(a=void 0,Q(Object.keys(P))),Y=J.next();!Y.done;Y=J.next()){var q=Y.value,C=P[q];x===1&&(C=C.ds),z.set(parseInt(q,10),eo(C))}}catch(S){a={error:S}}finally{try{Y&&!Y.done&&(u=J.return)&&u.call(J)}finally{if(a)throw a.error}}m._index.set(L,z)}}catch(S){o={error:S}}finally{try{T&&!T.done&&(s=E.return)&&s.call(E)}finally{if(o)throw o.error}}return m},t.prototype.executeQuery=function(e,r){var n=this;if(r===void 0&&(r={}),typeof e!="string"){var i=ce(ce(ce({},r),e),{queries:void 0}),o=e.queries.map(function(b){return n.executeQuery(b,i)});return this.combineResults(o,e.combineWith)}var s=this._options,a=s.tokenize,u=s.processTerm,l=s.searchOptions,c=ce(ce({tokenize:a,processTerm:u},l),r),h=c.tokenize,f=c.processTerm,d=h(e).flatMap(function(b){return f(b)}).filter(function(b){return!!b}),_=d.map(mb(c)),w=_.map(function(b){return n.executeQuerySpec(b,c)});return this.combineResults(w,c.combineWith)},t.prototype.executeQuerySpec=function(e,r){var n,i,o,s,a=ce(ce({},this._options.searchOptions),r),u=(a.fields||this._options.fields).reduce(function(q,C){var S;return ce(ce({},q),(S={},S[C]=Ps(q,C)||1,S))},a.boost||{}),l=a.boostDocument,c=a.weights,h=a.maxFuzzy,f=a.bm25,d=ce(ce({},Cf.weights),c),_=d.fuzzy,w=d.prefix,b=this._index.get(e.term),p=this.termResults(e.term,e.term,1,b,u,l,f),x,m;if(e.prefix&&(x=this._index.atPrefix(e.term)),e.fuzzy){var g=e.fuzzy===!0?.2:e.fuzzy,y=g<1?Math.min(h,Math.round(e.term.length*g)):g;y&&(m=this._index.fuzzyGet(e.term,y))}if(x)try{for(var v=Q(x),j=v.next();!j.done;j=v.next()){var A=ve(j.value,2),E=A[0],T=A[1],I=E.length-e.term.length;if(!!I){m==null||m.delete(E);var L=w*E.length/(E.length+.3*I);this.termResults(e.term,E,L,T,u,l,f,p)}}}catch(q){n={error:q}}finally{try{j&&!j.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}if(m)try{for(var P=Q(m.keys()),z=P.next();!z.done;z=P.next()){var E=z.value,J=ve(m.get(E),2),Y=J[0],I=J[1];if(!!I){var L=_*E.length/(E.length+I);this.termResults(e.term,E,L,Y,u,l,f,p)}}}catch(q){o={error:q}}finally{try{z&&!z.done&&(s=P.return)&&s.call(P)}finally{if(o)throw o.error}}return p},t.prototype.combineResults=function(e,r){if(r===void 0&&(r=Os),e.length===0)return new Map;var n=r.toLowerCase();return e.reduce(db[n])||new Map},t.prototype.toJSON=function(){var e,r,n,i,o=[];try{for(var s=Q(this._index),a=s.next();!a.done;a=s.next()){var u=ve(a.value,2),l=u[0],c=u[1],h={};try{for(var f=(n=void 0,Q(c)),d=f.next();!d.done;d=f.next()){var _=ve(d.value,2),w=_[0],b=_[1];h[w]=Object.fromEntries(b)}}catch(p){n={error:p}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}o.push([l,h])}}catch(p){e={error:p}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:o,serializationVersion:2}},t.prototype.termResults=function(e,r,n,i,o,s,a,u){var l,c,h,f,d;if(u===void 0&&(u=new Map),i==null)return u;try{for(var _=Q(Object.keys(o)),w=_.next();!w.done;w=_.next()){var b=w.value,p=o[b],x=this._fieldIds[b],m=i.get(x);if(m!=null){var g=m.size,y=this._avgFieldLength[x];try{for(var v=(h=void 0,Q(m.keys())),j=v.next();!j.done;j=v.next()){var A=j.value;if(!this._documentIds.has(A)){this.removeTerm(x,A,r),g-=1;continue}var E=s?s(this._documentIds.get(A),r):1;if(!!E){var T=m.get(A),I=this._fieldLength.get(A)[x],L=hb(T,g,this._documentCount,I,y,a),P=n*p*E*L,z=u.get(A);if(z){z.score+=P,yb(z.terms,e);var J=Ps(z.match,r);J?J.push(b):z.match[r]=[b]}else u.set(A,{score:P,terms:[e],match:(d={},d[r]=[b],d)})}}}catch(Y){h={error:Y}}finally{try{j&&!j.done&&(f=v.return)&&f.call(v)}finally{if(h)throw h.error}}}}}catch(Y){l={error:Y}}finally{try{w&&!w.done&&(c=_.return)&&c.call(_)}finally{if(l)throw l.error}}return u},t.prototype.addTerm=function(e,r,n){var i=this._index.fetch(n,Ff),o=i.get(e);if(o==null)o=new Map,o.set(r,1),i.set(e,o);else{var s=o.get(r);o.set(r,(s||0)+1)}},t.prototype.removeTerm=function(e,r,n){if(!this._index.has(n)){this.warnDocumentChanged(r,e,n);return}var i=this._index.fetch(n,Ff),o=i.get(e);o==null||o.get(r)==null?this.warnDocumentChanged(r,e,n):o.get(r)<=1?o.size<=1?i.delete(e):o.delete(r):o.set(r,o.get(r)-1),this._index.get(n).size===0&&this._index.delete(n)},t.prototype.warnDocumentChanged=function(e,r,n){var i,o;try{for(var s=Q(Object.keys(this._fieldIds)),a=s.next();!a.done;a=s.next()){var u=a.value;if(this._fieldIds[u]===r){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(n,'" was not present in field "').concat(u,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}},t.prototype.addDocumentId=function(e){var r=this._nextId;return this._idToShortId.set(e,r),this._documentIds.set(r,e),this._documentCount+=1,this._nextId+=1,r},t.prototype.addFields=function(e){for(var r=0;r<e.length;r++)this._fieldIds[e[r]]=r},t.prototype.addFieldLength=function(e,r,n,i){var o=this._fieldLength.get(e);o==null&&this._fieldLength.set(e,o=[]),o[r]=i;var s=this._avgFieldLength[r]||0,a=s*n+i;this._avgFieldLength[r]=a/(n+1)},t.prototype.removeFieldLength=function(e,r,n,i){if(n===1){this._avgFieldLength[r]=0;return}var o=this._avgFieldLength[r]*n-i;this._avgFieldLength[r]=o/(n-1)},t.prototype.saveStoredFields=function(e,r){var n,i,o=this._options,s=o.storeFields,a=o.extractField;if(!(s==null||s.length===0)){var u=this._storedFields.get(e);u==null&&this._storedFields.set(e,u={});try{for(var l=Q(s),c=l.next();!c.done;c=l.next()){var h=c.value,f=a(r,h);f!==void 0&&(u[h]=f)}}catch(d){n={error:d}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}}},t}(),Ps=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},db=(Rn={},Rn[Os]=function(t,e){var r,n;try{for(var i=Q(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value,a=t.get(s);if(a==null)t.set(s,e.get(s));else{var u=e.get(s),l=u.score,c=u.terms,h=u.match;a.score=a.score+l,a.match=Object.assign(a.match,h),Sf(a.terms,c)}}}catch(f){r={error:f}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},Rn[Af]=function(t,e){var r,n,i=new Map;try{for(var o=Q(e.keys()),s=o.next();!s.done;s=o.next()){var a=s.value,u=t.get(a);if(u!=null){var l=e.get(a),c=l.score,h=l.terms,f=l.match;Sf(u.terms,h),i.set(a,{score:u.score+c,terms:u.terms,match:Object.assign(u.match,f)})}}}catch(d){r={error:d}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},Rn[fb]=function(t,e){var r,n;try{for(var i=Q(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;t.delete(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t},Rn),pb={k:1.2,b:.7,d:.5},hb=function(t,e,r,n,i,o){var s=o.k,a=o.b,u=o.d,l=Math.log(1+(r-e+.5)/(e+.5));return l*(u+t*(s+1)/(t+s*(1-a+a*n/i)))},mb=function(t){return function(e,r,n){var i=typeof t.fuzzy=="function"?t.fuzzy(e,r,n):t.fuzzy||!1,o=typeof t.prefix=="function"?t.prefix(e,r,n):t.prefix===!0;return{term:e,fuzzy:i,prefix:o}}},ks={idField:"id",extractField:function(t,e){return t[e]},tokenize:function(t,e){return t.split(_b)},processTerm:function(t,e){return t.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(t,e,r){return console!=null&&console.warn!=null&&console[t](e)},autoVacuum:!0},Cf={combineWith:Os,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:pb},gb={combineWith:Af,prefix:function(t,e,r){return e===r.length-1}},Ms={batchSize:1e3,batchWait:10},Rs={minDirtFactor:.1,minDirtCount:20},Ls=ce(ce({},Ms),Rs),yb=function(t,e){t.includes(e)||t.push(e)},Sf=function(t,e){var r,n;try{for(var i=Q(e),o=i.next();!o.done;o=i.next()){var s=o.value;t.includes(s)||t.push(s)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},Ef=function(t,e){var r=t.score,n=e.score;return n-r},Ff=function(){return new Map},eo=function(t){var e,r,n=new Map;try{for(var i=Q(Object.keys(t)),o=i.next();!o.done;o=i.next()){var s=o.value;n.set(parseInt(s,10),t[s])}}catch(a){e={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},_b=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var Tf=me(require("obsidian"));var vb=t=>{let e=t.split(Fn);e=[...e,...e.flatMap(yl)],e=[...e,...e.flatMap(gl)];let r=yi();return r&&(e=e.flatMap(n=>nl.test(n)?r.cut(n):[n])),e},to=class{constructor(){this.indexedDocuments=new Map;this.minisearch=new Is(to.options)}async loadCache(){let e=await Ee.getMinisearchCache();return e?(this.minisearch=Is.loadJS(e.data,to.options),this.indexedDocuments=new Map(e.paths.map(r=>[r.path,r.mtime])),!0):(console.log("Omnisearch - No cache found"),!1)}getDiff(e){let r=new Map(e.map(o=>[o.path,o.mtime])),n=e.filter(o=>!this.indexedDocuments.has(o.path)||this.indexedDocuments.get(o.path)!==o.mtime),i=[...this.indexedDocuments].filter(([o,s])=>!r.has(o)||r.get(o)!==s).map(o=>({path:o[0],mtime:o[1]}));return{toAdd:n,toRemove:i}}async addFromPaths(e){fe("Adding files",e);let r=(await Promise.all(e.map(async i=>await Ee.getDocument(i)))).filter(i=>!!i?.path);fe("Sorting documents to first index markdown"),r=js(r,i=>i.path.endsWith(".md")?0:1),this.removeFromPaths(r.filter(i=>this.indexedDocuments.has(i.path)).map(i=>i.path));let n=ml(r,500);for(let i of n){fe("Indexing into search engine",i),i.forEach(s=>this.indexedDocuments.set(s.path,s.mtime));let o=i.filter(s=>this.minisearch.has(s.path));this.removeFromPaths(o.map(s=>s.path)),await this.minisearch.addAllAsync(i)}}removeFromPaths(e){e.forEach(n=>this.indexedDocuments.delete(n));let r=e.filter(n=>this.minisearch.has(n));this.minisearch.discardAll(r)}async search(e,r){if(e.isEmpty())return[];fe("=== New search ==="),fe("Starting search for",e);let n;switch(F.fuzziness){case"0":n=0;break;case"1":n=.1;break;default:n=.2;break}let i=this.minisearch.search(e.segmentsToStr(),{prefix:l=>l.length>=r.prefixLength,fuzzy:l=>l.length<=3?0:l.length<=5?n/2:n,combineWith:"AND",boost:{basename:F.weightBasename,directory:F.weightDirectory,aliases:F.weightBasename,headings1:F.weightH1,headings2:F.weightH2,headings3:F.weightH3,unmarkedTags:F.weightUnmarkedTags}});if(fe("Found",i.length,"results"),e.query.ext?.length&&(i=i.filter(l=>{let c="."+l.id.split(".").pop();return e.query.ext?.some(h=>c.startsWith(h.startsWith(".")?h:"."+h))})),e.query.path&&(i=i.filter(l=>e.query.path?.some(c=>l.id.toLowerCase().includes(c.toLowerCase())))),e.query.exclude.path&&(i=i.filter(l=>!e.query.exclude.path?.some(c=>l.id.toLowerCase().includes(c.toLowerCase())))),!i.length)return[];if(r.singleFilePath)return i.filter(l=>l.id===r.singleFilePath);F.hideExcluded?i=i.filter(l=>!(app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id))):i.forEach(l=>{app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(l.id)&&(l.score/=10)});let o=e.getTags();for(let l of o)for(let c of i)(c.tags??[]).includes(l)&&(c.score*=100);fe("Sorting and limiting results"),i=i.sort((l,c)=>c.score-l.score).slice(0,50),i.length&&fe("First result:",i[0]);let s=await Promise.all(i.map(async l=>await Ee.getDocument(l.id))),a=e.getExactTerms();a.length&&(fe("Filtering with quoted terms: ",a),i=i.filter(l=>{let c=s.find(d=>d.path===l.id),h=c?.path.toLowerCase()??"",f=ms(c?.content??"").toLowerCase();return a.every(d=>f.includes(d)||h.includes(d))}));let u=e.query.exclude.text;return u.length&&(fe("Filtering with exclusions"),i=i.filter(l=>{let c=ms(s.find(h=>h.path===l.id)?.content??"").toLowerCase();return u.every(h=>!c.includes(h))})),fe("Deduping"),i=i.filter((l,c,h)=>h.findIndex(f=>f.id===l.id)===c),i}async getSuggestions(e,r){let n;F.simpleSearch?n=await this.search(e,{prefixLength:3,singleFilePath:r?.singleFilePath}):n=await this.search(e,{prefixLength:1,singleFilePath:r?.singleFilePath});let i=await Promise.all(n.map(async s=>await Ee.getDocument(s.id)));return n.map(s=>{fe("Locating matches for",s.id);let a=i.find(h=>h.path===s.id);a||(console.warn(`Omnisearch - Note "${s.id}" not in the live cache`),a={content:"",basename:s.id,path:s.id});let u=[...Object.keys(s.match),...e.getExactTerms(),...e.getTags()].filter(h=>h.length>1||/\p{Emoji}/u.test(h));fe("Matching tokens:",u),fe("Getting matches locations...");let l=qi(a.content,Jr(u),e);return fe(`Matches for ${a.basename}`,l),pe({score:s.score,foundWords:u,matches:l},a)})}async writeToCache(){await Ee.writeMinisearchCache(this.minisearch,this.indexedDocuments)}},Ns=to;Ns.options={tokenize:vb,extractField:(e,r)=>{if(r==="directory"){let n=e.path.split("/");return n.pop(),n.join("/")}return e[r]},processTerm:e=>(F.ignoreDiacritics?yt(e):e).toLowerCase(),idField:"path",fields:["basename","directory","aliases","content","headings1","headings2","headings3"],storeFields:["tags"],logger(e,r,n){n==="version_conflict"&&new Tf.Notice("Omnisearch - Your index cache may be incorrect or corrupted. If this message keeps appearing, go to Settings to clear the cache.",5e3)}};var we=new Ns;var Bs=new Set;function Df(t){Bs.add(t)}async function ro(){let t=[...Bs].map(e=>e.path);t.length&&(we.removeFromPaths(t),await we.addFromPaths(t),Bs.clear())}var If=me(Of());function Pf(t,e,r){let n=t.slice();return n[36]=e[r],n[38]=r,n}function bb(t){let e,r,n;return{c(){e=M("button"),e.textContent="Create note"},m(i,o){$(i,e,o),r||(n=Ve(e,"click",t[12]),r=!0)},p:he,d(i){i&&V(e),r=!1,n()}}}function xb(t){let e,r=F.showCreateButton&&bb(t);return{c(){r&&r.c(),e=yr()},m(n,i){r&&r.m(n,i),$(n,e,i)},p(n,i){F.showCreateButton&&r.p(n,i)},d(n){r&&r.d(n),n&&V(e)}}}function kf(t){let e,r,n;return{c(){e=M("div"),r=Ce("\u23F3 Work in progress: "),n=Ce(t[3]),Ge(e,"text-align","center"),Ge(e,"color","var(--text-accent)"),Ge(e,"margin-top","10px")},m(i,o){$(i,e,o),D(e,r),D(e,n)},p(i,o){o[0]&8&&Ze(n,i[3])},d(i){i&&V(e)}}}function Mf(t){let e,r;function n(...i){return t[18](t[38],...i)}return e=new hf({props:{selected:t[38]===t[0],note:t[36]}}),e.$on("mousemove",n),e.$on("click",t[10]),e.$on("auxclick",t[19]),{c(){$e(e.$$.fragment)},m(i,o){Re(e,i,o),r=!0},p(i,o){t=i;let s={};o[0]&1&&(s.selected=t[38]===t[0]),o[0]&4&&(s.note=t[36]),e.$set(s)},i(i){r||(ee(e.$$.fragment,i),r=!0)},o(i){ne(e.$$.fragment,i),r=!1},d(i){Oe(e,i)}}}function wb(t){let e;return{c(){e=Ce("Searching...")},m(r,n){$(r,e,n)},p:he,d(r){r&&V(e)}}}function jb(t){let e,r=F.simpleSearch&&t[1].split(Fn).some(Lf),n,i=r&&Rf(t);return{c(){e=Ce(`We found 0 result for your search here.
      `),i&&i.c(),n=yr()},m(o,s){$(o,e,s),i&&i.m(o,s),$(o,n,s)},p(o,s){s[0]&2&&(r=F.simpleSearch&&o[1].split(Fn).some(Lf)),r?i||(i=Rf(o),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(o){o&&V(e),i&&i.d(o),o&&V(n)}}}function Rf(t){let e,r,n;return{c(){e=M("br"),r=W(),n=M("span"),n.textContent=`You have enabled "Simpler Search" in the settings, try to type more
          characters.`,Ge(n,"color","var(--text-accent)"),Ge(n,"font-size","small")},m(i,o){$(i,e,o),$(i,r,o),$(i,n,o)},d(i){i&&V(e),i&&V(r),i&&V(n)}}}function Ab(t){let e,r,n,i=t[2],o=[];for(let c=0;c<i.length;c+=1)o[c]=Mf(Pf(t,i,c));let s=c=>ne(o[c],1,1,()=>{o[c]=null});function a(c,h){if(!c[2].length&&c[1]&&!c[4])return jb;if(c[4])return wb}let u=a(t,[-1,-1]),l=u&&u(t);return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=W(),r=M("div"),l&&l.c(),Ge(r,"text-align","center")},m(c,h){for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(c,h);$(c,e,h),$(c,r,h),l&&l.m(r,null),n=!0},p(c,h){if(h[0]&3077){i=c[2];let f;for(f=0;f<i.length;f+=1){let d=Pf(c,i,f);o[f]?(o[f].p(d,h),ee(o[f],1)):(o[f]=Mf(d),o[f].c(),ee(o[f],1),o[f].m(e.parentNode,e))}for(Ut(),f=i.length;f<o.length;f+=1)s(f);Gt()}u===(u=a(c,h))&&l?l.p(c,h):(l&&l.d(1),l=u&&u(c),l&&(l.c(),l.m(r,null)))},i(c){if(!n){for(let h=0;h<i.length;h+=1)ee(o[h]);n=!0}},o(c){o=o.filter(Boolean);for(let h=0;h<o.length;h+=1)ne(o[h]);n=!1},d(c){Hn(o,c),c&&V(e),c&&V(r),l&&l.d()}}}function Cb(t){let e,r,n,i,o,s,a,u,l,c,h,f,d,_,w,b,p,x,m,g,y,v,j,A,E,T,I,L,P,z,J,Y,q,C,S,O,B,X,k,re,Ke,je,ge,ze,Xf={initialValue:t[1],placeholder:"Omnisearch - Vault",$$slots:{default:[xb]},$$scope:{ctx:t}};e=new wi({props:Xf}),t[16](e),e.$on("input",t[17]);let He=t[3]&&kf(t);return i=new ji({props:{$$slots:{default:[Ab]},$$scope:{ctx:t}}}),{c(){$e(e.$$.fragment),r=W(),He&&He.c(),n=W(),$e(i.$$.fragment),o=W(),s=M("div"),a=M("div"),a.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',u=W(),l=M("div"),l.innerHTML=`<span class="prompt-instruction-command">alt \u2191\u2193</span> 
    <span>to cycle history</span>`,c=W(),h=M("div"),f=M("span"),d=Ce(t[7]),_=W(),w=M("span"),w.textContent="to open",b=W(),p=M("div"),p.innerHTML=`<span class="prompt-instruction-command">tab</span> 
    <span>to switch to In-File Search</span>`,x=W(),m=M("div"),g=M("span"),y=Ce(t[6]),v=W(),j=M("span"),j.textContent="to open in a new pane",A=W(),E=M("div"),E.innerHTML=`<span class="prompt-instruction-command">alt o</span> 
    <span>to open in the background</span>`,T=W(),I=M("div"),L=M("span"),P=Ce(t[9]),z=W(),J=M("span"),J.textContent="to create",Y=W(),q=M("div"),C=M("span"),S=Ce(t[8]),O=W(),B=M("span"),B.textContent="to create in a new pane",X=W(),k=M("div"),k.innerHTML=`<span class="prompt-instruction-command">alt \u21B5</span> 
    <span>to insert a link</span>`,re=W(),Ke=M("div"),Ke.innerHTML=`<span class="prompt-instruction-command">ctrl h</span> 
    <span>to toggle excerpts</span>`,je=W(),ge=M("div"),ge.innerHTML='<span class="prompt-instruction-command">esc</span><span>to close</span>',N(a,"class","prompt-instruction"),N(l,"class","prompt-instruction"),N(f,"class","prompt-instruction-command"),N(h,"class","prompt-instruction"),N(p,"class","prompt-instruction"),N(g,"class","prompt-instruction-command"),N(m,"class","prompt-instruction"),N(E,"class","prompt-instruction"),N(L,"class","prompt-instruction-command"),N(I,"class","prompt-instruction"),N(C,"class","prompt-instruction-command"),N(q,"class","prompt-instruction"),N(k,"class","prompt-instruction"),N(Ke,"class","prompt-instruction"),N(ge,"class","prompt-instruction"),N(s,"class","prompt-instructions")},m(Z,be){Re(e,Z,be),$(Z,r,be),He&&He.m(Z,be),$(Z,n,be),Re(i,Z,be),$(Z,o,be),$(Z,s,be),D(s,a),D(s,u),D(s,l),D(s,c),D(s,h),D(h,f),D(f,d),D(h,_),D(h,w),D(s,b),D(s,p),D(s,x),D(s,m),D(m,g),D(g,y),D(m,v),D(m,j),D(s,A),D(s,E),D(s,T),D(s,I),D(I,L),D(L,P),D(I,z),D(I,J),D(s,Y),D(s,q),D(q,C),D(C,S),D(q,O),D(q,B),D(s,X),D(s,k),D(s,re),D(s,Ke),D(s,je),D(s,ge),ze=!0},p(Z,be){let so={};be[0]&2&&(so.initialValue=Z[1]),be[1]&256&&(so.$$scope={dirty:be,ctx:Z}),e.$set(so),Z[3]?He?He.p(Z,be):(He=kf(Z),He.c(),He.m(n.parentNode,n)):He&&(He.d(1),He=null);let $s={};be[0]&23|be[1]&256&&($s.$$scope={dirty:be,ctx:Z}),i.$set($s),(!ze||be[0]&128)&&Ze(d,Z[7]),(!ze||be[0]&64)&&Ze(y,Z[6]),(!ze||be[0]&512)&&Ze(P,Z[9]),(!ze||be[0]&256)&&Ze(S,Z[8])},i(Z){ze||(ee(e.$$.fragment,Z),ee(i.$$.fragment,Z),ze=!0)},o(Z){ne(e.$$.fragment,Z),ne(i.$$.fragment,Z),ze=!1},d(Z){t[16](null),Oe(e,Z),Z&&V(r),He&&He.d(Z),Z&&V(n),Oe(i,Z),Z&&V(o),Z&&V(s)}}}var Lf=t=>t.length<3;function Sb(t,e,r){let n,i;Kn(t,It,k=>r(15,i=k));let{modal:o}=e,{previousQuery:s}=e,a=0,u=0,l,c=[],h,f="",d=!0,_,w,b,p,x;sn(async()=>{G.enable("vault"),G.on("vault",te.Enter,A),G.on("vault",te.OpenInBackground,E),G.on("vault",te.CreateNote,z),G.on("vault",te.OpenInNewPane,T),G.on("vault",te.InsertLink,J),G.on("vault",te.Tab,Y),G.on("vault",te.ArrowUp,()=>q(-1)),G.on("vault",te.ArrowDown,()=>q(1)),G.on("vault",te.PrevSearchHistory,m),G.on("vault",te.NextSearchHistory,g),await ro(),F.showPreviousQueryResults&&r(13,s=(await Ee.getSearchHistory())[0])}),an(()=>{G.disable("vault")});async function m(){let k=(await Ee.getSearchHistory()).filter(re=>re);++u>=k.length&&(u=0),r(1,l=k[u]),_?.setInputValue(l)}async function g(){let k=(await Ee.getSearchHistory()).filter(re=>re);--u<0&&(u=k.length?k.length-1:0),r(1,l=k[u]),_?.setInputValue(l)}let y=null;async function v(){y&&(y.cancel(),y=null),h=new ur(l),y=(0,If.cancelable)(new Promise(k=>{k(we.getSuggestions(h))})),r(2,c=await y),r(0,a=0),await C()}function j(k){!n||(k?.ctrlKey?T():A(),o.close())}function A(){!n||(L(n),o.close())}function E(){!n||L(n,!0)}function T(){!n||(L(n,!0),o.close())}function I(){l&&Ee.addToSearchHistory(l)}function L(k,re=!1){I(),Yi(k,re)}async function P(k){await z()}async function z(k){if(l){try{await nf(l,k?.newLeaf)}catch(re){new $t.Notice(re.message);return}o.close()}}function J(){if(!n)return;let k=app.vault.getMarkdownFiles().find(ze=>ze.path===n.path),re=app.workspace.getActiveFile(),Ke=app.workspace.getActiveViewOfType($t.MarkdownView);if(!Ke?.editor){new $t.Notice("Omnisearch - Error - No active editor",3e3);return}let je;k&&re?je=app.fileManager.generateMarkdownLink(k,re.path):je=`[[${n.basename}.${or(n.path)}]]`;let ge=Ke.editor.getCursor();Ke.editor.replaceRange(je,ge,ge),ge.ch+=je.length,Ke.editor.setCursor(ge),o.close()}function Y(){if(!(n&&(ir(n?.path)||!n?.matches.length)))if(I(),o.close(),n){let k=app.vault.getAbstractFileByPath(n.path);k&&k instanceof $t.TFile&&new tn(app,k,l).open()}else{let k=app.workspace.getActiveViewOfType($t.MarkdownView);k?.file&&new tn(app,k.file,l).open()}}function q(k){r(0,a=vi(a+k,c.length)),C()}async function C(){await jt(),n&&activeWindow.document.querySelector(`[data-result-id="${n.path}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}function S(k){lt[k?"unshift":"push"](()=>{_=k,r(5,_)})}let O=k=>r(1,l=k.detail),B=(k,re)=>r(0,a=k),X=k=>{k.button==1&&T()};t.$$set=k=>{"modal"in k&&r(14,o=k.modal),"previousQuery"in k&&r(13,s=k.previousQuery)},t.$$.update=()=>{if(t.$$.dirty[0]&8194){e:r(1,l=l??s)}if(t.$$.dirty[0]&2){e:l?(r(4,d=!0),v().then(()=>{r(4,d=!1)})):(r(4,d=!1),r(2,c=[]))}if(t.$$.dirty[0]&5){e:n=c[a]}if(t.$$.dirty[0]&32768){e:switch(i){case Je.LoadingCache:r(3,f="Loading cache...");break;case Je.ReadingFiles:r(3,f="Reading files...");break;case Je.IndexingFiles:r(3,f="Indexing files...");break;case Je.WritingCache:v(),r(3,f="Updating cache...");break;default:v(),r(3,f="");break}}};e:F.openInNewPane?(r(6,w="\u21B5"),r(7,b=nr()+" \u21B5"),r(8,p="shift \u21B5"),r(9,x=nr()+" shift \u21B5")):(r(6,w=nr()+" \u21B5"),r(7,b="\u21B5"),r(8,p=nr()+" shift \u21B5"),r(9,x="shift \u21B5"));return[a,l,c,f,d,_,w,b,p,x,j,T,P,s,o,i,S,O,B,X]}var Nf=class extends Te{constructor(e){super();Ie(this,e,Sb,Cb,Ae,{modal:14,previousQuery:13},null,[-1,-1])}},Bf=Nf;var Hf=me(require("obsidian"));function Eb(t){let e,r=Vt(t[2].content,t[3])+"";return{c(){e=M("div"),N(e,"class","omnisearch-result__body")},m(n,i){$(n,e,i),e.innerHTML=r},p(n,i){i&12&&r!==(r=Vt(n[2].content,n[3])+"")&&(e.innerHTML=r)},d(n){n&&V(e)}}}function Fb(t){let e,r;return e=new Ji({props:{id:t[0].toString(),selected:t[1],$$slots:{default:[Eb]},$$scope:{ctx:t}}}),e.$on("mousemove",t[6]),e.$on("click",t[7]),e.$on("auxclick",t[8]),{c(){$e(e.$$.fragment)},m(n,i){Re(e,n,i),r=!0},p(n,[i]){let o={};i&1&&(o.id=n[0].toString()),i&2&&(o.selected=n[1]),i&524&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){r||(ee(e.$$.fragment,n),r=!0)},o(n){ne(e.$$.fragment,n),r=!1},d(n){Oe(e,n)}}}function Tb(t,e,r){let n,i,{offset:o}=e,{note:s}=e,{index:a=0}=e,{selected:u=!1}=e;function l(f){Qe.call(this,t,f)}function c(f){Qe.call(this,t,f)}function h(f){Qe.call(this,t,f)}return t.$$set=f=>{"offset"in f&&r(4,o=f.offset),"note"in f&&r(5,s=f.note),"index"in f&&r(0,a=f.index),"selected"in f&&r(1,u=f.selected)},t.$$.update=()=>{if(t.$$.dirty&48){e:r(2,n=Xr(s?.content??"",o))}if(t.$$.dirty&36){e:r(3,i=kn(s.matches).map(f=>(f.offset=f.offset-n.offset,f)))}},[a,u,n,i,o,s,l,c,h]}var Kf=class extends Te{constructor(e){super();Ie(this,e,Tb,Fb,Ae,{offset:4,note:5,index:0,selected:1})}},zf=Kf;function Vf(t,e,r){let n=t.slice();return n[19]=e[r],n[21]=r,n}function Db(t){let e;return{c(){e=M("div"),e.textContent="We found 0 result for your search here.",Ge(e,"text-align","center")},m(r,n){$(r,e,n)},p:he,i:he,o:he,d(r){r&&V(e)}}}function Ob(t){let e,r,n=t[4],i=[];for(let s=0;s<n.length;s+=1)i[s]=$f(Vf(t,n,s));let o=s=>ne(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=yr()},m(s,a){for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(s,a);$(s,e,a),r=!0},p(s,a){if(a&120){n=s[4];let u;for(u=0;u<n.length;u+=1){let l=Vf(s,n,u);i[u]?(i[u].p(l,a),ee(i[u],1)):(i[u]=$f(l),i[u].c(),ee(i[u],1),i[u].m(e.parentNode,e))}for(Ut(),u=n.length;u<i.length;u+=1)o(u);Gt()}},i(s){if(!r){for(let a=0;a<n.length;a+=1)ee(i[a]);r=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)ne(i[a]);r=!1},d(s){Hn(i,s),s&&V(e)}}}function $f(t){let e,r;function n(...i){return t[11](t[21],...i)}return e=new zf({props:{offset:t[19],note:t[3],index:t[21],selected:t[21]===t[5]}}),e.$on("mousemove",n),e.$on("click",t[12]),e.$on("auxclick",t[13]),{c(){$e(e.$$.fragment)},m(i,o){Re(e,i,o),r=!0},p(i,o){t=i;let s={};o&16&&(s.offset=t[19]),o&8&&(s.note=t[3]),o&32&&(s.selected=t[21]===t[5]),e.$set(s)},i(i){r||(ee(e.$$.fragment,i),r=!0)},o(i){ne(e.$$.fragment,i),r=!1},d(i){Oe(e,i)}}}function Ib(t){let e,r,n,i,o=[Ob,Db],s=[];function a(u,l){return u[4].length&&u[3]?0:1}return e=a(t,-1),r=s[e]=o[e](t),{c(){r.c(),n=yr()},m(u,l){s[e].m(u,l),$(u,n,l),i=!0},p(u,l){let c=e;e=a(u,l),e===c?s[e].p(u,l):(Ut(),ne(s[c],1,1,()=>{s[c]=null}),Gt(),r=s[e],r?r.p(u,l):(r=s[e]=o[e](u),r.c()),ee(r,1),r.m(n.parentNode,n))},i(u){i||(ee(r),i=!0)},o(u){ne(r),i=!1},d(u){s[e].d(u),u&&V(n)}}}function Pb(t){let e;return{c(){e=M("span"),e.textContent="to close"},m(r,n){$(r,e,n)},d(r){r&&V(e)}}}function kb(t){let e;return{c(){e=M("span"),e.textContent="to go back to Vault Search"},m(r,n){$(r,e,n)},d(r){r&&V(e)}}}function Mb(t){let e,r,n,i,o,s,a,u,l,c,h,f,d,_,w,b,p,x,m,g;e=new wi({props:{placeholder:"Omnisearch - File",initialValue:t[1]}}),e.$on("input",t[10]),n=new ji({props:{$$slots:{default:[Ib]},$$scope:{ctx:t}}});function y(A,E){return A[0]?kb:Pb}let v=y(t,-1),j=v(t);return{c(){$e(e.$$.fragment),r=W(),$e(n.$$.fragment),i=W(),o=M("div"),s=M("div"),s.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',a=W(),u=M("div"),u.innerHTML='<span class="prompt-instruction-command">\u21B5</span><span>to open</span>',l=W(),c=M("div"),c.innerHTML=`<span class="prompt-instruction-command">tab</span> 
    <span>to switch to Vault Search</span>`,h=W(),f=M("div"),d=M("span"),d.textContent="esc",_=W(),j.c(),w=W(),b=M("div"),p=M("span"),p.textContent=`${nr()} \u21B5`,x=W(),m=M("span"),m.textContent="to open in a new pane",N(s,"class","prompt-instruction"),N(u,"class","prompt-instruction"),N(c,"class","prompt-instruction"),N(d,"class","prompt-instruction-command"),N(f,"class","prompt-instruction"),N(p,"class","prompt-instruction-command"),N(b,"class","prompt-instruction"),N(o,"class","prompt-instructions")},m(A,E){Re(e,A,E),$(A,r,E),Re(n,A,E),$(A,i,E),$(A,o,E),D(o,s),D(o,a),D(o,u),D(o,l),D(o,c),D(o,h),D(o,f),D(f,d),D(f,_),j.m(f,null),D(o,w),D(o,b),D(b,p),D(b,x),D(b,m),g=!0},p(A,[E]){let T={};E&2&&(T.initialValue=A[1]),e.$set(T);let I={};E&4194360&&(I.$$scope={dirty:E,ctx:A}),n.$set(I),v!==(v=y(A,E))&&(j.d(1),j=v(A),j&&(j.c(),j.m(f,null)))},i(A){g||(ee(e.$$.fragment,A),ee(n.$$.fragment,A),g=!0)},o(A){ne(e.$$.fragment,A),ne(n.$$.fragment,A),g=!1},d(A){Oe(e,A),A&&V(r),Oe(n,A),A&&V(i),A&&V(o),j.d()}}}function Rb(t,e,r){let n=t.find(i=>i.offset>e);return n?t.filter(i=>i.offset>e&&i.offset<=n.offset+r):[]}function Lb(t,e,r){let{modal:n}=e,{parent:i=null}=e,{singleFilePath:o=""}=e,{previousQuery:s}=e,a,u=[],l=0,c,h;sn(()=>{G.enable("infile"),G.on("infile",te.Enter,b),G.on("infile",te.OpenInNewPane,w),G.on("infile",te.ArrowUp,()=>d(-1)),G.on("infile",te.ArrowDown,()=>d(1)),G.on("infile",te.Tab,p)}),an(()=>{G.disable("infile")});function f(v){let j=[],A=-1,E=0;for(;;){let T=Rb(v,A,En);if(!T.length||(A=T.last().offset,j.push(T),++E>100))break}return j}function d(v){r(5,l=vi(l+v,u.length)),_()}async function _(){await jt(),document.querySelector(`[data-result-id="${l}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}async function w(){return b(!0)}async function b(v=!1){if(c){n.close(),i&&i.close(),await Yi(c,v);let j=app.workspace.getActiveViewOfType(Hf.MarkdownView);if(!j)return;let A=u[l]??0,E=j.editor.offsetToPos(A);E.ch=0,j.editor.setCursor(E),j.editor.scrollIntoView({from:{line:E.line-10,ch:0},to:{line:E.line+10,ch:0}})}}function p(){new cr(app,a??s).open(),n.close()}let x=v=>r(2,a=v.detail),m=(v,j)=>r(5,l=v),g=v=>b(v.ctrlKey),y=v=>{v.button==1&&b(!0)};return t.$$set=v=>{"modal"in v&&r(7,n=v.modal),"parent"in v&&r(0,i=v.parent),"singleFilePath"in v&&r(8,o=v.singleFilePath),"previousQuery"in v&&r(1,s=v.previousQuery)},t.$$.update=()=>{if(t.$$.dirty&2){e:r(2,a=s??"")}if(t.$$.dirty&772){e:(async()=>{a&&(r(9,h=new ur(a)),r(3,c=(await we.getSuggestions(h,{singleFilePath:o}))[0]??null)),r(5,l=0),await _()})()}if(t.$$.dirty&8){e:if(c){let v=f(c.matches);r(4,u=v.map(j=>Math.round((j.first().offset+j.last().offset)/2)))}}},[i,s,a,c,u,l,b,n,o,h,x,m,g,y]}var Wf=class extends Te{constructor(e){super();Ie(this,e,Lb,Mb,Ae,{modal:7,parent:0,singleFilePath:8,previousQuery:1})}},Uf=Wf;var zs=class extends io.Modal{constructor(e){super(e);this.modalEl.replaceChildren(),this.modalEl.addClass("omnisearch-modal","prompt"),this.modalEl.removeClass("modal"),this.modalEl.tabIndex=-1,this.scope.register([],"ArrowDown",s=>{s.preventDefault(),G.emit(te.ArrowDown)}),this.scope.register([],"ArrowUp",s=>{s.preventDefault(),G.emit(te.ArrowUp)});for(let s of[{k:"J",dir:"down"},{k:"K",dir:"up"}])for(let a of["Ctrl","Mod"])this.scope.register([a],s.k,u=>{F.vimLikeNavigationShortcut&&G.emit("arrow-"+s.dir)});for(let s of[{k:"N",dir:"down"},{k:"P",dir:"up"}])for(let a of["Ctrl","Mod"])this.scope.register([a],s.k,u=>{F.vimLikeNavigationShortcut&&G.emit("arrow-"+s.dir)});let r,n,i,o;F.openInNewPane?(r=["Mod"],n=[],i=["Mod","Shift"],o=["Shift"]):(r=[],n=["Mod"],i=["Shift"],o=["Mod","Shift"]),this.scope.register(n,"Enter",s=>{s.preventDefault(),G.emit(te.OpenInNewPane)}),this.scope.register(["Alt"],"Enter",s=>{s.preventDefault(),G.emit(te.InsertLink)}),this.scope.register(i,"Enter",s=>{s.preventDefault(),G.emit(te.CreateNote)}),this.scope.register(o,"Enter",s=>{s.preventDefault(),G.emit(te.CreateNote,{newLeaf:!0})}),this.scope.register(r,"Enter",s=>{ds()||(s.preventDefault(),G.emit(te.Enter))}),this.scope.register(["Alt"],"O",s=>{ds()||(s.preventDefault(),G.emit(te.OpenInBackground))}),this.scope.register([],"Tab",s=>{s.preventDefault(),G.emit(te.Tab)}),this.scope.register(["Alt"],"ArrowDown",s=>{s.preventDefault(),G.emit(te.NextSearchHistory)}),this.scope.register(["Alt"],"ArrowUp",s=>{s.preventDefault(),G.emit(te.PrevSearchHistory)}),this.scope.register(["Ctrl"],"H",s=>{G.emit(gi.ToggleExcerpts)})}},cr=class extends zs{constructor(e,r){super(e);let n=e.workspace.getActiveViewOfType(io.MarkdownView)?.editor.getSelection(),i=new Bf({target:this.modalEl,props:{modal:this,previousQuery:n??r}});this.onClose=()=>{i.$destroy()}}},tn=class extends zs{constructor(e,r,n="",i){super(e);let o=new Uf({target:this.modalEl,props:{modal:this,singleFilePath:r.path,parent:i,previousQuery:n}});i&&i.containerEl.toggleVisibility(!1),this.onClose=()=>{i&&i.containerEl.toggleVisibility(!0),o.$destroy()}}};var Gf=!1,oo=[];function Nb(t){return t.map(e=>{let{score:r,path:n,basename:i,foundWords:o,matches:s,content:a}=e,u=Xr(a,s[0]?.offset??-1);return{score:r,vault:app.vault.getName(),path:n,basename:i,foundWords:o,matches:s.map(c=>({match:c.match,offset:c.offset})),excerpt:u.content}})}async function Bb(t){let e=new ur(t),r=await we.getSuggestions(e);return Nb(r)}function Kb(t){oo.push(t),Gf&&t()}function zb(t){oo=oo.filter(e=>e!==t)}function Qf(){Gf=!0,oo.forEach(t=>t())}var Ln={search:Bb,registerOnIndexed:Kb,unregisterOnIndexed:zb,refreshIndex:ro};var qf=me(require("http")),Yf=me(require("url"));var Hs=me(require("obsidian"));function Hb(){let t=qf.createServer(async function(e,r){r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, HEAD, POST, OPTIONS, PUT, PATCH, DELETE"),r.setHeader("Access-Control-Allow-Headers","Access-Control-Allow-Headers, Origin, Authorization,Accept,x-client-id, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers, hypothesis-client-version"),r.setHeader("Access-Control-Allow-Credentials","true");try{if(e.url){let n=Yf.parse(e.url,!0);if(n.pathname==="/search"){let i=n.query.q,o=await Ln.search(i);r.statusCode=200,r.setHeader("Content-Type","application/json"),r.end(JSON.stringify(o))}else r.end()}}catch(n){r.statusCode=500,r.end(n)}});return{listen(e){console.log(`Omnisearch - Starting HTTP server on port ${e}`),t.listen({port:parseInt(e),host:"localhost"}),console.log(`Omnisearch - Started HTTP server on port ${e}`),new Hs.Notice(`Omnisearch - Started HTTP server on port ${e}`)},close(){t.close(),console.log("Omnisearch - Terminated HTTP server"),new Hs.Notice("Omnisearch - Terminated HTTP server")}}}var Jf=Hb;var Vs=class extends fr.Plugin{constructor(){super(...arguments);this.apiHttpServer=Jf()}async onload(){if(await el(this),this.addSettingTab(new us(this)),cs()){console.log("Omnisearch - Plugin disabled");return}await Vb(),await Or.clearOldDatabases(),$b(this),F.ribbonIcon&&this.addRibbonButton(),G.disable("vault"),G.disable("infile"),G.on("global",gi.ToggleExcerpts,()=>{tr.set(!F.showExcerpt)}),this.addCommand({id:"show-modal",name:"Vault search",callback:()=>{new cr(app).open()}}),this.addCommand({id:"show-modal-infile",name:"In-file search",editorCallback:(e,r)=>{r.file&&new tn(app,r.file).open()}}),app.workspace.onLayoutReady(async()=>{this.registerEvent(this.app.vault.on("create",e=>{Dn(e.path)&&(fe("Indexing new file",e.path),we.addFromPaths([e.path]))})),this.registerEvent(this.app.vault.on("delete",e=>{fe("Removing file",e.path),Ee.removeFromLiveCache(e.path),we.removeFromPaths([e.path])})),this.registerEvent(this.app.vault.on("modify",async e=>{Dn(e.path)&&(fe("Updating file",e.path),await Ee.addToLiveCache(e.path),Df(e))})),this.registerEvent(this.app.vault.on("rename",async(e,r)=>{Dn(e.path)&&(fe("Renaming file",e.path),Ee.removeFromLiveCache(r),await Ee.addToLiveCache(e.path),we.removeFromPaths([r]),await we.addFromPaths([e.path]))})),this.executeFirstLaunchTasks(),await this.populateIndex(),F.httpApiEnabled&&this.apiHttpServer.listen(F.httpApiPort)})}executeFirstLaunchTasks(){let e="1.10.1";F.welcomeMessage!==e,F.welcomeMessage=e,this.saveData(F)}async onunload(){delete globalThis.omnisearch,await Se.clearCache(),this.apiHttpServer.close()}addRibbonButton(){this.ribbonButton=this.addRibbonIcon("search","Omnisearch",e=>{new cr(app).open()})}removeRibbonButton(){this.ribbonButton&&this.ribbonButton.parentNode?.removeChild(this.ribbonButton)}async populateIndex(){console.time("Omnisearch - Indexing total time"),It.set(Je.ReadingFiles);let e=app.vault.getFiles().filter(n=>Dn(n.path));console.log(`Omnisearch - ${e.length} files total`),console.log(`Omnisearch - Cache is ${Ot()?"enabled":"disabled"}`),Ot()&&(console.time("Omnisearch - Loading index from cache"),It.set(Je.LoadingCache),await we.loadCache()&&console.timeEnd("Omnisearch - Loading index from cache"));let r=we.getDiff(e.map(n=>({path:n.path,mtime:n.stat.mtime})));Ot()&&(r.toAdd.length&&console.log("Omnisearch - Total number of files to add/update: "+r.toAdd.length),r.toRemove.length&&console.log("Omnisearch - Total number of files to remove: "+r.toRemove.length)),r.toAdd.length>=1e3&&Ot()&&new fr.Notice(`Omnisearch - ${r.toAdd.length} files need to be indexed. Obsidian may experience stutters and freezes during the process`,1e4),It.set(Je.IndexingFiles),we.removeFromPaths(r.toRemove.map(n=>n.path)),await we.addFromPaths(r.toAdd.map(n=>n.path)),(r.toRemove.length||r.toAdd.length)&&Ot()&&(It.set(Je.WritingCache),F.useCache=!1,await ae(this),await we.writeToCache(),F.useCache=!0,await ae(this)),console.timeEnd("Omnisearch - Indexing total time"),r.toAdd.length>=1e3&&!fr.Platform.isIosApp&&new fr.Notice("Omnisearch - Your files have been indexed."),It.set(Je.Done),Qf()}};async function Vb(){let t=[`${app.vault.configDir}/plugins/omnisearch/searchIndex.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.json`,`${app.vault.configDir}/plugins/omnisearch/notesCache.data`,`${app.vault.configDir}/plugins/omnisearch/searchIndex.data`,`${app.vault.configDir}/plugins/omnisearch/historyCache.json`,`${app.vault.configDir}/plugins/omnisearch/pdfCache.data`];for(let e of t)if(await app.vault.adapter.exists(e))try{await app.vault.adapter.remove(e)}catch{}}function $b(t){t.registerObsidianProtocolHandler("omnisearch",e=>{new cr(app,e.query).open()}),globalThis.omnisearch=Ln,app.plugins.plugins.omnisearch.api=Ln}
